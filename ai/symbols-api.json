{"symbols": [{"name": "get_sync_url", "kind": "function", "path": "alembic/env.py", "line": 49, "signature": "get_sync_url() -> str", "summary": "", "layer": "core", "category": "migration"}, {"name": "run_migrations_offline", "kind": "function", "path": "alembic/env.py", "line": 64, "signature": "run_migrations_offline() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "do_run_migrations", "kind": "function", "path": "alembic/env.py", "line": 72, "signature": "do_run_migrations(connection: Connection) -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "run_async_migrations", "kind": "async_function", "path": "alembic/env.py", "line": 79, "signature": "async run_async_migrations() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "run_migrations_online", "kind": "function", "path": "alembic/env.py", "line": 92, "signature": "run_migrations_online() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0001_initial.py", "line": 17, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0001_initial.py", "line": 197, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0002_import_sessions.py", "line": 16, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0002_import_sessions.py", "line": 46, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0003_enum_to_string.py", "line": 24, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0003_enum_to_string.py", "line": 87, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0004_importer_custom_fields.py", "line": 24, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0004_importer_custom_fields.py", "line": 67, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0005_custom_field_enhancements.py", "line": 15, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0005_custom_field_enhancements.py", "line": 41, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0006_custom_field_audit.py", "line": 15, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0006_custom_field_audit.py", "line": 33, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0007_custom_field_locking.py", "line": 15, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0007_custom_field_locking.py", "line": 51, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0008_replace_valuation_rules_v2.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0008_replace_valuation_rules_v2.py", "line": 171, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0009_add_profile_rule_group_weights.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0009_add_profile_rule_group_weights.py", "line": 30, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0010_add_application_settings_table.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0010_add_application_settings_table.py", "line": 41, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0011_add_cpu_igpu_mark.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0011_add_cpu_igpu_mark.py", "line": 24, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0012_add_listing_performance_metrics.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0012_add_listing_performance_metrics.py", "line": 33, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0013_add_listing_metadata_fields.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0013_add_listing_metadata_fields.py", "line": 31, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0014_add_cpu_passmark_fields.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0014_add_cpu_passmark_fields.py", "line": 26, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0015_listing_links_and_ruleset_priority.py", "line": 20, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0015_listing_links_and_ruleset_priority.py", "line": 75, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0016_add_rule_group_is_active.py", "line": 18, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0016_add_rule_group_is_active.py", "line": 33, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0017_ram_and_storage_profiles.py", "line": 25, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0017_ram_and_storage_profiles.py", "line": 173, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0018_add_rule_group_metadata.py", "line": 21, "signature": "upgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0018_add_rule_group_metadata.py", "line": 46, "signature": "downgrade() -> None", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0019_add_baseline_audit_log.py", "line": 19, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0019_add_baseline_audit_log.py", "line": 74, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0020_add_action_multipliers_schema_documentation.py", "line": 22, "signature": "upgrade()", "summary": "Add database comment documenting the modifiers_json schema structure.", "layer": "schema", "docstring": "Add database comment documenting the modifiers_json schema structure.", "category": "business_logic"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0020_add_action_multipliers_schema_documentation.py", "line": 62, "signature": "downgrade()", "summary": "Remove the database comment.", "layer": "schema", "docstring": "Remove the database comment.", "category": "business_logic"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0021_add_url_ingestion_foundation.py", "line": 25, "signature": "upgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0021_add_url_ingestion_foundation.py", "line": 89, "signature": "downgrade()", "summary": "", "layer": "core", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0022_add_progress_pct_to_import_session.py", "line": 21, "signature": "upgrade() -> None", "summary": "Add progress_pct field to import_session table.", "layer": "core", "docstring": "Add progress_pct field to import_session table.", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0022_add_progress_pct_to_import_session.py", "line": 28, "signature": "downgrade() -> None", "summary": "Remove progress_pct field from import_session table.", "layer": "core", "docstring": "Remove progress_pct field from import_session table.", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0bfccac265c8_add_dedup_hash_field_to_listing_for_.py", "line": 21, "signature": "upgrade() -> None", "summary": "Upgrade schema.", "layer": "core", "docstring": "Upgrade schema.", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0bfccac265c8_add_dedup_hash_field_to_listing_for_.py", "line": 146, "signature": "downgrade() -> None", "summary": "Downgrade schema.", "layer": "core", "docstring": "Downgrade schema.", "category": "migration"}, {"name": "upgrade", "kind": "function", "path": "alembic/versions/0023_add_listing_pagination_indexes.py", "line": 21, "signature": "upgrade() -> None", "summary": "Add composite indexes for cursor-based pagination on sortable columns.", "layer": "core", "docstring": "Add composite indexes for cursor-based pagination on sortable columns.\n\nThese indexes support keyset pagination with composite key (sort_column, id)\nfor optimal performance (<100ms for 500-row pages).\n\nIndexes are created for commonly sorted columns:\n- updated_at (default sort)\n- created_at\n- price_usd\n- adjusted_price_usd\n- manufacturer\n- form_factor\n- dollar_per_cpu_mark_multi\n- dollar_per_cpu_mark_single\n\nEach index includes the id column for stable pagination and to support\nthe keyset WHERE clause efficiently.", "category": "migration"}, {"name": "downgrade", "kind": "function", "path": "alembic/versions/0023_add_listing_pagination_indexes.py", "line": 99, "signature": "downgrade() -> None", "summary": "Remove pagination indexes.", "layer": "core", "docstring": "Remove pagination indexes.", "category": "migration"}, {"name": "create_app", "kind": "function", "path": "dealbrain_api/__init__.py", "line": 13, "signature": "create_app() -> 'FastAPI'", "summary": "Factory wrapper that defers heavy imports until needed.", "layer": "core", "docstring": "Factory wrapper that defers heavy imports until needed.", "category": "config"}, {"name": "run", "kind": "function", "path": "dealbrain_api/main.py", "line": 14, "signature": "run() -> None", "summary": "Launch the FastAPI app with Uvicorn.", "layer": "core", "docstring": "Launch the FastAPI app with Uvicorn.", "category": "business_logic"}, {"name": "get_app", "kind": "function", "path": "dealbrain_api/main.py", "line": 25, "signature": "get_app()", "summary": "Factory used by uvicorn to instantiate the app.", "layer": "core", "docstring": "Factory used by uvicorn to instantiate the app.", "category": "business_logic"}, {"name": "CacheManager", "kind": "class", "path": "dealbrain_api/cache.py", "line": 20, "signature": "class CacheManager", "summary": "Manages Redis cache connections and operations.", "layer": "core", "docstring": "Manages Redis cache connections and operations.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/cache.py", "line": 23, "signature": "__init__(self)", "summary": "", "layer": "core", "parent": "CacheManager", "category": "business_logic"}, {"name": "get_redis", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 27, "signature": "async get_redis(self) -> aioredis.Redis", "summary": "Get or create Redis connection.", "layer": "core", "parent": "CacheManager", "docstring": "Get or create Redis connection.", "category": "business_logic"}, {"name": "close", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 37, "signature": "async close(self)", "summary": "Close Redis connection.", "layer": "core", "parent": "CacheManager", "docstring": "Close Redis connection.", "category": "business_logic"}, {"name": "get", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 43, "signature": "async get(self, key: str) -> Optional[str]", "summary": "Get value from cache.", "layer": "core", "parent": "CacheManager", "docstring": "Get value from cache.", "category": "business_logic"}, {"name": "set", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 52, "signature": "async set(self, key: str, value: str, ttl: Optional[timedelta]) -> bool", "summary": "Set value in cache with optional TTL.", "layer": "core", "parent": "CacheManager", "docstring": "Set value in cache with optional TTL.", "category": "business_logic"}, {"name": "delete", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 70, "signature": "async delete(self, key: str) -> bool", "summary": "Delete key from cache.", "layer": "core", "parent": "CacheManager", "docstring": "Delete key from cache.", "category": "business_logic"}, {"name": "delete_pattern", "kind": "async_method", "path": "dealbrain_api/cache.py", "line": 80, "signature": "async delete_pattern(self, pattern: str) -> int", "summary": "Delete all keys matching pattern.", "layer": "core", "parent": "CacheManager", "docstring": "Delete all keys matching pattern.", "category": "business_logic"}, {"name": "cache_key", "kind": "function", "path": "dealbrain_api/cache.py", "line": 97, "signature": "cache_key() -> str", "summary": "Generate cache key from function arguments.", "layer": "core", "docstring": "Generate cache key from function arguments.", "category": "business_logic"}, {"name": "cached", "kind": "function", "path": "dealbrain_api/cache.py", "line": 112, "signature": "cached(prefix: str, ttl: Optional[timedelta], key_func: Optional[Callable])", "summary": "Decorator for caching async function results in Redis.", "layer": "core", "docstring": "Decorator for caching async function results in Redis.\n\nArgs:\n    prefix: Cache key prefix (e.g., \"ruleset\", \"rule_eval\")\n    ttl: Time-to-live for cached values\n    key_func: Optional function to generate cache key from args\n\nExample:\n    @cached(prefix=\"ruleset\", ttl=timedelta(minutes=30))\n    async def get_ruleset(session, ruleset_id: int):\n        ...", "category": "business_logic"}, {"name": "invalidate_cache_pattern", "kind": "async_function", "path": "dealbrain_api/cache.py", "line": 167, "signature": "async invalidate_cache_pattern(pattern: str) -> int", "summary": "Invalidate all cache keys matching pattern.", "layer": "core", "docstring": "Invalidate all cache keys matching pattern.\n\nExample:\n    await invalidate_cache_pattern(\"ruleset:*\")\n    await invalidate_cache_pattern(\"rule_eval:123:*\")", "category": "business_logic"}, {"name": "invalidate_ruleset_cache", "kind": "async_function", "path": "dealbrain_api/cache.py", "line": 178, "signature": "async invalidate_ruleset_cache(ruleset_id: int)", "summary": "Invalidate all cache entries for a ruleset.", "layer": "core", "docstring": "Invalidate all cache entries for a ruleset.", "category": "business_logic"}, {"name": "invalidate_rule_cache", "kind": "async_function", "path": "dealbrain_api/cache.py", "line": 184, "signature": "async invalidate_rule_cache(rule_id: int)", "summary": "Invalidate all cache entries for a rule.", "layer": "core", "docstring": "Invalidate all cache entries for a rule.", "category": "business_logic"}, {"name": "create_app", "kind": "function", "path": "dealbrain_api/app.py", "line": 10, "signature": "create_app() -> FastAPI", "summary": "Create and configure the FastAPI app instance.", "layer": "core", "docstring": "Create and configure the FastAPI app instance.", "category": "business_logic"}, {"name": "AdapterConfig", "kind": "class", "path": "dealbrain_api/settings.py", "line": 16, "signature": "class AdapterConfig(BaseModel)", "summary": "Configuration for a single URL ingestion adapter.", "layer": "core", "docstring": "Configuration for a single URL ingestion adapter.", "category": "config"}, {"name": "IngestionSettings", "kind": "class", "path": "dealbrain_api/settings.py", "line": 41, "signature": "class IngestionSettings(BaseModel)", "summary": "Configuration for URL ingestion system.", "layer": "core", "docstring": "Configuration for URL ingestion system.", "category": "config"}, {"name": "TelemetrySettings", "kind": "class", "path": "dealbrain_api/settings.py", "line": 103, "signature": "class TelemetrySettings(BaseModel)", "summary": "Configuration for application telemetry.", "layer": "core", "docstring": "Configuration for application telemetry.", "category": "config"}, {"name": "Settings", "kind": "class", "path": "dealbrain_api/settings.py", "line": 136, "signature": "class Settings(BaseSettings)", "summary": "", "layer": "core", "category": "config"}, {"name": "model_post_init", "kind": "method", "path": "dealbrain_api/settings.py", "line": 185, "signature": "model_post_init(self, __context) -> None", "summary": "Post-initialization hook to inject API keys into adapter configs.", "layer": "core", "parent": "Settings", "docstring": "Post-initialization hook to inject API keys into adapter configs.", "category": "config"}, {"name": "get_settings", "kind": "function", "path": "dealbrain_api/settings.py", "line": 194, "signature": "get_settings() -> Settings", "summary": "Return cached application settings.", "layer": "core", "docstring": "Return cached application settings.", "category": "config"}, {"name": "ping", "kind": "function", "path": "dealbrain_api/worker.py", "line": 28, "signature": "ping() -> str", "summary": "Simple task to verify the worker wiring.", "layer": "core", "docstring": "Simple task to verify the worker wiring.", "category": "business_logic"}, {"name": "Base", "kind": "class", "path": "dealbrain_api/db.py", "line": 19, "signature": "class Base(DeclarativeBase)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_engine", "kind": "function", "path": "dealbrain_api/db.py", "line": 27, "signature": "get_engine() -> AsyncEngine", "summary": "Return a singleton async engine.", "layer": "core", "docstring": "Return a singleton async engine.", "category": "business_logic"}, {"name": "dispose_engine", "kind": "async_function", "path": "dealbrain_api/db.py", "line": 45, "signature": "async dispose_engine() -> None", "summary": "Dispose the current engine and reset globals.", "layer": "core", "docstring": "Dispose the current engine and reset globals.\n\nThis is necessary when switching event loops (e.g., in Celery workers)\nto prevent \"attached to a different loop\" errors.", "category": "business_logic"}, {"name": "get_session_factory", "kind": "function", "path": "dealbrain_api/db.py", "line": 58, "signature": "get_session_factory() -> async_sessionmaker[AsyncSession]", "summary": "Return a configured session factory.", "layer": "core", "docstring": "Return a configured session factory.", "category": "business_logic"}, {"name": "session_scope", "kind": "async_function", "path": "dealbrain_api/db.py", "line": 67, "signature": "async session_scope() -> AsyncIterator[AsyncSession]", "summary": "Provide a transactional scope for async operations.", "layer": "core", "docstring": "Provide a transactional scope for async operations.", "category": "business_logic"}, {"name": "session_dependency", "kind": "async_function", "path": "dealbrain_api/db.py", "line": 83, "signature": "async session_dependency() -> AsyncIterator[AsyncSession]", "summary": "Dependency for FastAPI routes to inject a session.", "layer": "core", "docstring": "Dependency for FastAPI routes to inject a session.", "category": "business_logic"}, {"name": "dashboard", "kind": "async_function", "path": "dealbrain_api/api/dashboard.py", "line": 16, "signature": "async dashboard(budget: float, session: AsyncSession) -> dict", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "rankings", "kind": "async_function", "path": "dealbrain_api/api/rankings.py", "line": 29, "signature": "async rankings(metric: str, limit: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_entities", "kind": "async_function", "path": "dealbrain_api/api/field_data.py", "line": 16, "signature": "async list_entities() -> dict[str, list[dict[str, str]]]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "entity_schema", "kind": "async_function", "path": "dealbrain_api/api/field_data.py", "line": 30, "signature": "async entity_schema(entity: str, db: AsyncSession) -> dict[str, object]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_entity_records", "kind": "async_function", "path": "dealbrain_api/api/field_data.py", "line": 38, "signature": "async list_entity_records(entity: str, limit: int, offset: int, db: AsyncSession) -> dict[str, object]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_entity_record", "kind": "async_function", "path": "dealbrain_api/api/field_data.py", "line": 51, "signature": "async create_entity_record(entity: str, payload: dict, db: AsyncSession) -> dict[str, object]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "update_entity_record", "kind": "async_function", "path": "dealbrain_api/api/field_data.py", "line": 64, "signature": "async update_entity_record(entity: str, record_id: int, payload: dict, db: AsyncSession) -> dict[str, object]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_import_session", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 49, "signature": "async create_import_session(upload: UploadFile, declared_entities: str | None, db: AsyncSession) -> ImportSessionSnapshotModel", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_import_sessions", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 92, "signature": "async list_import_sessions(db: AsyncSession) -> ImportSessionListModel", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_import_session", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 116, "signature": "async get_import_session(session_id: UUID, db: AsyncSession) -> ImportSessionSnapshotModel", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "update_import_mappings", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 141, "signature": "async update_import_mappings(session_id: UUID, request: UpdateMappingsRequest, db: AsyncSession) -> ImportSessionSnapshotModel", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "refresh_conflicts", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 168, "signature": "async refresh_conflicts(session_id: UUID, db: AsyncSession) -> ImportSessionSnapshotModel", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "commit_import_session", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 193, "signature": "async commit_import_session(session_id: UUID, request: CommitImportRequest, db: AsyncSession) -> CommitImportResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_import_field", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 248, "signature": "async create_import_field(session_id: UUID, request: ImporterFieldCreateRequest, db: AsyncSession) -> ImporterFieldCreateResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "ImportRequest", "kind": "class", "path": "dealbrain_api/api/imports.py", "line": 300, "signature": "class ImportRequest(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "ImportResponse", "kind": "class", "path": "dealbrain_api/api/imports.py", "line": 304, "signature": "class ImportResponse(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "import_workbook", "kind": "async_function", "path": "dealbrain_api/api/imports.py", "line": 311, "signature": "async import_workbook(payload: ImportRequest) -> ImportResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_custom_fields", "kind": "async_function", "path": "dealbrain_api/api/custom_fields.py", "line": 24, "signature": "async list_custom_fields(entity: str | None, include_inactive: bool, include_deleted: bool, db: AsyncSession) -> CustomFieldListResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_custom_field", "kind": "async_function", "path": "dealbrain_api/api/custom_fields.py", "line": 40, "signature": "async create_custom_field(request: CustomFieldCreateRequest, db: AsyncSession) -> CustomFieldResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "update_custom_field", "kind": "async_function", "path": "dealbrain_api/api/custom_fields.py", "line": 67, "signature": "async update_custom_field(field_id: int, request: CustomFieldUpdateRequest, force: bool, db: AsyncSession) -> CustomFieldResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "add_field_option", "kind": "async_function", "path": "dealbrain_api/api/custom_fields.py", "line": 107, "signature": "async add_field_option(field_id: int, request: AddFieldOptionRequest, db: AsyncSession) -> FieldOptionResponse", "summary": "Add a new option to a dropdown or multi-select field.", "layer": "core", "docstring": "Add a new option to a dropdown or multi-select field.\n\nThis endpoint allows inline creation of dropdown options from the UI.\nThe option will be immediately available for selection.\n\nArgs:\n    field_id: ID of the field to add the option to\n    request: Request containing the option value\n    db: Database session\n\nReturns:\n    Updated field with all current options\n\nRaises:\n    404: Field not found\n    400: Invalid field type or duplicate option", "category": "business_logic"}, {"name": "delete_custom_field", "kind": "async_function", "path": "dealbrain_api/api/custom_fields.py", "line": 151, "signature": "async delete_custom_field(field_id: int, hard_delete: bool, force: bool, db: AsyncSession)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_entities_metadata", "kind": "async_function", "path": "dealbrain_api/api/entities.py", "line": 14, "signature": "async get_entities_metadata(db: AsyncSession) -> dict", "summary": "Get metadata for all entities and fields for rule builder.", "layer": "core", "docstring": "Get metadata for all entities and fields for rule builder.", "category": "business_logic"}, {"name": "SettingResponse", "kind": "class", "path": "dealbrain_api/api/settings.py", "line": 14, "signature": "class SettingResponse(BaseModel)", "summary": "Setting response schema.", "layer": "core", "docstring": "Setting response schema.", "category": "config"}, {"name": "SettingUpdateRequest", "kind": "class", "path": "dealbrain_api/api/settings.py", "line": 21, "signature": "class SettingUpdateRequest(BaseModel)", "summary": "Setting update request schema.", "layer": "core", "docstring": "Setting update request schema.", "category": "config"}, {"name": "get_setting", "kind": "async_function", "path": "dealbrain_api/api/settings.py", "line": 28, "signature": "async get_setting(key: str, session: AsyncSession)", "summary": "Get a setting by key.", "layer": "core", "docstring": "Get a setting by key.", "category": "config"}, {"name": "update_setting", "kind": "async_function", "path": "dealbrain_api/api/settings.py", "line": 43, "signature": "async update_setting(key: str, request: SettingUpdateRequest, session: AsyncSession)", "summary": "Update or create a setting.", "layer": "core", "docstring": "Update or create a setting.", "category": "config"}, {"name": "get_valuation_thresholds", "kind": "async_function", "path": "dealbrain_api/api/settings.py", "line": 60, "signature": "async get_valuation_thresholds(session: AsyncSession)", "summary": "Get valuation thresholds (backwards compatibility endpoint).", "layer": "core", "docstring": "Get valuation thresholds (backwards compatibility endpoint).", "category": "config"}, {"name": "require_admin", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 25, "signature": "async require_admin() -> None", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "TaskSubmissionResponse", "kind": "class", "path": "dealbrain_api/api/admin.py", "line": 29, "signature": "class TaskSubmissionResponse(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "ValuationRecalcRequest", "kind": "class", "path": "dealbrain_api/api/admin.py", "line": 37, "signature": "class ValuationRecalcRequest(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "MetricsRecalcRequest", "kind": "class", "path": "dealbrain_api/api/admin.py", "line": 45, "signature": "class MetricsRecalcRequest(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "TaskStatusResponse", "kind": "class", "path": "dealbrain_api/api/admin.py", "line": 49, "signature": "class TaskStatusResponse(BaseModel)", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "trigger_valuation_recalc", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 59, "signature": "async trigger_valuation_recalc(request: ValuationRecalcRequest, _user) -> TaskSubmissionResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "trigger_metric_recalc", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 73, "signature": "async trigger_metric_recalc(request: MetricsRecalcRequest, _user) -> TaskSubmissionResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "trigger_cpu_mark_recalc", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 87, "signature": "async trigger_cpu_mark_recalc(request: MetricsRecalcRequest, _user) -> TaskSubmissionResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "trigger_passmark_import", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 101, "signature": "async trigger_passmark_import(upload: UploadFile, _user) -> TaskSubmissionResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "trigger_entity_import", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 119, "signature": "async trigger_entity_import(entity: str, dry_run: bool, upload: UploadFile, _user) -> TaskSubmissionResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_task_status", "kind": "async_function", "path": "dealbrain_api/api/admin.py", "line": 139, "signature": "async get_task_status(task_id: str, _user) -> TaskStatusResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_baseline_metrics", "kind": "async_function", "path": "dealbrain_api/api/metrics.py", "line": 13, "signature": "async get_baseline_metrics(session: AsyncSession) -> dict", "summary": "Get comprehensive baseline metrics.", "layer": "core", "docstring": "Get comprehensive baseline metrics.\n\nReturns metrics about:\n- Layer influence (% of listings affected by each layer)\n- Top contributing rules by absolute value\n- Override churn rates\n- Current baseline information\n\nReturns:\n    Dictionary with baseline metrics", "category": "business_logic"}, {"name": "get_layer_influence", "kind": "async_function", "path": "dealbrain_api/api/metrics.py", "line": 33, "signature": "async get_layer_influence(session: AsyncSession) -> dict", "summary": "Get percentage of listings influenced by each valuation layer.", "layer": "core", "docstring": "Get percentage of listings influenced by each valuation layer.\n\nReturns:\n    Dictionary with layer names and percentages", "category": "business_logic"}, {"name": "get_top_rules", "kind": "async_function", "path": "dealbrain_api/api/metrics.py", "line": 47, "signature": "async get_top_rules(limit: int, days: int, session: AsyncSession) -> dict", "summary": "Get top rules by absolute contribution amount.", "layer": "core", "docstring": "Get top rules by absolute contribution amount.\n\nArgs:\n    limit: Number of top rules to return (1-50)\n    days: Number of days to look back for aggregation (1-365)\n\nReturns:\n    List of top contributing rules", "category": "business_logic"}, {"name": "get_override_churn", "kind": "async_function", "path": "dealbrain_api/api/metrics.py", "line": 73, "signature": "async get_override_churn(days: int, session: AsyncSession) -> dict", "summary": "Get override churn rate over specified period.", "layer": "core", "docstring": "Get override churn rate over specified period.\n\nArgs:\n    days: Number of days to analyze (1-90)\n\nReturns:\n    Dictionary with churn metrics", "category": "business_logic"}, {"name": "check_baseline_health", "kind": "async_function", "path": "dealbrain_api/api/health.py", "line": 17, "signature": "async check_baseline_health(expected_hash: str | None, session: AsyncSession) -> dict[str, Any]", "summary": "Check health of baseline valuation system.", "layer": "core", "docstring": "Check health of baseline valuation system.\n\nChecks:\n- At least one active baseline ruleset exists\n- Baseline source_hash matches expected (if provided)\n- No stale baselines (warn if > 90 days old)\n- Basic Adjustments group exists in target ruleset\n\nArgs:\n    expected_hash: Expected source hash for baseline (optional)\n\nReturns:\n    Health status with detailed check results", "category": "business_logic"}, {"name": "check_overall_health", "kind": "async_function", "path": "dealbrain_api/api/health.py", "line": 118, "signature": "async check_overall_health(session: AsyncSession) -> dict[str, Any]", "summary": "Check overall system health including baseline subsystem.", "layer": "core", "docstring": "Check overall system health including baseline subsystem.\n\nReturns:\n    Overall health status", "category": "business_logic"}, {"name": "get_baseline_metadata", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 31, "signature": "async get_baseline_metadata(session: AsyncSession)", "summary": "Get metadata for the currently active baseline ruleset.", "layer": "core", "docstring": "Get metadata for the currently active baseline ruleset.\n\nReturns baseline field definitions, version info, and source hash.\nPublic endpoint for UI metadata population.\n\nReturns:\n    BaselineMetadataResponse if active baseline exists, None otherwise", "category": "business_logic"}, {"name": "get_baseline_metadata_alias", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 55, "signature": "async get_baseline_metadata_alias(session: AsyncSession)", "summary": "Alias for /meta endpoint for backwards compatibility.", "layer": "core", "docstring": "Alias for /meta endpoint for backwards compatibility.\n\nReturns:\n    BaselineMetadataResponse if active baseline exists, None otherwise", "category": "business_logic"}, {"name": "instantiate_baseline", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 69, "signature": "async instantiate_baseline(request: BaselineInstantiateRequest, session: AsyncSession)", "summary": "Instantiate a baseline ruleset from a JSON file (idempotent).", "layer": "core", "docstring": "Instantiate a baseline ruleset from a JSON file (idempotent).\n\nIf a ruleset with the same source hash already exists, returns existing\nruleset info with created=false. Otherwise creates new baseline ruleset.\n\nRequires: baseline:admin permission (RBAC integration point)\n\nArgs:\n    request: Contains baseline_path, create_adjustments_group flag, and actor\n\nReturns:\n    BaselineInstantiateResponse with ruleset info and creation status", "category": "business_logic"}, {"name": "diff_baseline", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 129, "signature": "async diff_baseline(request: BaselineDiffRequest, session: AsyncSession)", "summary": "Compare candidate baseline JSON against current active baseline.", "layer": "core", "docstring": "Compare candidate baseline JSON against current active baseline.\n\nReturns field-level granular diff showing added, changed, and removed fields.\n\nRequires: baseline:admin permission (RBAC integration point)\n\nArgs:\n    request: Contains candidate_json and optional actor\n\nReturns:\n    BaselineDiffResponse with added, changed, removed fields and summary", "category": "business_logic"}, {"name": "adopt_baseline", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 164, "signature": "async adopt_baseline(request: BaselineAdoptRequest, session: AsyncSession)", "summary": "Adopt selected changes from candidate baseline, creating new version.", "layer": "core", "docstring": "Adopt selected changes from candidate baseline, creating new version.\n\nCreates a NEW baseline ruleset version with selected changes. Never mutates existing\nrulesets. Previous baseline is deactivated automatically.\n\nRequires: baseline:admin permission (RBAC integration point)\n\nArgs:\n    request: Contains candidate_json, optional selected_changes,\n             trigger_recalculation, and actor\n\nReturns:\n    BaselineAdoptResponse with new ruleset info and audit details", "category": "business_logic"}, {"name": "hydrate_baseline_rules", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 227, "signature": "async hydrate_baseline_rules(ruleset_id: int, request: HydrateBaselineRequest, session: AsyncSession)", "summary": "Hydrate placeholder baseline rules for Advanced mode editing.", "layer": "core", "docstring": "Hydrate placeholder baseline rules for Advanced mode editing.\n\nConverts compact baseline placeholder rules into expanded, editable rules\nwith explicit conditions and actions. This enables the transition from\nBasic mode (compact baseline) to Advanced mode (full rule editing).\n\nRequires: baseline:admin permission (RBAC integration point)\n\nArgs:\n    ruleset_id: ID of the ruleset containing placeholder rules to hydrate\n    request: Contains optional actor field\n\nReturns:\n    HydrateBaselineResponse with status, counts, and hydration summary\n\nRaises:\n    HTTPException: 404 if ruleset not found, 500 if hydration fails", "category": "business_logic"}, {"name": "get_entity_overrides", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 299, "signature": "async get_entity_overrides(entity_key: str, session: AsyncSession)", "summary": "Get all field overrides for an entity.", "layer": "core", "docstring": "Get all field overrides for an entity.\n\nTODO: Implement full override management via Basic Adjustments group.\nFor now, returns empty list to allow UI to load.\n\nArgs:\n    entity_key: Entity identifier (e.g., 'listing', 'cpu', 'gpu')\n\nReturns:\n    List of field overrides (currently empty stub)", "category": "business_logic"}, {"name": "upsert_field_override", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 321, "signature": "async upsert_field_override(override: dict[str, Any], session: AsyncSession)", "summary": "Create or update a field override.", "layer": "core", "docstring": "Create or update a field override.\n\nTODO: Implement by updating modifiers_json in Basic Adjustments group.\nFor now, returns the input unchanged.\n\nArgs:\n    override: Field override data (field_name, entity_key, override_value, etc.)\n\nReturns:\n    The created/updated override (currently echo stub)", "category": "business_logic"}, {"name": "delete_field_override", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 342, "signature": "async delete_field_override(entity_key: str, field_name: str, session: AsyncSession)", "summary": "Delete a specific field override (reset to baseline).", "layer": "core", "docstring": "Delete a specific field override (reset to baseline).\n\nTODO: Implement by removing field from modifiers_json.\n\nArgs:\n    entity_key: Entity identifier\n    field_name: Field name to reset\n\nReturns:\n    Success status", "category": "business_logic"}, {"name": "delete_entity_overrides", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 364, "signature": "async delete_entity_overrides(entity_key: str, session: AsyncSession)", "summary": "Delete all overrides for an entity.", "layer": "core", "docstring": "Delete all overrides for an entity.\n\nTODO: Implement by clearing modifiers_json for entity.\n\nArgs:\n    entity_key: Entity identifier\n\nReturns:\n    Success status", "category": "business_logic"}, {"name": "preview_impact", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 386, "signature": "async preview_impact(entity_key: str | None, sample_size: int, session: AsyncSession)", "summary": "Preview the impact of current overrides on listings.", "layer": "core", "docstring": "Preview the impact of current overrides on listings.\n\nTODO: Implement by running evaluation with/without overrides.\nFor now, returns stub data.\n\nArgs:\n    entity_key: Optional entity filter\n    sample_size: Number of listings to sample\n\nReturns:\n    Preview statistics and sample listings", "category": "business_logic"}, {"name": "export_baseline", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 422, "signature": "async export_baseline(session: AsyncSession)", "summary": "Export current baseline configuration including overrides.", "layer": "core", "docstring": "Export current baseline configuration including overrides.\n\nTODO: Implement by serializing active baseline + overrides.\n\nReturns:\n    Baseline metadata with current overrides applied", "category": "business_logic"}, {"name": "validate_baseline", "kind": "async_function", "path": "dealbrain_api/api/baseline.py", "line": 448, "signature": "async validate_baseline(payload: dict[str, Any], session: AsyncSession)", "summary": "Validate a baseline JSON structure.", "layer": "core", "docstring": "Validate a baseline JSON structure.\n\nTODO: Implement schema validation and constraint checking.\n\nArgs:\n    payload: Contains baseline_json or baseline object\n\nReturns:\n    Validation result with errors/warnings", "category": "business_logic"}, {"name": "list_fields", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 43, "signature": "async list_fields(entity: str | None, include_inactive: bool, include_deleted: bool, db: AsyncSession) -> FieldListResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_field", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 59, "signature": "async create_field(request: FieldCreateRequest, actor: str | None, db: AsyncSession) -> FieldResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "update_field", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 89, "signature": "async update_field(field_id: int, request: FieldUpdateRequest, force: bool, actor: str | None, db: AsyncSession) -> FieldResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "delete_field", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 132, "signature": "async delete_field(field_id: int, hard_delete: bool, force: bool, actor: str | None, db: AsyncSession) -> FieldDeleteResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "field_history", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 171, "signature": "async field_history(field_id: int, limit: int, db: AsyncSession) -> FieldAuditResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "field_usage", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 197, "signature": "async field_usage(entity: str | None, db: AsyncSession) -> FieldUsageResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_field_values", "kind": "async_function", "path": "dealbrain_api/api/fields.py", "line": 211, "signature": "async get_field_values(field_name: str, limit: int, search: str | None, db: AsyncSession) -> FieldValuesResponse", "summary": "Get distinct values for a field across all entities.", "layer": "core", "docstring": "Get distinct values for a field across all entities.\n\n**Examples:**\n- `/fields/listing.condition/values` -> [\"New\", \"Like New\", \"Good\", \"Fair\"]\n- `/fields/cpu.manufacturer/values?limit=5` -> [\"Intel\", \"AMD\", \"Apple\", ...]\n- `/fields/listing.seller/values?search=ebay` -> [\"ebay_seller_1\", \"ebay_seller_2\"]", "category": "business_logic"}, {"name": "parse_csv_file", "kind": "function", "path": "dealbrain_api/api/ingestion.py", "line": 38, "signature": "parse_csv_file(content: bytes) -> list[str]", "summary": "Parse CSV file content and extract URLs.", "layer": "core", "docstring": "Parse CSV file content and extract URLs.\n\nExpected CSV format:\n    url\n    https://www.ebay.com/itm/123456789\n    https://www.amazon.com/dp/B08N5WRWNW\n\nArgs:\n    content: Raw CSV file bytes\n\nReturns:\n    List of URL strings\n\nRaises:\n    ValueError: If CSV is invalid or missing 'url' column", "category": "business_logic"}, {"name": "parse_json_file", "kind": "function", "path": "dealbrain_api/api/ingestion.py", "line": 82, "signature": "parse_json_file(content: bytes) -> list[str]", "summary": "Parse JSON file content and extract URLs.", "layer": "core", "docstring": "Parse JSON file content and extract URLs.\n\nExpected JSON format:\n    [\n      {\"url\": \"https://www.ebay.com/itm/123456789\"},\n      {\"url\": \"https://www.amazon.com/dp/B08N5WRWNW\"}\n    ]\n\nArgs:\n    content: Raw JSON file bytes\n\nReturns:\n    List of URL strings\n\nRaises:\n    ValueError: If JSON is invalid or missing 'url' fields", "category": "business_logic"}, {"name": "create_bulk_url_import", "kind": "async_function", "path": "dealbrain_api/api/ingestion.py", "line": 136, "signature": "async create_bulk_url_import(file: UploadFile, session: AsyncSession) -> BulkIngestionResponse", "summary": "Create a bulk URL import job from CSV or JSON file upload.", "layer": "core", "docstring": "Create a bulk URL import job from CSV or JSON file upload.\n\nThis endpoint accepts a file upload (CSV or JSON format) containing up to 1000 URLs,\ncreates a parent ImportSession and child sessions for each URL, and queues Celery tasks\nfor asynchronous processing.\n\nFile Formats:\n\nCSV format (header: url):\n```csv\nurl\nhttps://www.ebay.com/itm/123456789\nhttps://www.amazon.com/dp/B08N5WRWNW\n```\n\nJSON format:\n```json\n[\n  {\"url\": \"https://www.ebay.com/itm/123456789\"},\n  {\"url\": \"https://www.amazon.com/dp/B08N5WRWNW\"}\n]\n```\n\nArgs:\n    file: Uploaded CSV or JSON file (multipart/form-data)\n    session: Database session (injected)\n\nReturns:\n    BulkIngestionResponse with bulk_job_id and total_urls\n\nRaises:\n    HTTPException:\n        400: Invalid file format, empty file, or parse errors\n        413: More than 1000 URLs in file\n        422: Invalid URL format in file\n        500: Unexpected server errors\n\nExample:\n    POST /api/v1/ingest/bulk\n    Content-Type: multipart/form-data\n    file: urls.csv\n\n    Response (202):\n    {\n        \"bulk_job_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n        \"total_urls\": 42\n    }", "category": "business_logic"}, {"name": "create_single_url_import", "kind": "async_function", "path": "dealbrain_api/api/ingestion.py", "line": 362, "signature": "async create_single_url_import(request: IngestionRequest, session: AsyncSession) -> IngestionResponse", "summary": "Create a single URL import job and queue it for processing.", "layer": "core", "docstring": "Create a single URL import job and queue it for processing.\n\nThis endpoint accepts a URL, validates it, creates an ImportSession record,\nand queues a Celery task for asynchronous ingestion. The task will:\n1. Fetch and parse the URL using the adapter router\n2. Extract product data (title, price, specs, etc.)\n3. Create or update a Listing record\n4. Store provenance and quality metadata\n\nArgs:\n    request: IngestionRequest containing URL and optional priority\n    session: Database session (injected)\n\nReturns:\n    IngestionResponse with job_id and status='queued'\n\nRaises:\n    HTTPException: For validation errors (422) or server errors (500)\n\nExample:\n    POST /api/v1/ingest/single\n    {\n        \"url\": \"https://www.ebay.com/itm/123456789012\",\n        \"priority\": \"normal\"\n    }\n\n    Response (202):\n    {\n        \"job_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n        \"status\": \"queued\",\n        \"listing_id\": null,\n        \"provenance\": null,\n        \"quality\": null,\n        \"errors\": []\n    }", "category": "business_logic"}, {"name": "get_ingestion_status", "kind": "async_function", "path": "dealbrain_api/api/ingestion.py", "line": 461, "signature": "async get_ingestion_status(job_id: str, session: AsyncSession) -> IngestionResponse", "summary": "Retrieve the status of an ingestion job.", "layer": "core", "docstring": "Retrieve the status of an ingestion job.\n\nThis endpoint fetches the ImportSession record and returns the current status,\nalong with any results (listing_id, provenance, quality) or errors.\n\nArgs:\n    job_id: ImportSession UUID as string\n    session: Database session (injected)\n\nReturns:\n    IngestionResponse with job status and results\n\nRaises:\n    HTTPException: 404 if job not found, 422 if invalid UUID format\n\nExample:\n    GET /api/v1/ingest/550e8400-e29b-41d4-a716-446655440000\n\n    Response (200):\n    {\n        \"job_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n        \"status\": \"complete\",\n        \"listing_id\": 123,\n        \"provenance\": \"ebay_api\",\n        \"quality\": \"full\",\n        \"errors\": []\n    }", "category": "business_logic"}, {"name": "get_bulk_ingestion_status", "kind": "async_function", "path": "dealbrain_api/api/ingestion.py", "line": 563, "signature": "async get_bulk_ingestion_status(bulk_job_id: str, offset: int, limit: int, session: AsyncSession) -> BulkIngestionStatusResponse", "summary": "Retrieve the aggregated status of a bulk URL ingestion job.", "layer": "core", "docstring": "Retrieve the aggregated status of a bulk URL ingestion job.\n\nThis endpoint fetches the parent ImportSession and all child ImportSession records\nfor a bulk job, aggregates status counts, and returns per-URL status information\nwith pagination support.\n\nStatus Aggregation Logic:\n- total_urls: Total number of URLs in the bulk job\n- completed: Number of URLs finished (complete + partial + failed)\n- success: Number of URLs successfully completed (complete only)\n- partial: Number of partially completed URLs\n- failed: Number of failed URLs\n- running: Number of URLs currently being processed\n- queued: Number of URLs waiting to be processed\n\nOverall Status Logic:\n- \"queued\": All children are queued\n- \"running\": At least one child is running or queued (but not all queued)\n- \"complete\": All children are complete/partial/failed (100% done)\n- \"partial\": Some children complete and some failed\n- \"failed\": All children failed\n\nArgs:\n    bulk_job_id: Parent ImportSession UUID as string\n    offset: Pagination offset (default: 0)\n    limit: Pagination limit (default: 100, max: 1000)\n    session: Database session (injected)\n\nReturns:\n    BulkIngestionStatusResponse with aggregated status and per-URL details\n\nRaises:\n    HTTPException:\n        404: Bulk job not found\n        422: Invalid UUID format\n        500: Unexpected server errors\n\nExample:\n    GET /api/v1/ingest/bulk/550e8400-e29b-41d4-a716-446655440000?offset=0&limit=50\n\n    Response (200):\n    {\n        \"bulk_job_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n        \"status\": \"running\",\n        \"total_urls\": 42,\n        \"completed\": 30,\n        \"success\": 25,\n        \"partial\": 3,\n        \"failed\": 2,\n        \"running\": 5,\n        \"queued\": 7,\n        \"per_row_status\": [\n            {\n                \"url\": \"https://ebay.com/itm/123\",\n                \"status\": \"complete\",\n                \"listing_id\": 456,\n                \"error\": null\n            },\n            ...\n        ],\n        \"offset\": 0,\n        \"limit\": 50,\n        \"has_more\": false\n    }", "category": "business_logic"}, {"name": "create_ruleset", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 61, "signature": "async create_ruleset(request: RulesetCreateRequest, session: AsyncSession)", "summary": "Create a new valuation ruleset", "layer": "core", "docstring": "Create a new valuation ruleset", "category": "business_logic"}, {"name": "list_rulesets", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 95, "signature": "async list_rulesets(active_only: bool, skip: int, limit: int, session: AsyncSession)", "summary": "List all valuation rulesets", "layer": "core", "docstring": "List all valuation rulesets", "category": "business_logic"}, {"name": "get_ruleset", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 130, "signature": "async get_ruleset(ruleset_id: int, session: AsyncSession)", "summary": "Get a ruleset by ID with all groups and rules", "layer": "core", "docstring": "Get a ruleset by ID with all groups and rules", "category": "business_logic"}, {"name": "update_ruleset", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 223, "signature": "async update_ruleset(ruleset_id: int, request: RulesetUpdateRequest, session: AsyncSession)", "summary": "Update a ruleset", "layer": "core", "docstring": "Update a ruleset", "category": "business_logic"}, {"name": "delete_ruleset", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 255, "signature": "async delete_ruleset(ruleset_id: int, session: AsyncSession)", "summary": "Delete a ruleset (cascades to groups and rules)", "layer": "core", "docstring": "Delete a ruleset (cascades to groups and rules)", "category": "business_logic"}, {"name": "create_rule_group", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 272, "signature": "async create_rule_group(request: RuleGroupCreateRequest, session: AsyncSession)", "summary": "Create a new rule group", "layer": "core", "docstring": "Create a new rule group", "category": "business_logic"}, {"name": "list_rule_groups", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 322, "signature": "async list_rule_groups(ruleset_id: int | None, category: str | None, session: AsyncSession) -> list[RuleGroupResponse]", "summary": "List rule groups", "layer": "core", "docstring": "List rule groups", "category": "business_logic"}, {"name": "get_rule_group", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 366, "signature": "async get_rule_group(group_id: int, session: AsyncSession) -> RuleGroupResponse", "summary": "Get a rule group by ID", "layer": "core", "docstring": "Get a rule group by ID", "category": "business_logic"}, {"name": "update_rule_group", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 439, "signature": "async update_rule_group(group_id: int, request: RuleGroupUpdateRequest, session: AsyncSession) -> RuleGroupResponse", "summary": "Update a rule group", "layer": "core", "docstring": "Update a rule group", "category": "business_logic"}, {"name": "create_rule", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 503, "signature": "async create_rule(request: RuleCreateRequest, session: AsyncSession)", "summary": "Create a new valuation rule", "layer": "core", "docstring": "Create a new valuation rule", "category": "business_logic"}, {"name": "list_rules", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 557, "signature": "async list_rules(group_id: int | None, active_only: bool, skip: int, limit: int, session: AsyncSession)", "summary": "List valuation rules", "layer": "core", "docstring": "List valuation rules", "category": "business_logic"}, {"name": "get_rule", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 616, "signature": "async get_rule(rule_id: int, session: AsyncSession)", "summary": "Get a valuation rule by ID", "layer": "core", "docstring": "Get a valuation rule by ID", "category": "business_logic"}, {"name": "update_rule", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 666, "signature": "async update_rule(rule_id: int, request: RuleUpdateRequest, session: AsyncSession)", "summary": "Update a valuation rule", "layer": "core", "docstring": "Update a valuation rule", "category": "business_logic"}, {"name": "delete_rule", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 739, "signature": "async delete_rule(rule_id: int, session: AsyncSession)", "summary": "Delete a valuation rule", "layer": "core", "docstring": "Delete a valuation rule", "category": "business_logic"}, {"name": "preview_rule", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 767, "signature": "async preview_rule(request: RulePreviewRequest, session: AsyncSession)", "summary": "Preview impact of a rule before saving", "layer": "core", "docstring": "Preview impact of a rule before saving", "category": "business_logic"}, {"name": "validate_formula", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 789, "signature": "async validate_formula(request: FormulaValidationRequest, session: AsyncSession)", "summary": "Validate a formula and provide preview calculation.", "layer": "core", "docstring": "Validate a formula and provide preview calculation.\n\nThis endpoint:\n- Validates formula syntax\n- Checks field availability against entity metadata\n- Calculates preview with sample data (either provided or from database)\n- Returns list of used fields from formula\n- Provides helpful error messages with suggestions\n\nExample formulas:\n- \"ram_gb * 2.5\" - Simple per-GB pricing\n- \"cpu_mark_multi / 1000 * 5.0\" - Benchmark-based calculation\n- \"max(ram_gb * 2.5, 50)\" - Minimum value enforcement\n- \"ram_gb * 2.5 if ram_gb >= 16 else ram_gb * 3.0\" - Conditional pricing", "category": "business_logic"}, {"name": "evaluate_listing", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 860, "signature": "async evaluate_listing(listing_id: int, ruleset_id: int | None, session: AsyncSession)", "summary": "Evaluate a single listing with a ruleset", "layer": "core", "docstring": "Evaluate a single listing with a ruleset", "category": "business_logic"}, {"name": "apply_ruleset", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 876, "signature": "async apply_ruleset(request: ApplyRulesetRequest, session: AsyncSession)", "summary": "Apply a ruleset to listings", "layer": "core", "docstring": "Apply a ruleset to listings", "category": "business_logic"}, {"name": "get_audit_log", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 907, "signature": "async get_audit_log(rule_id: int | None, limit: int, session: AsyncSession)", "summary": "Get audit log for rules", "layer": "core", "docstring": "Get audit log for rules", "category": "business_logic"}, {"name": "export_ruleset_package", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 933, "signature": "async export_ruleset_package(ruleset_id: int, request: PackageMetadataRequest, session: AsyncSession)", "summary": "Export a ruleset as a .dbrs package file", "layer": "core", "docstring": "Export a ruleset as a .dbrs package file", "category": "business_logic"}, {"name": "install_ruleset_package", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 984, "signature": "async install_ruleset_package(file: UploadFile, actor: str, merge_strategy: str, session: AsyncSession)", "summary": "Install a .dbrs package file", "layer": "core", "docstring": "Install a .dbrs package file", "category": "business_logic"}, {"name": "preview_package_export", "kind": "async_function", "path": "dealbrain_api/api/rules.py", "line": 1023, "signature": "async preview_package_export(ruleset_id: int, request: PackageMetadataRequest, session: AsyncSession)", "summary": "Preview what will be included in a package export", "layer": "core", "docstring": "Preview what will be included in a package export", "category": "business_logic"}, {"name": "list_cpus", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 37, "signature": "async list_cpus(session: AsyncSession) -> Sequence[CpuRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_cpu", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 43, "signature": "async get_cpu(cpu_id: int, session: AsyncSession) -> CpuRead", "summary": "Get a single CPU by ID.", "layer": "core", "docstring": "Get a single CPU by ID.", "category": "business_logic"}, {"name": "create_cpu", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 52, "signature": "async create_cpu(payload: CpuCreate, session: AsyncSession) -> CpuRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_gpus", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 65, "signature": "async list_gpus(session: AsyncSession) -> Sequence[GpuRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_gpu", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 71, "signature": "async get_gpu(gpu_id: int, session: AsyncSession) -> GpuRead", "summary": "Get a single GPU by ID.", "layer": "core", "docstring": "Get a single GPU by ID.", "category": "business_logic"}, {"name": "create_gpu", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 80, "signature": "async create_gpu(payload: GpuCreate, session: AsyncSession) -> GpuRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_profiles", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 93, "signature": "async list_profiles(session: AsyncSession) -> Sequence[ProfileRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_profile", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 101, "signature": "async create_profile(payload: ProfileCreate, session: AsyncSession) -> ProfileRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_ports_profiles", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 116, "signature": "async list_ports_profiles(session: AsyncSession) -> Sequence[PortsProfileRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "create_ports_profile", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 127, "signature": "async create_ports_profile(payload: PortsProfileCreate, session: AsyncSession) -> PortsProfileRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_ram_specs", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 145, "signature": "async list_ram_specs(search: str | None, generation: RamGeneration | None, min_capacity_gb: int | None, max_capacity_gb: int | None, limit: int, session: AsyncSession) -> Sequence[RamSpecRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_ram_spec", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 182, "signature": "async get_ram_spec(ram_spec_id: int, session: AsyncSession) -> RamSpecRead", "summary": "Get a single RAM specification by ID.", "layer": "core", "docstring": "Get a single RAM specification by ID.", "category": "business_logic"}, {"name": "create_ram_spec", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 193, "signature": "async create_ram_spec(payload: RamSpecCreate, session: AsyncSession) -> RamSpecRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "list_storage_profiles", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 204, "signature": "async list_storage_profiles(search: str | None, medium: StorageMedium | None, min_capacity_gb: int | None, max_capacity_gb: int | None, limit: int, session: AsyncSession) -> Sequence[StorageProfileRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_storage_profile", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 241, "signature": "async get_storage_profile(storage_profile_id: int, session: AsyncSession) -> StorageProfileRead", "summary": "Get a single storage profile by ID.", "layer": "core", "docstring": "Get a single storage profile by ID.", "category": "business_logic"}, {"name": "create_storage_profile", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 257, "signature": "async create_storage_profile(payload: StorageProfileCreate, session: AsyncSession) -> StorageProfileRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_cpu_listings", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 275, "signature": "async get_cpu_listings(cpu_id: int, limit: int, offset: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "Get all listings that use this CPU.", "layer": "core", "docstring": "Get all listings that use this CPU.", "category": "business_logic"}, {"name": "get_gpu_listings", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 304, "signature": "async get_gpu_listings(gpu_id: int, limit: int, offset: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "Get all listings that use this GPU.", "layer": "core", "docstring": "Get all listings that use this GPU.", "category": "business_logic"}, {"name": "get_ram_spec_listings", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 333, "signature": "async get_ram_spec_listings(ram_spec_id: int, limit: int, offset: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "Get all listings that use this RAM specification.", "layer": "core", "docstring": "Get all listings that use this RAM specification.", "category": "business_logic"}, {"name": "get_storage_profile_listings", "kind": "async_function", "path": "dealbrain_api/api/catalog.py", "line": 362, "signature": "async get_storage_profile_listings(storage_profile_id: int, limit: int, offset: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "Get all listings that use this storage profile (either primary or secondary).", "layer": "core", "docstring": "Get all listings that use this storage profile (either primary or secondary).", "category": "business_logic"}, {"name": "TelemetryLogEntry", "kind": "class", "path": "dealbrain_api/api/telemetry.py", "line": 17, "signature": "class TelemetryLogEntry(BaseModel)", "summary": "Payload for frontend telemetry submissions.", "layer": "core", "docstring": "Payload for frontend telemetry submissions.", "category": "business_logic"}, {"name": "ingest_telemetry_log", "kind": "async_function", "path": "dealbrain_api/api/telemetry.py", "line": 29, "signature": "async ingest_telemetry_log(entry: TelemetryLogEntry, request: Request) -> dict[str, bool]", "summary": "Accept telemetry events from the frontend and emit to backend logger.", "layer": "core", "docstring": "Accept telemetry events from the frontend and emit to backend logger.", "category": "business_logic"}, {"name": "list_listings", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 197, "signature": "async list_listings(limit: int, offset: int, session: AsyncSession) -> Sequence[ListingRead]", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_paginated_listings_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 208, "signature": "async get_paginated_listings_endpoint(limit: int, cursor: str | None, sort_by: str, sort_order: str, form_factor: str | None, manufacturer: str | None, min_price: float | None, max_price: float | None, session: AsyncSession) -> PaginatedListingsResponse", "summary": "Get paginated listings with cursor-based pagination.", "layer": "core", "docstring": "Get paginated listings with cursor-based pagination.\n\nThis endpoint implements high-performance cursor-based pagination with:\n- Composite key (sort_column, id) for stable pagination\n- Base64-encoded cursors to prevent client manipulation\n- Cached total count (5 minutes TTL)\n- Support for dynamic sorting and filtering\n\nPerformance: <100ms response time for 500-row pages.\n\nQuery Parameters:\n    limit: Number of items per page (1-500, default 50)\n    cursor: Pagination cursor from previous response (optional)\n    sort_by: Column to sort by (default \"updated_at\")\n    sort_order: Sort direction (\"asc\" or \"desc\", default \"desc\")\n    form_factor: Filter by form factor (optional)\n    manufacturer: Filter by manufacturer (optional)\n    min_price: Minimum price filter (optional)\n    max_price: Maximum price filter (optional)\n\nReturns:\n    PaginatedListingsResponse with:\n    - items: List of listings in current page\n    - total: Total count of listings (cached)\n    - limit: Requested page size\n    - next_cursor: Cursor for next page (null if last page)\n    - has_next: Whether more pages are available\n\nExample:\n    GET /v1/listings/paginated?limit=50&sort_by=price_usd&sort_order=asc\n    GET /v1/listings/paginated?cursor=eyJpZCI6MTIzLCJzb3J0X3ZhbHVlIjoiMjAyNC0wMS0wMVQwMDowMDowMCJ9&limit=50\n\nRaises:\n    400: Invalid parameters (invalid sort column, cursor format, etc.)\n    500: Server error", "category": "business_logic"}, {"name": "create_listing_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 280, "signature": "async create_listing_endpoint(payload: ListingCreate, session: AsyncSession) -> ListingRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_listing_schema", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 298, "signature": "async get_listing_schema(session: AsyncSession) -> ListingSchemaResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_listing", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 305, "signature": "async get_listing(listing_id: int, session: AsyncSession) -> ListingRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "update_listing_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 313, "signature": "async update_listing_endpoint(listing_id: int, payload: ListingCreate, session: AsyncSession) -> ListingRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "patch_listing_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 334, "signature": "async patch_listing_endpoint(listing_id: int, request: ListingPartialUpdateRequest, session: AsyncSession) -> ListingRead", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "delete_listing_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 352, "signature": "async delete_listing_endpoint(listing_id: int, session: AsyncSession) -> None", "summary": "Delete a listing and all related data.", "layer": "core", "docstring": "Delete a listing and all related data.\n\nCascade deletes:\n- ListingComponent records\n- ListingScoreSnapshot records\n- RawPayload records\n- EntityFieldValue records for this listing\n\nReturns:\n    204 No Content on success\n\nRaises:\n    HTTPException 404: Listing not found", "category": "business_logic"}, {"name": "update_listing_valuation_overrides", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 392, "signature": "async update_listing_valuation_overrides(listing_id: int, request: ListingValuationOverrideRequest, session: AsyncSession) -> ListingValuationOverrideResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "bulk_update_listings_endpoint", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 425, "signature": "async bulk_update_listings_endpoint(request: ListingBulkUpdateRequest, session: AsyncSession) -> ListingBulkUpdateResponse", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "get_valuation_breakdown", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 446, "signature": "async get_valuation_breakdown(listing_id: int, session: AsyncSession) -> ValuationBreakdownResponse", "summary": "Get detailed valuation breakdown for a listing.", "layer": "core", "docstring": "Get detailed valuation breakdown for a listing.\n\nThis endpoint returns the detailed breakdown of how a listing's adjusted price\nwas calculated, including all applied rules and their individual contributions,\nas well as inactive rules from the same ruleset.\n\nArgs:\n    listing_id: ID of the listing to get breakdown for\n    session: Database session\n\nReturns:\n    Detailed valuation breakdown with enriched rule metadata\n\nRaises:\n    404: Listing not found", "category": "business_logic"}, {"name": "recalculate_listing_metrics", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 612, "signature": "async recalculate_listing_metrics(listing_id: int, session: AsyncSession)", "summary": "Recalculate all performance metrics for a listing.", "layer": "core", "docstring": "Recalculate all performance metrics for a listing.", "category": "business_logic"}, {"name": "bulk_recalculate_metrics", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 625, "signature": "async bulk_recalculate_metrics(request: BulkRecalculateRequest, session: AsyncSession)", "summary": "Recalculate metrics for multiple listings.", "layer": "core", "docstring": "Recalculate metrics for multiple listings.\n\nIf listing_ids is None or empty, updates all listings.", "category": "business_logic"}, {"name": "update_listing_ports", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 644, "signature": "async update_listing_ports(listing_id: int, request: UpdatePortsRequest, session: AsyncSession)", "summary": "Create or update ports for a listing.", "layer": "core", "docstring": "Create or update ports for a listing.", "category": "business_logic"}, {"name": "get_listing_ports", "kind": "async_function", "path": "dealbrain_api/api/listings.py", "line": 660, "signature": "async get_listing_ports(listing_id: int, session: AsyncSession)", "summary": "Get ports for a listing.", "layer": "core", "docstring": "Get ports for a listing.", "category": "business_logic"}, {"name": "MappingSuggestionModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 14, "signature": "class MappingSuggestionModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldMappingModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 20, "signature": "class FieldMappingModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "EntityMappingModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 31, "signature": "class EntityMappingModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "SheetColumnModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 36, "signature": "class SheetColumnModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "SheetMetaModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 41, "signature": "class SheetMetaModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ComponentMatchSuggestionModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 51, "signature": "class ComponentMatchSuggestionModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ComponentMatchModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 56, "signature": "class ComponentMatchModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "EntityPreviewModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 64, "signature": "class EntityPreviewModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CpuConflictFieldModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 72, "signature": "class CpuConflictFieldModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CpuConflictModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 78, "signature": "class CpuConflictModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ImportSessionSnapshotModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 85, "signature": "class ImportSessionSnapshotModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ImportSessionListModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 100, "signature": "class ImportSessionListModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "UpdateFieldMappingPayload", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 104, "signature": "class UpdateFieldMappingPayload(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "UpdateEntityMappingPayload", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 110, "signature": "class UpdateEntityMappingPayload(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "UpdateMappingsRequest", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 115, "signature": "class UpdateMappingsRequest(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ConflictResolutionModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 119, "signature": "class ConflictResolutionModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ComponentOverrideModel", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 125, "signature": "class ComponentOverrideModel(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CommitImportRequest", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 132, "signature": "class CommitImportRequest(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CommitImportResponse", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 138, "signature": "class CommitImportResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ImporterFieldCreateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 145, "signature": "class ImporterFieldCreateRequest(CustomFieldCreateRequest)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ImporterFieldCreateResponse", "kind": "class", "path": "dealbrain_api/api/schemas/imports.py", "line": 149, "signature": "class ImporterFieldCreateResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CustomFieldCreateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 16, "signature": "class CustomFieldCreateRequest(CustomFieldDefinitionCreate)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CustomFieldUpdateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 20, "signature": "class CustomFieldUpdateRequest(CustomFieldDefinitionUpdate)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CustomFieldResponse", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 24, "signature": "class CustomFieldResponse(CustomFieldDefinitionRead)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "CustomFieldListResponse", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 28, "signature": "class CustomFieldListResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "AddFieldOptionRequest", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 32, "signature": "class AddFieldOptionRequest(BaseModel)", "summary": "Request to add an option to a dropdown/multi-select field", "layer": "schema", "docstring": "Request to add an option to a dropdown/multi-select field", "category": "business_logic"}, {"name": "FieldOptionResponse", "kind": "class", "path": "dealbrain_api/api/schemas/custom_fields.py", "line": 37, "signature": "class FieldOptionResponse(BaseModel)", "summary": "Response with updated field options", "layer": "schema", "docstring": "Response with updated field options", "category": "business_logic"}, {"name": "FieldCreateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 16, "signature": "class FieldCreateRequest(CustomFieldDefinitionCreate)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldUpdateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 20, "signature": "class FieldUpdateRequest(CustomFieldDefinitionUpdate)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 24, "signature": "class FieldResponse(CustomFieldDefinitionRead)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldListResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 28, "signature": "class FieldListResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldAuditEntry", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 32, "signature": "class FieldAuditEntry(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldAuditResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 42, "signature": "class FieldAuditResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldUsageRecord", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 46, "signature": "class FieldUsageRecord(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldUsageResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 54, "signature": "class FieldUsageResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldDeleteResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 58, "signature": "class FieldDeleteResponse(FieldUsageRecord)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "FieldValuesResponse", "kind": "class", "path": "dealbrain_api/api/schemas/fields.py", "line": 62, "signature": "class FieldValuesResponse(BaseModel)", "summary": "Response schema for field values endpoint.", "layer": "schema", "docstring": "Response schema for field values endpoint.", "category": "business_logic"}, {"name": "ListingFieldSchema", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 14, "signature": "class ListingFieldSchema(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ListingSchemaResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 26, "signature": "class ListingSchemaResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ListingPartialUpdateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 31, "signature": "class ListingPartialUpdateRequest(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "coerce_reference_fields", "kind": "method", "path": "dealbrain_api/api/schemas/listings.py", "line": 37, "signature": "coerce_reference_fields(cls, v: dict[str, Any] | None) -> dict[str, Any] | None", "summary": "Coerce reference identifiers to integers when provided as strings.", "layer": "schema", "parent": "ListingPartialUpdateRequest", "docstring": "Coerce reference identifiers to integers when provided as strings.", "category": "business_logic"}, {"name": "ListingBulkUpdateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 66, "signature": "class ListingBulkUpdateRequest(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "coerce_bulk_reference_fields", "kind": "method", "path": "dealbrain_api/api/schemas/listings.py", "line": 73, "signature": "coerce_bulk_reference_fields(cls, v: dict[str, Any] | None) -> dict[str, Any] | None", "summary": "", "layer": "schema", "parent": "ListingBulkUpdateRequest", "category": "business_logic"}, {"name": "ListingBulkUpdateResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 85, "signature": "class ListingBulkUpdateResponse(BaseModel)", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "ValuationAdjustmentAction", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 90, "signature": "class ValuationAdjustmentAction(BaseModel)", "summary": "Breakdown of an individual action contributing to a rule adjustment.", "layer": "schema", "docstring": "Breakdown of an individual action contributing to a rule adjustment.", "category": "business_logic"}, {"name": "ValuationAdjustmentDetail", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 99, "signature": "class ValuationAdjustmentDetail(BaseModel)", "summary": "Details of a rule adjustment applied during valuation.", "layer": "schema", "docstring": "Details of a rule adjustment applied during valuation.", "category": "business_logic"}, {"name": "LegacyValuationLine", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 113, "signature": "class LegacyValuationLine(BaseModel)", "summary": "Legacy component deduction line retained for backwards compatibility.", "layer": "schema", "docstring": "Legacy component deduction line retained for backwards compatibility.", "category": "business_logic"}, {"name": "ValuationBreakdownResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 124, "signature": "class ValuationBreakdownResponse(BaseModel)", "summary": "Detailed breakdown of listing valuation calculation.", "layer": "schema", "docstring": "Detailed breakdown of listing valuation calculation.", "category": "business_logic"}, {"name": "BulkRecalculateRequest", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 145, "signature": "class BulkRecalculateRequest(BaseModel)", "summary": "Request to recalculate metrics for multiple listings", "layer": "schema", "docstring": "Request to recalculate metrics for multiple listings", "category": "business_logic"}, {"name": "BulkRecalculateResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 150, "signature": "class BulkRecalculateResponse(BaseModel)", "summary": "Response after bulk metric recalculation", "layer": "schema", "docstring": "Response after bulk metric recalculation", "category": "business_logic"}, {"name": "PortEntry", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 156, "signature": "class PortEntry(BaseModel)", "summary": "Single port entry with type and quantity", "layer": "schema", "docstring": "Single port entry with type and quantity", "category": "business_logic"}, {"name": "UpdatePortsRequest", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 162, "signature": "class UpdatePortsRequest(BaseModel)", "summary": "Request to update ports for a listing", "layer": "schema", "docstring": "Request to update ports for a listing", "category": "business_logic"}, {"name": "PortsResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 167, "signature": "class PortsResponse(BaseModel)", "summary": "Response with ports data", "layer": "schema", "docstring": "Response with ports data", "category": "business_logic"}, {"name": "ListingValuationOverrideRequest", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 172, "signature": "class ListingValuationOverrideRequest(BaseModel)", "summary": "Request schema for managing listing-level ruleset overrides.", "layer": "schema", "docstring": "Request schema for managing listing-level ruleset overrides.", "category": "business_logic"}, {"name": "validate_ruleset_id", "kind": "method", "path": "dealbrain_api/api/schemas/listings.py", "line": 186, "signature": "validate_ruleset_id(cls, value: int | None, info) -> int | None", "summary": "", "layer": "schema", "parent": "ListingValuationOverrideRequest", "category": "business_logic"}, {"name": "ListingValuationOverrideResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 193, "signature": "class ListingValuationOverrideResponse(BaseModel)", "summary": "Response describing the current listing valuation override state.", "layer": "schema", "docstring": "Response describing the current listing valuation override state.", "category": "business_logic"}, {"name": "PaginatedListingsResponse", "kind": "class", "path": "dealbrain_api/api/schemas/listings.py", "line": 200, "signature": "class PaginatedListingsResponse(BaseModel)", "summary": "Cursor-based paginated listings response.", "layer": "schema", "docstring": "Cursor-based paginated listings response.", "category": "business_logic"}, {"name": "__getattr__", "kind": "function", "path": "dealbrain_api/importers/__init__.py", "line": 8, "signature": "__getattr__(name: str)", "summary": "", "layer": "core", "category": "config"}, {"name": "__dir__", "kind": "function", "path": "dealbrain_api/importers/__init__.py", "line": 16, "signature": "__dir__() -> list[str]", "summary": "", "layer": "core", "category": "config"}, {"name": "ImportSummary", "kind": "class", "path": "dealbrain_api/importers/excel.py", "line": 26, "signature": "class ImportSummary", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "SpreadsheetImporter", "kind": "class", "path": "dealbrain_api/importers/excel.py", "line": 35, "signature": "class SpreadsheetImporter", "summary": "Parse the Excel workbook that backs the Deal Brain catalog.", "layer": "core", "docstring": "Parse the Excel workbook that backs the Deal Brain catalog.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/importers/excel.py", "line": 38, "signature": "__init__(self, path: Path) -> None", "summary": "", "layer": "core", "parent": "SpreadsheetImporter", "category": "business_logic"}, {"name": "load", "kind": "method", "path": "dealbrain_api/importers/excel.py", "line": 41, "signature": "load(self) -> tuple[SpreadsheetSeed, ImportSummary]", "summary": "", "layer": "core", "parent": "SpreadsheetImporter", "category": "business_logic"}, {"name": "EntityConfig", "kind": "class", "path": "dealbrain_api/importers/universal.py", "line": 28, "signature": "class EntityConfig", "summary": "Configuration describing how to map a payload into a seed list.", "layer": "core", "docstring": "Configuration describing how to map a payload into a seed list.", "category": "business_logic"}, {"name": "ImporterError", "kind": "class", "path": "dealbrain_api/importers/universal.py", "line": 67, "signature": "class ImporterError(Exception)", "summary": "Raised when universal importer fails to parse or validate the payload.", "layer": "core", "docstring": "Raised when universal importer fails to parse or validate the payload.", "category": "business_logic"}, {"name": "load_seed_from_file", "kind": "function", "path": "dealbrain_api/importers/universal.py", "line": 71, "signature": "load_seed_from_file(path: Path, entity: str) -> tuple[SpreadsheetSeed, int]", "summary": "Load entities from *path* and return a populated ``SpreadsheetSeed``.", "layer": "core", "docstring": "Load entities from *path* and return a populated ``SpreadsheetSeed``.\n\nParameters\n----------\npath:\n    Relative or absolute file path pointing to a ``.json`` or ``.csv`` file.\nentity:\n    Entity key (``cpu``, ``gpu``, ``profile``, ``ports_profile``, ``listing``).\n\nReturns\n-------\ntuple[SpreadsheetSeed, int]\n    Seed object populated with the imported entities and the number of\n    records validated for the requested entity.", "category": "business_logic"}, {"name": "BaselineAuditLog", "kind": "class", "path": "dealbrain_api/models/baseline_audit.py", "line": 21, "signature": "class BaselineAuditLog(Base)", "summary": "Audit log for baseline valuation operations.", "layer": "model", "docstring": "Audit log for baseline valuation operations.", "category": "business_logic"}, {"name": "to_dict", "kind": "method", "path": "dealbrain_api/models/baseline_audit.py", "line": 53, "signature": "to_dict(self) -> dict[str, Any]", "summary": "Convert audit log to dictionary.", "layer": "model", "parent": "BaselineAuditLog", "docstring": "Convert audit log to dictionary.", "category": "business_logic"}, {"name": "TimestampMixin", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 16, "signature": "class TimestampMixin", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "Cpu", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 23, "signature": "class Cpu(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "Gpu", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 47, "signature": "class Gpu(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "PortsProfile", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 61, "signature": "class PortsProfile(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "Port", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 73, "signature": "class Port(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "RamSpec", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 86, "signature": "class RamSpec(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "StorageProfile", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 116, "signature": "class StorageProfile(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "Profile", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 155, "signature": "class Profile(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleset", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 168, "signature": "class ValuationRuleset(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleGroup", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 187, "signature": "class ValuationRuleGroup(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleV2", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 207, "signature": "class ValuationRuleV2(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleCondition", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 237, "signature": "class ValuationRuleCondition(Base)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleAction", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 262, "signature": "class ValuationRuleAction(Base)", "summary": "Action to apply when a valuation rule matches.", "layer": "model", "docstring": "Action to apply when a valuation rule matches.\n\nActions define how to adjust pricing or valuation based on matched conditions.\nThe modifiers_json field supports two formats for applying multipliers:\n\n1. Dynamic Field-Based Multipliers (Primary Format):\n    {\n        \"multipliers\": [\n            {\n                \"name\": \"RAM Generation Multiplier\",\n                \"field\": \"ram_spec.ddr_generation\",\n                \"conditions\": [\n                    {\"value\": \"ddr3\", \"multiplier\": 0.7},\n                    {\"value\": \"ddr4\", \"multiplier\": 1.0},\n                    {\"value\": \"ddr5\", \"multiplier\": 1.3}\n                ]\n            }\n        ]\n    }\n\n2. Legacy Condition Multipliers (Backward Compatible):\n    {\n        \"condition_multipliers\": {\n            \"new\": 1.0,\n            \"refurb\": 0.75,\n            \"used\": 0.6\n        }\n    }\n\nBoth formats can coexist. Field paths use dot notation to navigate nested\nstructures (e.g., \"ram_spec.ddr_generation\"). Empty dict {} is valid.", "category": "business_logic"}, {"name": "ValuationRuleVersion", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 311, "signature": "class ValuationRuleVersion(Base)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ValuationRuleAudit", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 326, "signature": "class ValuationRuleAudit(Base)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "Listing", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 340, "signature": "class Listing(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ram_type", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 438, "signature": "ram_type(self) -> str | None", "summary": "", "layer": "model", "parent": "Listing", "category": "business_logic"}, {"name": "ram_speed_mhz", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 442, "signature": "ram_speed_mhz(self) -> int | None", "summary": "", "layer": "model", "parent": "Listing", "category": "business_logic"}, {"name": "cpu_name", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 446, "signature": "cpu_name(self) -> str | None", "summary": "Denormalized CPU name for frontend convenience.", "layer": "model", "parent": "Listing", "docstring": "Denormalized CPU name for frontend convenience.", "category": "business_logic"}, {"name": "gpu_name", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 451, "signature": "gpu_name(self) -> str | None", "summary": "Denormalized GPU name for frontend convenience.", "layer": "model", "parent": "Listing", "docstring": "Denormalized GPU name for frontend convenience.", "category": "business_logic"}, {"name": "thumbnail_url", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 456, "signature": "thumbnail_url(self) -> str | None", "summary": "Extract thumbnail URL from raw listing JSON or attributes.", "layer": "model", "parent": "Listing", "docstring": "Extract thumbnail URL from raw listing JSON or attributes.", "category": "business_logic"}, {"name": "ListingComponent", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 473, "signature": "class ListingComponent(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ListingScoreSnapshot", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 487, "signature": "class ListingScoreSnapshot(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ImportJob", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 504, "signature": "class ImportJob(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "TaskRun", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 517, "signature": "class TaskRun(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ImportSession", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 529, "signature": "class ImportSession(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ImportSessionAudit", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 562, "signature": "class ImportSessionAudit(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "CustomFieldDefinition", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 576, "signature": "class CustomFieldDefinition(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "validation", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 607, "signature": "validation(self) -> dict[str, Any] | None", "summary": "", "layer": "model", "parent": "CustomFieldDefinition", "category": "business_logic"}, {"name": "validation", "kind": "method", "path": "dealbrain_api/models/core.py", "line": 611, "signature": "validation(self, value: dict[str, Any] | None) -> None", "summary": "", "layer": "model", "parent": "CustomFieldDefinition", "category": "business_logic"}, {"name": "CustomFieldAuditLog", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 615, "signature": "class CustomFieldAuditLog(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "CustomFieldAttributeHistory", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 629, "signature": "class CustomFieldAttributeHistory(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "ApplicationSettings", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 648, "signature": "class ApplicationSettings(Base, TimestampMixin)", "summary": "", "layer": "model", "category": "business_logic"}, {"name": "RawPayload", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 656, "signature": "class RawPayload(Base, TimestampMixin)", "summary": "Stores raw adapter payloads for URL-ingested listings.", "layer": "model", "docstring": "Stores raw adapter payloads for URL-ingested listings.\n\nPreserves original data from adapters (JSON-LD, API responses, HTML) for\ndebugging, re-processing, and audit trails. TTL-based cleanup prevents\nunbounded storage growth.", "category": "business_logic"}, {"name": "IngestionMetric", "kind": "class", "path": "dealbrain_api/models/core.py", "line": 682, "signature": "class IngestionMetric(Base, TimestampMixin)", "summary": "Tracks adapter performance metrics for telemetry dashboard.", "layer": "model", "docstring": "Tracks adapter performance metrics for telemetry dashboard.\n\nAggregates success rates, latencies, and field completeness per adapter.\nSupports time-series analysis for monitoring adapter health and identifying\nregressions.\n\nExample aggregation queries:\n    -- Recent adapter success rate\n    SELECT adapter,\n           SUM(success_count)::float / NULLIF(SUM(success_count + failure_count), 0) AS success_rate\n    FROM ingestion_metric\n    WHERE measured_at >= NOW() - INTERVAL '24 hours'\n    GROUP BY adapter;\n\n    -- P95 latency trend\n    SELECT DATE_TRUNC('hour', measured_at) AS hour,\n           adapter,\n           AVG(p95_latency_ms) AS avg_p95_latency\n    FROM ingestion_metric\n    WHERE measured_at >= NOW() - INTERVAL '7 days'\n    GROUP BY hour, adapter\n    ORDER BY hour DESC;\n\n    -- Field completeness by adapter\n    SELECT adapter,\n           AVG(field_completeness_pct) AS avg_completeness\n    FROM ingestion_metric\n    WHERE measured_at >= NOW() - INTERVAL '7 days'\n    GROUP BY adapter\n    ORDER BY avg_completeness DESC;", "category": "business_logic"}, {"name": "inventory_attribute_values", "kind": "async_function", "path": "dealbrain_api/services/custom_fields_backfill.py", "line": 15, "signature": "async inventory_attribute_values(db: AsyncSession, entity: str) -> dict[str, list[Any]]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "infer_field_shape", "kind": "function", "path": "dealbrain_api/services/custom_fields_backfill.py", "line": 37, "signature": "infer_field_shape(values: Iterable[Any]) -> tuple[str, dict[str, Any] | None, list[str] | None]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "backfill_field_definitions", "kind": "async_function", "path": "dealbrain_api/services/custom_fields_backfill.py", "line": 67, "signature": "async backfill_field_definitions(db: AsyncSession, actor: str | None, service: CustomFieldService | None) -> list[CustomFieldDefinition]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "FieldMeta", "kind": "class", "path": "dealbrain_api/services/field_registry.py", "line": 21, "signature": "class FieldMeta", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "EntityMeta", "kind": "class", "path": "dealbrain_api/services/field_registry.py", "line": 34, "signature": "class EntityMeta", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "RecordPayload", "kind": "class", "path": "dealbrain_api/services/field_registry.py", "line": 43, "signature": "class RecordPayload", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "FieldRegistry", "kind": "class", "path": "dealbrain_api/services/field_registry.py", "line": 48, "signature": "class FieldRegistry", "summary": "Central registry for catalog entities and their field metadata.", "layer": "service", "docstring": "Central registry for catalog entities and their field metadata.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/field_registry.py", "line": 51, "signature": "__init__(self, custom_field_service: CustomFieldService | None) -> None", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "get_entities", "kind": "method", "path": "dealbrain_api/services/field_registry.py", "line": 67, "signature": "get_entities(self) -> list[EntityMeta]", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "schema_for", "kind": "async_method", "path": "dealbrain_api/services/field_registry.py", "line": 70, "signature": "async schema_for(self, db: AsyncSession, entity: str) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "list_records", "kind": "async_method", "path": "dealbrain_api/services/field_registry.py", "line": 100, "signature": "async list_records(self, db: AsyncSession, entity: str, limit: int, offset: int) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "create_record", "kind": "async_method", "path": "dealbrain_api/services/field_registry.py", "line": 134, "signature": "async create_record(self, db: AsyncSession, entity: str, payload: Mapping[str, Any]) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "update_record", "kind": "async_method", "path": "dealbrain_api/services/field_registry.py", "line": 156, "signature": "async update_record(self, db: AsyncSession, entity: str, record_id: int, payload: Mapping[str, Any]) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "FieldRegistry", "category": "business_logic"}, {"name": "RulePreviewService", "kind": "class", "path": "dealbrain_api/services/rule_preview.py", "line": 17, "signature": "class RulePreviewService", "summary": "Service for previewing impact of valuation rules", "layer": "service", "docstring": "Service for previewing impact of valuation rules", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/rule_preview.py", "line": 20, "signature": "__init__(self)", "summary": "", "layer": "service", "parent": "RulePreviewService", "category": "business_logic"}, {"name": "preview_rule", "kind": "async_method", "path": "dealbrain_api/services/rule_preview.py", "line": 23, "signature": "async preview_rule(self, session: AsyncSession, conditions: list[dict[str, Any]], actions: list[dict[str, Any]], sample_size: int, category_filter: dict[str, Any] | None) -> dict[str, Any]", "summary": "Preview impact of a rule before saving.", "layer": "service", "parent": "RulePreviewService", "docstring": "Preview impact of a rule before saving.\n\nArgs:\n    session: Database session\n    conditions: List of condition dictionaries\n    actions: List of action dictionaries\n    sample_size: Number of sample listings to return\n    category_filter: Optional filters for listing selection\n\nReturns:\n    Dictionary with preview data including sample listings and statistics", "category": "business_logic"}, {"name": "preview_ruleset", "kind": "async_method", "path": "dealbrain_api/services/rule_preview.py", "line": 141, "signature": "async preview_ruleset(self, session: AsyncSession, ruleset_id: int, sample_size: int) -> dict[str, Any]", "summary": "Preview impact of an entire ruleset.", "layer": "service", "parent": "RulePreviewService", "docstring": "Preview impact of an entire ruleset.\n\nArgs:\n    session: Database session\n    ruleset_id: Ruleset ID to preview\n    sample_size: Number of sample listings\n\nReturns:\n    Preview data with aggregated statistics", "category": "business_logic"}, {"name": "compare_rulesets", "kind": "async_method", "path": "dealbrain_api/services/rule_preview.py", "line": 227, "signature": "async compare_rulesets(self, session: AsyncSession, ruleset_id_a: int, ruleset_id_b: int, sample_size: int) -> dict[str, Any]", "summary": "Compare impact of two rulesets.", "layer": "service", "parent": "RulePreviewService", "docstring": "Compare impact of two rulesets.\n\nArgs:\n    session: Database session\n    ruleset_id_a: First ruleset ID\n    ruleset_id_b: Second ruleset ID\n    sample_size: Number of listings to compare\n\nReturns:\n    Comparison data", "category": "business_logic"}, {"name": "OperatorDefinition", "kind": "class", "path": "dealbrain_api/services/field_metadata.py", "line": 14, "signature": "class OperatorDefinition", "summary": "Operator metadata for frontend.", "layer": "service", "docstring": "Operator metadata for frontend.", "category": "business_logic"}, {"name": "FieldMetadata", "kind": "class", "path": "dealbrain_api/services/field_metadata.py", "line": 22, "signature": "class FieldMetadata", "summary": "Field metadata for condition builder.", "layer": "service", "docstring": "Field metadata for condition builder.", "category": "business_logic"}, {"name": "EntityMetadata", "kind": "class", "path": "dealbrain_api/services/field_metadata.py", "line": 34, "signature": "class EntityMetadata", "summary": "Entity metadata for condition builder.", "layer": "service", "docstring": "Entity metadata for condition builder.", "category": "business_logic"}, {"name": "FieldMetadataService", "kind": "class", "path": "dealbrain_api/services/field_metadata.py", "line": 41, "signature": "class FieldMetadataService", "summary": "Provides structured metadata for rule builder UI.", "layer": "service", "docstring": "Provides structured metadata for rule builder UI.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/field_metadata.py", "line": 59, "signature": "__init__(self, field_registry: FieldRegistry | None)", "summary": "", "layer": "service", "parent": "FieldMetadataService", "category": "business_logic"}, {"name": "get_entities_metadata", "kind": "async_method", "path": "dealbrain_api/services/field_metadata.py", "line": 62, "signature": "async get_entities_metadata(self, db: AsyncSession) -> list[EntityMetadata]", "summary": "Fetch all entities with their fields.", "layer": "service", "parent": "FieldMetadataService", "docstring": "Fetch all entities with their fields.", "category": "business_logic"}, {"name": "get_operators_for_field_type", "kind": "method", "path": "dealbrain_api/services/field_metadata.py", "line": 167, "signature": "get_operators_for_field_type(self, field_type: str) -> list[OperatorDefinition]", "summary": "Get valid operators for a given field type.", "layer": "service", "parent": "FieldMetadataService", "docstring": "Get valid operators for a given field type.", "category": "business_logic"}, {"name": "FieldUsageSummary", "kind": "class", "path": "dealbrain_api/services/custom_fields.py", "line": 57, "signature": "class FieldUsageSummary", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "total", "kind": "method", "path": "dealbrain_api/services/custom_fields.py", "line": 64, "signature": "total(self) -> int", "summary": "", "layer": "service", "parent": "FieldUsageSummary", "category": "business_logic"}, {"name": "FieldDependencyError", "kind": "class", "path": "dealbrain_api/services/custom_fields.py", "line": 68, "signature": "class FieldDependencyError(RuntimeError)", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/custom_fields.py", "line": 69, "signature": "__init__(self, message: str, usage: FieldUsageSummary) -> None", "summary": "", "layer": "service", "parent": "FieldDependencyError", "category": "business_logic"}, {"name": "CustomFieldService", "kind": "class", "path": "dealbrain_api/services/custom_fields.py", "line": 74, "signature": "class CustomFieldService", "summary": "CRUD helpers for custom fields.", "layer": "service", "docstring": "CRUD helpers for custom fields.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/custom_fields.py", "line": 77, "signature": "__init__(self, allowed_types: Iterable[str] | None) -> None", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "list_fields", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 80, "signature": "async list_fields(self, db: AsyncSession, entity: str | None, include_inactive: bool, include_deleted: bool) -> list[CustomFieldDefinition]", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "get_field", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 103, "signature": "async get_field(self, db: AsyncSession, field_id: int) -> CustomFieldDefinition", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "create_field", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 109, "signature": "async create_field(self, db: AsyncSession, entity: str, key: str, label: str, data_type: str, description: str | None, required: bool, default_value: object | None, options: list[str] | None, is_active: bool, is_locked: bool, visibility: str, created_by: str | None, validation: dict | None, display_order: int | None, actor: str | None) -> CustomFieldDefinition", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "update_field", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 175, "signature": "async update_field(self, db: AsyncSession, field_id: int, label: str | None, data_type: str | None, description: str | None, required: bool | None, default_value: object | None, options: list[str] | None, is_active: bool | None, is_locked: bool | None, visibility: str | None, created_by: str | None, validation: dict | None, display_order: int | None, force: bool, actor: str | None) -> CustomFieldDefinition", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "add_field_option", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 297, "signature": "async add_field_option(self, db: AsyncSession, field_id: int, value: str, actor: str | None) -> CustomFieldDefinition", "summary": "Add an option to a dropdown/multi-select field.", "layer": "service", "parent": "CustomFieldService", "docstring": "Add an option to a dropdown/multi-select field.\n\nArgs:\n    db: Database session\n    field_id: ID of the field to modify\n    value: Option value to add\n    actor: Username of user making the change\n\nReturns:\n    Updated field definition\n\nRaises:\n    LookupError: If field not found\n    ValueError: If field type doesn't support options or value already exists", "category": "business_logic"}, {"name": "delete_field", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 359, "signature": "async delete_field(self, db: AsyncSession, field_id: int, hard_delete: bool, force: bool, actor: str | None) -> FieldUsageSummary", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "field_usage", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 411, "signature": "async field_usage(self, db: AsyncSession, field: CustomFieldDefinition) -> FieldUsageSummary", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "list_usage", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 429, "signature": "async list_usage(self, db: AsyncSession, entity: str | None, field_ids: Sequence[int] | None) -> list[FieldUsageSummary]", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "history", "kind": "async_method", "path": "dealbrain_api/services/custom_fields.py", "line": 450, "signature": "async history(self, db: AsyncSession, field_id: int, limit: int) -> list[CustomFieldAuditLog]", "summary": "", "layer": "service", "parent": "CustomFieldService", "category": "business_logic"}, {"name": "get_or_create_ports_profile", "kind": "async_function", "path": "dealbrain_api/services/ports.py", "line": 12, "signature": "async get_or_create_ports_profile(session: AsyncSession, listing_id: int) -> PortsProfile", "summary": "Get existing ports profile or create new one for listing.", "layer": "service", "docstring": "Get existing ports profile or create new one for listing.\n\nArgs:\n    session: Database session\n    listing_id: Listing ID\n\nReturns:\n    PortsProfile instance (existing or new)\n\nRaises:\n    ValueError: If listing not found", "category": "business_logic"}, {"name": "update_listing_ports", "kind": "async_function", "path": "dealbrain_api/services/ports.py", "line": 51, "signature": "async update_listing_ports(session: AsyncSession, listing_id: int, ports_data: list[dict]) -> PortsProfile", "summary": "Update ports for a listing.", "layer": "service", "docstring": "Update ports for a listing.\n\nArgs:\n    session: Database session\n    listing_id: Listing ID\n    ports_data: List of dicts with 'port_type' and 'quantity' keys\n\nReturns:\n    Updated PortsProfile with ports\n\nExample:\n    ports_data = [\n        {\"port_type\": \"USB-A\", \"quantity\": 4},\n        {\"port_type\": \"HDMI\", \"quantity\": 1}\n    ]", "category": "business_logic"}, {"name": "get_listing_ports", "kind": "async_function", "path": "dealbrain_api/services/ports.py", "line": 93, "signature": "async get_listing_ports(session: AsyncSession, listing_id: int) -> list[dict]", "summary": "Get ports for a listing as simple dict list.", "layer": "service", "docstring": "Get ports for a listing as simple dict list.\n\nReturns:\n    List of dicts with port_type and quantity, or empty list if none.", "category": "business_logic"}, {"name": "CpuMetricSummary", "kind": "class", "path": "dealbrain_api/services/admin_tasks.py", "line": 16, "signature": "class CpuMetricSummary", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "to_dict", "kind": "method", "path": "dealbrain_api/services/admin_tasks.py", "line": 23, "signature": "to_dict(self) -> dict[str, int]", "summary": "", "layer": "service", "parent": "CpuMetricSummary", "category": "business_logic"}, {"name": "recalculate_cpu_mark_metrics", "kind": "async_function", "path": "dealbrain_api/services/admin_tasks.py", "line": 33, "signature": "async recalculate_cpu_mark_metrics(session: AsyncSession, listing_ids: Sequence[int] | None) -> CpuMetricSummary", "summary": "Recalculate CPU dollar-per-mark metrics for listings with CPUs.", "layer": "service", "docstring": "Recalculate CPU dollar-per-mark metrics for listings with CPUs.", "category": "business_logic"}, {"name": "PassmarkImportSummary", "kind": "class", "path": "dealbrain_api/services/passmark.py", "line": 22, "signature": "class PassmarkImportSummary", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "to_dict", "kind": "method", "path": "dealbrain_api/services/passmark.py", "line": 28, "signature": "to_dict(self) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "PassmarkImportSummary", "category": "business_logic"}, {"name": "parse_int", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 37, "signature": "parse_int(value: str | int | float | None) -> int | None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "parse_string", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 60, "signature": "parse_string(value: str | None) -> str | None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "extract_release_year", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 67, "signature": "extract_release_year(raw_date: str | None) -> int | None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "infer_manufacturer", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 79, "signature": "infer_manufacturer(name: str | None) -> str | None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "build_passmark_url", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 96, "signature": "build_passmark_url(href: str | None) -> tuple[str | None, str | None]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "update_cpu_from_passmark", "kind": "function", "path": "dealbrain_api/services/passmark.py", "line": 114, "signature": "update_cpu_from_passmark(cpu: Cpu, data: dict[str, Any]) -> None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "import_passmark_file", "kind": "async_function", "path": "dealbrain_api/services/passmark.py", "line": 192, "signature": "async import_passmark_file(path: Path) -> PassmarkImportSummary", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "normalize_int", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 15, "signature": "normalize_int(value: Any) -> int | None", "summary": "Convert arbitrary value to non-negative integer or ``None``.", "layer": "service", "docstring": "Convert arbitrary value to non-negative integer or ``None``.", "category": "business_logic"}, {"name": "normalize_str", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 26, "signature": "normalize_str(value: Any) -> str | None", "summary": "Coerce arbitrary value to trimmed string or ``None``.", "layer": "service", "docstring": "Coerce arbitrary value to trimmed string or ``None``.", "category": "business_logic"}, {"name": "normalize_ram_generation", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 34, "signature": "normalize_ram_generation(value: Any) -> RamGeneration", "summary": "Resolve various user inputs into a canonical ``RamGeneration``.", "layer": "service", "docstring": "Resolve various user inputs into a canonical ``RamGeneration``.", "category": "business_logic"}, {"name": "format_ram_label", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 59, "signature": "format_ram_label(generation: RamGeneration, speed_mhz: int | None, total_capacity_gb: int | None, module_count: int | None, capacity_per_module_gb: int | None) -> str | None", "summary": "Construct a human-readable RAM label.", "layer": "service", "docstring": "Construct a human-readable RAM label.", "category": "business_logic"}, {"name": "normalize_ram_spec_payload", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 82, "signature": "normalize_ram_spec_payload(data: dict[str, Any] | None, fallback_total_gb: int | None, fallback_generation: RamGeneration | None, fallback_speed: int | None) -> dict[str, Any] | None", "summary": "Normalize raw RAM spec payload into ORM-ready fields.", "layer": "service", "docstring": "Normalize raw RAM spec payload into ORM-ready fields.", "category": "business_logic"}, {"name": "get_or_create_ram_spec", "kind": "async_function", "path": "dealbrain_api/services/component_catalog.py", "line": 142, "signature": "async get_or_create_ram_spec(session: AsyncSession, spec_data: dict[str, Any]) -> RamSpec", "summary": "Return existing RAM spec matching payload or create a new one.", "layer": "service", "docstring": "Return existing RAM spec matching payload or create a new one.", "category": "business_logic"}, {"name": "normalize_storage_medium", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 187, "signature": "normalize_storage_medium(value: Any) -> StorageMedium", "summary": "Map free-form storage descriptors to canonical medium enum.", "layer": "service", "docstring": "Map free-form storage descriptors to canonical medium enum.", "category": "business_logic"}, {"name": "format_storage_label", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 214, "signature": "format_storage_label(medium: StorageMedium, capacity_gb: int | None, interface: str | None, form_factor: str | None) -> str | None", "summary": "Construct a concise storage profile label.", "layer": "service", "docstring": "Construct a concise storage profile label.", "category": "business_logic"}, {"name": "normalize_storage_profile_payload", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 235, "signature": "normalize_storage_profile_payload(data: dict[str, Any] | None, fallback_capacity_gb: int | None, fallback_type: Any | None) -> dict[str, Any] | None", "summary": "Normalize raw storage profile payload into ORM-ready fields.", "layer": "service", "docstring": "Normalize raw storage profile payload into ORM-ready fields.", "category": "business_logic"}, {"name": "get_or_create_storage_profile", "kind": "async_function", "path": "dealbrain_api/services/component_catalog.py", "line": 276, "signature": "async get_or_create_storage_profile(session: AsyncSession, profile_data: dict[str, Any]) -> StorageProfile", "summary": "Return existing storage profile matching payload or create a new one.", "layer": "service", "docstring": "Return existing storage profile matching payload or create a new one.", "category": "business_logic"}, {"name": "storage_medium_display", "kind": "function", "path": "dealbrain_api/services/component_catalog.py", "line": 318, "signature": "storage_medium_display(medium: StorageMedium) -> str | None", "summary": "Provide human-friendly medium label for UI surfaces.", "layer": "service", "docstring": "Provide human-friendly medium label for UI surfaces.", "category": "business_logic"}, {"name": "RulesService", "kind": "class", "path": "dealbrain_api/services/rules.py", "line": 29, "signature": "class RulesService", "summary": "Service for managing valuation rules", "layer": "service", "docstring": "Service for managing valuation rules", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/rules.py", "line": 32, "signature": "__init__(self, trigger_recalculation: bool) -> None", "summary": "Initialize rules service.", "layer": "service", "parent": "RulesService", "docstring": "Initialize rules service.\n\nArgs:\n    trigger_recalculation: If False, skip enqueuing recalculation tasks.\n                          Useful for batch operations or when Redis is unavailable.", "category": "business_logic"}, {"name": "create_ruleset", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 48, "signature": "async create_ruleset(self, session: AsyncSession, name: str | BaseModel | dict[str, Any], description: str | None, version: str, created_by: str | None, metadata: dict[str, Any] | None, priority: int, conditions: dict[str, Any] | None, is_active: bool) -> ValuationRuleset", "summary": "Create a new ruleset.", "layer": "service", "parent": "RulesService", "docstring": "Create a new ruleset.\n\nAccepts either explicit parameters or a schema/dict payload supplied via the `name` argument.", "category": "business_logic"}, {"name": "get_ruleset", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 120, "signature": "async get_ruleset(self, session: AsyncSession, ruleset_id: int) -> ValuationRuleset | None", "summary": "Get ruleset by ID with all related data", "layer": "service", "parent": "RulesService", "docstring": "Get ruleset by ID with all related data", "category": "business_logic"}, {"name": "list_rulesets", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 134, "signature": "async list_rulesets(self, session: AsyncSession, active_only: bool, skip: int, limit: int) -> list[ValuationRuleset]", "summary": "List all rulesets", "layer": "service", "parent": "RulesService", "docstring": "List all rulesets", "category": "business_logic"}, {"name": "update_ruleset", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 159, "signature": "async update_ruleset(self, session: AsyncSession, ruleset_id: int, updates: dict[str, Any] | BaseModel, updated_by: str | None) -> ValuationRuleset | None", "summary": "Update ruleset", "layer": "service", "parent": "RulesService", "docstring": "Update ruleset", "category": "business_logic"}, {"name": "delete_ruleset", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 207, "signature": "async delete_ruleset(self, session: AsyncSession, ruleset_id: int, deleted_by: str | None) -> bool", "summary": "Delete ruleset (cascades to groups and rules)", "layer": "service", "parent": "RulesService", "docstring": "Delete ruleset (cascades to groups and rules)", "category": "business_logic"}, {"name": "create_rule_group", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 235, "signature": "async create_rule_group(self, session: AsyncSession, ruleset_id: int, name: str | BaseModel | dict[str, Any], category: str | None, description: str | None, display_order: int, weight: float, is_active: bool, metadata: dict[str, Any] | None) -> ValuationRuleGroup", "summary": "Create a new rule group", "layer": "service", "parent": "RulesService", "docstring": "Create a new rule group", "category": "business_logic"}, {"name": "get_rule_group", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 288, "signature": "async get_rule_group(self, session: AsyncSession, group_id: int) -> ValuationRuleGroup | None", "summary": "Get rule group by ID", "layer": "service", "parent": "RulesService", "docstring": "Get rule group by ID", "category": "business_logic"}, {"name": "update_rule_group", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 302, "signature": "async update_rule_group(self, session: AsyncSession, group_id: int, updates: dict[str, Any] | BaseModel, updated_by: str | None) -> ValuationRuleGroup | None", "summary": "Update a rule group", "layer": "service", "parent": "RulesService", "docstring": "Update a rule group", "category": "business_logic"}, {"name": "list_rule_groups", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 337, "signature": "async list_rule_groups(self, session: AsyncSession, ruleset_id: int | None, category: str | None) -> list[ValuationRuleGroup]", "summary": "List rule groups", "layer": "service", "parent": "RulesService", "docstring": "List rule groups", "category": "business_logic"}, {"name": "create_rule", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 358, "signature": "async create_rule(self, session: AsyncSession, group_id: int, name: str, description: str | None, priority: int, evaluation_order: int, conditions: list[dict[str, Any]] | None, actions: list[dict[str, Any]] | None, created_by: str | None, metadata: dict[str, Any] | None) -> ValuationRuleV2", "summary": "Create a new rule with conditions and actions", "layer": "service", "parent": "RulesService", "docstring": "Create a new rule with conditions and actions", "category": "business_logic"}, {"name": "get_rule", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 437, "signature": "async get_rule(self, session: AsyncSession, rule_id: int) -> ValuationRuleV2 | None", "summary": "Get rule by ID with all related data", "layer": "service", "parent": "RulesService", "docstring": "Get rule by ID with all related data", "category": "business_logic"}, {"name": "list_rules", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 455, "signature": "async list_rules(self, session: AsyncSession, group_id: int | None, active_only: bool, skip: int, limit: int) -> list[ValuationRuleV2]", "summary": "List rules", "layer": "service", "parent": "RulesService", "docstring": "List rules", "category": "business_logic"}, {"name": "update_rule", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 480, "signature": "async update_rule(self, session: AsyncSession, rule_id: int, updates: dict[str, Any], updated_by: str | None, change_summary: str | None) -> ValuationRuleV2 | None", "summary": "Update rule and create version snapshot", "layer": "service", "parent": "RulesService", "docstring": "Update rule and create version snapshot", "category": "business_logic"}, {"name": "delete_rule", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 567, "signature": "async delete_rule(self, session: AsyncSession, rule_id: int, deleted_by: str | None) -> bool", "summary": "Delete rule", "layer": "service", "parent": "RulesService", "docstring": "Delete rule", "category": "business_logic"}, {"name": "get_audit_log", "kind": "async_method", "path": "dealbrain_api/services/rules.py", "line": 678, "signature": "async get_audit_log(self, session: AsyncSession, rule_id: int | None, limit: int) -> list[ValuationRuleAudit]", "summary": "Get audit log entries", "layer": "service", "parent": "RulesService", "docstring": "Get audit log entries", "category": "business_logic"}, {"name": "RulesetPackagingService", "kind": "class", "path": "dealbrain_api/services/ruleset_packaging.py", "line": 43, "signature": "class RulesetPackagingService", "summary": "Service for packaging and installing rulesets.", "layer": "service", "docstring": "Service for packaging and installing rulesets.", "category": "business_logic"}, {"name": "export_ruleset_to_package", "kind": "async_method", "path": "dealbrain_api/services/ruleset_packaging.py", "line": 46, "signature": "async export_ruleset_to_package(self, session: AsyncSession, ruleset_id: int, metadata: PackageMetadata, include_examples: bool, include_baseline: bool, active_only: bool) -> RulesetPackage", "summary": "Export a ruleset to a complete package.", "layer": "service", "parent": "RulesetPackagingService", "docstring": "Export a ruleset to a complete package.\n\nArgs:\n    session: Database session\n    ruleset_id: ID of the ruleset to export\n    metadata: Package metadata\n    include_examples: Whether to include example listings\n    include_baseline: Whether to include baseline rulesets (default: False)\n    active_only: Whether to only include active rules (default: False)\n\nReturns:\n    Complete RulesetPackage ready for export", "category": "business_logic"}, {"name": "export_to_file", "kind": "async_method", "path": "dealbrain_api/services/ruleset_packaging.py", "line": 199, "signature": "async export_to_file(self, session: AsyncSession, ruleset_id: int, metadata: PackageMetadata, output_path: str, include_baseline: bool) -> None", "summary": "Export ruleset to a .dbrs file.", "layer": "service", "parent": "RulesetPackagingService", "docstring": "Export ruleset to a .dbrs file.\n\nArgs:\n    session: Database session\n    ruleset_id: ID of the ruleset to export\n    metadata: Package metadata\n    output_path: Path to output file\n    include_baseline: Whether to include baseline rulesets", "category": "business_logic"}, {"name": "install_package", "kind": "async_method", "path": "dealbrain_api/services/ruleset_packaging.py", "line": 225, "signature": "async install_package(self, session: AsyncSession, package: RulesetPackage, actor: str, merge_strategy: Literal['replace', 'skip', 'merge', 'version'], baseline_import_mode: Literal['version', 'replace']) -> Dict[str, Any]", "summary": "Install a ruleset package into the database.", "layer": "service", "parent": "RulesetPackagingService", "docstring": "Install a ruleset package into the database.\n\nArgs:\n    session: Database session\n    package: Package to install\n    actor: User performing the installation\n    merge_strategy: How to handle conflicts for normal rulesets\n    baseline_import_mode: How to handle baseline imports (\"version\" or \"replace\")\n\nReturns:\n    Dict with installation results", "category": "business_logic"}, {"name": "install_from_file", "kind": "async_method", "path": "dealbrain_api/services/ruleset_packaging.py", "line": 612, "signature": "async install_from_file(self, session: AsyncSession, file_path: str, actor: str, merge_strategy: Literal['replace', 'skip', 'merge', 'version'], baseline_import_mode: Literal['version', 'replace']) -> Dict[str, Any]", "summary": "Install a package from a .dbrs file.", "layer": "service", "parent": "RulesetPackagingService", "docstring": "Install a package from a .dbrs file.\n\nArgs:\n    session: Database session\n    file_path: Path to .dbrs file\n    actor: User performing the installation\n    merge_strategy: How to handle conflicts for normal rulesets\n    baseline_import_mode: How to handle baseline imports\n\nReturns:\n    Installation results", "category": "business_logic"}, {"name": "BaselineAuditService", "kind": "class", "path": "dealbrain_api/services/baseline_audit.py", "line": 14, "signature": "class BaselineAuditService", "summary": "Service for logging baseline operations.", "layer": "service", "docstring": "Service for logging baseline operations.", "category": "business_logic"}, {"name": "log_instantiation", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 17, "signature": "async log_instantiation(self, session: AsyncSession, actor: str | None, source_hash: str, version: str, ruleset_id: int | None, success: bool, error: str | None, payload: dict[str, Any] | None) -> BaselineAuditLog", "summary": "Log baseline instantiation operation.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Log baseline instantiation operation.\n\nArgs:\n    session: Database session\n    actor: Actor name or ID\n    source_hash: Hash of baseline source\n    version: Baseline version\n    ruleset_id: Created ruleset ID\n    success: Whether operation succeeded\n    error: Error message if failed\n    payload: Additional operation data\n\nReturns:\n    Created audit log entry", "category": "business_logic"}, {"name": "log_diff_request", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 65, "signature": "async log_diff_request(self, session: AsyncSession, actor: str | None, candidate_hash: str, current_hash: str | None, payload: dict[str, Any] | None) -> BaselineAuditLog", "summary": "Log baseline diff request.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Log baseline diff request.\n\nArgs:\n    session: Database session\n    actor: Actor name or ID\n    candidate_hash: Hash of candidate baseline\n    current_hash: Hash of current baseline\n    payload: Diff results\n\nReturns:\n    Created audit log entry", "category": "business_logic"}, {"name": "log_adoption", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 108, "signature": "async log_adoption(self, session: AsyncSession, actor: str | None, changes_applied: int, new_version: str, old_version: str | None, new_hash: str, old_hash: str | None, affected_listings: int | None, payload: dict[str, Any] | None) -> BaselineAuditLog", "summary": "Log baseline adoption operation.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Log baseline adoption operation.\n\nArgs:\n    session: Database session\n    actor: Actor name or ID\n    changes_applied: Number of changes applied\n    new_version: New baseline version\n    old_version: Previous baseline version\n    new_hash: New baseline hash\n    old_hash: Previous baseline hash\n    affected_listings: Number of affected listings\n    payload: Additional operation data\n\nReturns:\n    Created audit log entry", "category": "business_logic"}, {"name": "log_override_operation", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 164, "signature": "async log_override_operation(self, session: AsyncSession, operation: str, actor: str | None, entity_key: str, field_name: str, old_value: Any, new_value: Any, success: bool, error: str | None) -> BaselineAuditLog", "summary": "Log override operation.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Log override operation.\n\nArgs:\n    session: Database session\n    operation: Type of override operation\n    actor: Actor name or ID\n    entity_key: Entity identifier\n    field_name: Field being overridden\n    old_value: Previous value\n    new_value: New value\n    success: Whether operation succeeded\n    error: Error message if failed\n\nReturns:\n    Created audit log entry", "category": "business_logic"}, {"name": "log_bulk_operation", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 217, "signature": "async log_bulk_operation(self, session: AsyncSession, operation: str, actor: str | None, affected_count: int, total_adjustment_change: float | None, success: bool, error: str | None, payload: dict[str, Any] | None) -> BaselineAuditLog", "summary": "Log bulk baseline operation.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Log bulk baseline operation.\n\nArgs:\n    session: Database session\n    operation: Type of bulk operation\n    actor: Actor name or ID\n    affected_count: Number of entities affected\n    total_adjustment_change: Total valuation change\n    success: Whether operation succeeded\n    error: Error message if failed\n    payload: Additional operation data\n\nReturns:\n    Created audit log entry", "category": "business_logic"}, {"name": "get_recent_operations", "kind": "async_method", "path": "dealbrain_api/services/baseline_audit.py", "line": 264, "signature": "async get_recent_operations(self, session: AsyncSession, limit: int, operation_type: str | None, actor: str | None) -> list[BaselineAuditLog]", "summary": "Get recent audit log entries.", "layer": "service", "parent": "BaselineAuditService", "docstring": "Get recent audit log entries.\n\nArgs:\n    session: Database session\n    limit: Maximum number of entries to return\n    operation_type: Filter by operation type\n    actor: Filter by actor\n\nReturns:\n    List of audit log entries", "category": "business_logic"}, {"name": "BaselineLoadResult", "kind": "class", "path": "dealbrain_api/services/baseline_loader.py", "line": 32, "signature": "class BaselineLoadResult", "summary": "Summary of a baseline ingestion run.", "layer": "service", "docstring": "Summary of a baseline ingestion run.", "category": "business_logic"}, {"name": "to_dict", "kind": "method", "path": "dealbrain_api/services/baseline_loader.py", "line": 44, "signature": "to_dict(self) -> dict[str, Any]", "summary": "Return a serialisable representation.", "layer": "service", "parent": "BaselineLoadResult", "docstring": "Return a serialisable representation.", "category": "business_logic"}, {"name": "BaselineLoaderService", "kind": "class", "path": "dealbrain_api/services/baseline_loader.py", "line": 58, "signature": "class BaselineLoaderService", "summary": "Map curated baseline JSON into system rulesets.", "layer": "service", "docstring": "Map curated baseline JSON into system rulesets.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/baseline_loader.py", "line": 61, "signature": "__init__(self, rules_service: RulesService | None) -> None", "summary": "", "layer": "service", "parent": "BaselineLoaderService", "category": "business_logic"}, {"name": "load_from_path", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 66, "signature": "async load_from_path(self, session: AsyncSession, source_path: Path | str, actor: str | None, ensure_basic_for_ruleset: int | None) -> BaselineLoadResult", "summary": "Load baseline data from a JSON file.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Load baseline data from a JSON file.", "category": "business_logic"}, {"name": "load_from_payload", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 89, "signature": "async load_from_payload(self, session: AsyncSession, payload: dict[str, Any], actor: str | None, ensure_basic_for_ruleset: int | None, source_reference: str | None) -> BaselineLoadResult", "summary": "Create a baseline ruleset from an in-memory payload.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Create a baseline ruleset from an in-memory payload.", "category": "business_logic"}, {"name": "ensure_basic_adjustments_group", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 213, "signature": "async ensure_basic_adjustments_group(self, session: AsyncSession, target_ruleset_id: int | None, actor: str | None) -> ValuationRuleGroup | None", "summary": "Guarantee the presence of a managed Basic Adjustments group.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Guarantee the presence of a managed Basic Adjustments group.", "category": "business_logic"}, {"name": "get_baseline_metadata", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 413, "signature": "async get_baseline_metadata(self, session: AsyncSession) -> BaselineMetadataResponse | None", "summary": "Extract metadata from the currently active baseline ruleset.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Extract metadata from the currently active baseline ruleset.\n\nReturns:\n    BaselineMetadataResponse if active baseline exists, None otherwise.", "category": "business_logic"}, {"name": "diff_baseline", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 508, "signature": "async diff_baseline(self, session: AsyncSession, candidate_json: dict[str, Any]) -> BaselineDiffResponse", "summary": "Compare candidate baseline against the current active baseline.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Compare candidate baseline against the current active baseline.\n\nArgs:\n    session: Database session\n    candidate_json: Candidate baseline JSON structure\n\nReturns:\n    BaselineDiffResponse with added, changed, and removed fields", "category": "business_logic"}, {"name": "adopt_baseline", "kind": "async_method", "path": "dealbrain_api/services/baseline_loader.py", "line": 663, "signature": "async adopt_baseline(self, session: AsyncSession, candidate_json: dict[str, Any], selected_changes: list[str] | None, actor: str | None) -> dict[str, Any]", "summary": "Adopt selected changes from candidate baseline, creating a new version.", "layer": "service", "parent": "BaselineLoaderService", "docstring": "Adopt selected changes from candidate baseline, creating a new version.\n\nArgs:\n    session: Database session\n    candidate_json: Candidate baseline JSON structure\n    selected_changes: Optional list of field IDs to adopt (entity.field format)\n                    If None, all changes are adopted\n    actor: User/system actor performing adoption\n\nReturns:\n    Dict with adoption results including new ruleset ID, version, and audit log", "category": "business_logic"}, {"name": "BaselineMetricsService", "kind": "class", "path": "dealbrain_api/services/baseline_metrics.py", "line": 22, "signature": "class BaselineMetricsService", "summary": "Service for calculating and aggregating baseline metrics.", "layer": "service", "docstring": "Service for calculating and aggregating baseline metrics.", "category": "business_logic"}, {"name": "calculate_layer_influence", "kind": "async_method", "path": "dealbrain_api/services/baseline_metrics.py", "line": 25, "signature": "async calculate_layer_influence(self, session: AsyncSession) -> dict[str, float]", "summary": "Calculate percentage of listings influenced by each layer.", "layer": "service", "parent": "BaselineMetricsService", "docstring": "Calculate percentage of listings influenced by each layer.\n\nReturns:\n    Dictionary with layer names and percentages", "category": "business_logic"}, {"name": "get_top_rules_by_contribution", "kind": "async_method", "path": "dealbrain_api/services/baseline_metrics.py", "line": 64, "signature": "async get_top_rules_by_contribution(self, session: AsyncSession, limit: int, days_back: int) -> list[dict[str, Any]]", "summary": "Get top rules by absolute contribution amount.", "layer": "service", "parent": "BaselineMetricsService", "docstring": "Get top rules by absolute contribution amount.\n\nArgs:\n    session: Database session\n    limit: Number of top rules to return\n    days_back: Number of days to look back for aggregation\n\nReturns:\n    List of rule dictionaries with contribution data", "category": "business_logic"}, {"name": "calculate_override_churn", "kind": "async_method", "path": "dealbrain_api/services/baseline_metrics.py", "line": 130, "signature": "async calculate_override_churn(self, session: AsyncSession, days_back: int) -> dict[str, Any]", "summary": "Calculate override churn rate over specified period.", "layer": "service", "parent": "BaselineMetricsService", "docstring": "Calculate override churn rate over specified period.\n\nArgs:\n    session: Database session\n    days_back: Number of days to analyze\n\nReturns:\n    Dictionary with churn metrics\n\nNote:\n    This method currently returns placeholder data until the EntityFieldValue\n    model is implemented. This is part of the baseline valuation enhancement\n    feature and will be fully functional once the field value storage model\n    is created.", "category": "business_logic"}, {"name": "get_baseline_summary", "kind": "async_method", "path": "dealbrain_api/services/baseline_metrics.py", "line": 166, "signature": "async get_baseline_summary(self, session: AsyncSession) -> dict[str, Any]", "summary": "Get comprehensive baseline metrics summary.", "layer": "service", "parent": "BaselineMetricsService", "docstring": "Get comprehensive baseline metrics summary.\n\nReturns:\n    Dictionary with all baseline metrics", "category": "business_logic"}, {"name": "store_metrics_snapshot", "kind": "async_method", "path": "dealbrain_api/services/baseline_metrics.py", "line": 219, "signature": "async store_metrics_snapshot(self, session: AsyncSession, metrics: dict[str, Any]) -> None", "summary": "Store metrics snapshot for historical tracking.", "layer": "service", "parent": "BaselineMetricsService", "docstring": "Store metrics snapshot for historical tracking.\n\nArgs:\n    session: Database session\n    metrics: Metrics to store", "category": "business_logic"}, {"name": "HydrationResult", "kind": "class", "path": "dealbrain_api/services/baseline_hydration.py", "line": 24, "signature": "class HydrationResult", "summary": "Result of hydrating baseline rules in a ruleset.", "layer": "service", "docstring": "Result of hydrating baseline rules in a ruleset.", "category": "business_logic"}, {"name": "BaselineHydrationService", "kind": "class", "path": "dealbrain_api/services/baseline_hydration.py", "line": 34, "signature": "class BaselineHydrationService", "summary": "Service for hydrating baseline placeholder rules into editable rule structures.", "layer": "service", "docstring": "Service for hydrating baseline placeholder rules into editable rule structures.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/baseline_hydration.py", "line": 40, "signature": "__init__(self, rules_service: RulesService | None) -> None", "summary": "Initialize the hydration service.", "layer": "service", "parent": "BaselineHydrationService", "docstring": "Initialize the hydration service.\n\nArgs:\n    rules_service: RulesService instance for creating rules.\n                  If None, creates a new instance with recalculation disabled.", "category": "business_logic"}, {"name": "hydrate_baseline_rules", "kind": "async_method", "path": "dealbrain_api/services/baseline_hydration.py", "line": 69, "signature": "async hydrate_baseline_rules(self, session: AsyncSession, ruleset_id: int, actor: str) -> HydrationResult", "summary": "Hydrate all placeholder baseline rules in a ruleset.", "layer": "service", "parent": "BaselineHydrationService", "docstring": "Hydrate all placeholder baseline rules in a ruleset.\n\nThis method:\n1. Finds all rules marked as baseline_placeholder in the ruleset\n2. Expands each placeholder into full rules with conditions/actions\n3. Marks original placeholders as hydrated and deactivates them\n4. Returns a summary of the hydration operation\n\nArgs:\n    session: Database session\n    ruleset_id: ID of the ruleset to hydrate\n    actor: User or system identifier performing the hydration\n\nReturns:\n    HydrationResult with status, counts, and summary", "category": "business_logic"}, {"name": "hydrate_single_rule", "kind": "async_method", "path": "dealbrain_api/services/baseline_hydration.py", "line": 143, "signature": "async hydrate_single_rule(self, session: AsyncSession, rule_id: int, actor: str) -> list[ValuationRuleV2]", "summary": "Hydrate a single placeholder rule into expanded rules.", "layer": "service", "parent": "BaselineHydrationService", "docstring": "Hydrate a single placeholder rule into expanded rules.\n\nRoutes to the appropriate hydration strategy based on field_type metadata:\n- enum_multiplier: Creates one rule per enum value with conditions\n- formula: Creates single rule with formula action\n- fixed/additive: Creates single rule with fixed value action\n- scalar: Skipped (represents FK relationships, not valuation rules)\n\nArgs:\n    session: Database session\n    rule_id: ID of the placeholder rule to hydrate\n    actor: User or system identifier performing the hydration\n\nReturns:\n    List of expanded rules created from the placeholder.\n    Empty list if rule is scalar type (FK relationship).\n\nRaises:\n    ValueError: If rule not found or not a baseline placeholder", "category": "business_logic"}, {"name": "get_field_distinct_values", "kind": "async_function", "path": "dealbrain_api/services/field_values.py", "line": 17, "signature": "async get_field_distinct_values(session: AsyncSession, field_name: str, limit: int, search: str | None) -> list[str]", "summary": "Get distinct values for a given field across all entities.", "layer": "service", "docstring": "Get distinct values for a given field across all entities.\n\nArgs:\n    session: Database session\n    field_name: Field name in format \"entity.field\" (e.g., \"listing.condition\")\n    limit: Maximum number of values to return\n    search: Optional search filter\n\nReturns:\n    List of distinct string values\n\nRaises:\n    ValueError: If field_name format is invalid or field not found", "category": "business_logic"}, {"name": "get_listing_column", "kind": "function", "path": "dealbrain_api/services/field_values.py", "line": 85, "signature": "get_listing_column(field_key: str) -> InstrumentedAttribute[Any] | None", "summary": "Map field key to Listing model column.", "layer": "service", "docstring": "Map field key to Listing model column.", "category": "business_logic"}, {"name": "get_cpu_column", "kind": "function", "path": "dealbrain_api/services/field_values.py", "line": 105, "signature": "get_cpu_column(field_key: str) -> InstrumentedAttribute[Any] | None", "summary": "Map field key to CPU model column.", "layer": "service", "docstring": "Map field key to CPU model column.", "category": "business_logic"}, {"name": "get_gpu_column", "kind": "function", "path": "dealbrain_api/services/field_values.py", "line": 117, "signature": "get_gpu_column(field_key: str) -> InstrumentedAttribute[Any] | None", "summary": "Map field key to GPU model column.", "layer": "service", "docstring": "Map field key to GPU model column.", "category": "business_logic"}, {"name": "FormulaValidationService", "kind": "class", "path": "dealbrain_api/services/formula_validation.py", "line": 17, "signature": "class FormulaValidationService", "summary": "Service for validating formulas and providing preview calculations", "layer": "service", "docstring": "Service for validating formulas and providing preview calculations", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/formula_validation.py", "line": 20, "signature": "__init__(self)", "summary": "", "layer": "service", "parent": "FormulaValidationService", "category": "business_logic"}, {"name": "get_available_fields", "kind": "async_method", "path": "dealbrain_api/services/formula_validation.py", "line": 25, "signature": "async get_available_fields(self, session: AsyncSession, entity_type: str) -> set[str]", "summary": "Get available field names for an entity type.", "layer": "service", "parent": "FormulaValidationService", "docstring": "Get available field names for an entity type.\n\nArgs:\n    session: Database session\n    entity_type: Entity type (Listing, CPU, GPU, etc.)\n\nReturns:\n    Set of available field names", "category": "business_logic"}, {"name": "get_sample_context", "kind": "async_method", "path": "dealbrain_api/services/formula_validation.py", "line": 165, "signature": "async get_sample_context(self, session: AsyncSession, entity_type: str, provided_context: dict[str, Any] | None) -> dict[str, Any]", "summary": "Get sample context data for formula preview.", "layer": "service", "parent": "FormulaValidationService", "docstring": "Get sample context data for formula preview.\n\nArgs:\n    session: Database session\n    entity_type: Entity type (Listing, CPU, GPU, etc.)\n    provided_context: Optional user-provided context values\n\nReturns:\n    Dictionary with sample field values", "category": "business_logic"}, {"name": "validate_formula", "kind": "async_method", "path": "dealbrain_api/services/formula_validation.py", "line": 334, "signature": "async validate_formula(self, session: AsyncSession, formula: str, entity_type: str, sample_context: dict[str, Any] | None) -> dict[str, Any]", "summary": "Validate a formula and provide preview calculation.", "layer": "service", "parent": "FormulaValidationService", "docstring": "Validate a formula and provide preview calculation.\n\nArgs:\n    session: Database session\n    formula: Formula string to validate\n    entity_type: Entity type for field context\n    sample_context: Optional sample context for preview\n\nReturns:\n    Dictionary with validation results", "category": "business_logic"}, {"name": "RuleEvaluationService", "kind": "class", "path": "dealbrain_api/services/rule_evaluation.py", "line": 52, "signature": "class RuleEvaluationService", "summary": "Service for evaluating valuation rules against listings", "layer": "service", "docstring": "Service for evaluating valuation rules against listings", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 55, "signature": "__init__(self)", "summary": "", "layer": "service", "parent": "RuleEvaluationService", "category": "business_logic"}, {"name": "evaluate_listing", "kind": "async_method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 59, "signature": "async evaluate_listing(self, session: AsyncSession, listing_id: int, ruleset_id: int | None) -> dict[str, Any]", "summary": "Evaluate a listing against one or more rulesets.", "layer": "service", "parent": "RuleEvaluationService", "docstring": "Evaluate a listing against one or more rulesets.\n\nIf ruleset_id is provided, only that ruleset is evaluated.\nOtherwise, evaluates all active rulesets in priority order.\n\nArgs:\n    session: Database session\n    listing_id: Listing ID to evaluate\n    ruleset_id: Specific ruleset to use (optional)\n\nReturns:\n    Dictionary with valuation results including layer attribution", "category": "business_logic"}, {"name": "evaluate_multiple_listings", "kind": "async_method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 251, "signature": "async evaluate_multiple_listings(self, session: AsyncSession, listing_ids: list[int], ruleset_id: int | None) -> list[dict[str, Any]]", "summary": "Evaluate multiple listings against rulesets.", "layer": "service", "parent": "RuleEvaluationService", "docstring": "Evaluate multiple listings against rulesets.\n\nArgs:\n    session: Database session\n    listing_ids: List of listing IDs\n    ruleset_id: Specific ruleset to use (uses all active if None)\n\nReturns:\n    List of evaluation results", "category": "business_logic"}, {"name": "apply_ruleset_to_listing", "kind": "async_method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 287, "signature": "async apply_ruleset_to_listing(self, session: AsyncSession, listing_id: int, ruleset_id: int | None, commit: bool) -> dict[str, Any]", "summary": "Evaluate rulesets and update the listing's valuation data.", "layer": "service", "parent": "RuleEvaluationService", "docstring": "Evaluate rulesets and update the listing's valuation data.\n\nArgs:\n    session: Database session\n    listing_id: Listing ID\n    ruleset_id: Specific ruleset to apply (uses all active if None)\n    commit: Whether to commit changes\n\nReturns:\n    Evaluation result", "category": "business_logic"}, {"name": "apply_ruleset_to_all_listings", "kind": "async_method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 331, "signature": "async apply_ruleset_to_all_listings(self, session: AsyncSession, ruleset_id: int | None, batch_size: int) -> dict[str, Any]", "summary": "Apply rulesets to all active listings in batches.", "layer": "service", "parent": "RuleEvaluationService", "docstring": "Apply rulesets to all active listings in batches.\n\nArgs:\n    session: Database session\n    ruleset_id: Specific ruleset to apply (uses all active if None)\n    batch_size: Number of listings to process at once\n\nReturns:\n    Summary of application", "category": "business_logic"}, {"name": "clear_cache", "kind": "method", "path": "dealbrain_api/services/rule_evaluation.py", "line": 621, "signature": "clear_cache(self)", "summary": "Clear evaluation cache", "layer": "service", "parent": "RuleEvaluationService", "docstring": "Clear evaluation cache", "category": "business_logic"}, {"name": "DeduplicationResult", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 31, "signature": "class DeduplicationResult", "summary": "Result of deduplication check.", "layer": "service", "docstring": "Result of deduplication check.\n\nAttributes:\n    exists: Whether listing already exists in database\n    existing_listing: The existing listing if found, None otherwise\n    is_exact_match: True if vendor ID match, False if hash match\n    confidence: Match confidence (1.0 for vendor ID, 0.95 for hash)\n    dedup_hash: SHA-256 hash used for deduplication (if applicable)", "category": "business_logic"}, {"name": "DeduplicationService", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 49, "signature": "class DeduplicationService", "summary": "Service for detecting duplicate listings.", "layer": "service", "docstring": "Service for detecting duplicate listings.\n\nUses a two-tier deduplication strategy:\n1. Vendor ID match (highest priority, 100% confidence)\n2. Hash-based match (fallback, 95% confidence)\n\nHash formula: SHA-256(normalize(title) + normalize(seller) + normalize(price))\n\nExample:\n    >>> async with session_scope() as session:\n    ...     service = DeduplicationService(session)\n    ...     result = await service.find_existing_listing(normalized_data)\n    ...     if result.exists:\n    ...         print(f\"Duplicate found: {result.existing_listing.id}\")", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 66, "signature": "__init__(self, session: AsyncSession)", "summary": "Initialize deduplication service.", "layer": "service", "parent": "DeduplicationService", "docstring": "Initialize deduplication service.\n\nArgs:\n    session: Async SQLAlchemy session for database queries", "category": "business_logic"}, {"name": "find_existing_listing", "kind": "async_method", "path": "dealbrain_api/services/ingestion.py", "line": 74, "signature": "async find_existing_listing(self, normalized_data: NormalizedListingSchema) -> DeduplicationResult", "summary": "Find existing listing using vendor ID or hash-based deduplication.", "layer": "service", "parent": "DeduplicationService", "docstring": "Find existing listing using vendor ID or hash-based deduplication.\n\nChecks for duplicates in the following order:\n1. Vendor ID + marketplace match (if available)\n2. Hash-based match (title + seller + price)\n\nArgs:\n    normalized_data: Normalized listing data from adapter\n\nReturns:\n    DeduplicationResult with exists flag and existing listing if found\n\nExample:\n    >>> normalized = NormalizedListingSchema(\n    ...     title=\"Gaming PC\",\n    ...     price=Decimal(\"599.99\"),\n    ...     vendor_item_id=\"123456789012\",\n    ...     marketplace=\"ebay\",\n    ...     condition=\"used\"\n    ... )\n    >>> result = await service.find_existing_listing(normalized)\n    >>> print(f\"Exists: {result.exists}, Confidence: {result.confidence}\")", "category": "business_logic"}, {"name": "ListingNormalizer", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 296, "signature": "class ListingNormalizer", "summary": "Normalizes and enriches listing data from adapters.", "layer": "service", "docstring": "Normalizes and enriches listing data from adapters.\n\nPerforms the following transformations:\n1. Currency conversion to USD using fixed exchange rates\n2. Condition string normalization to standard enum values\n3. Spec extraction from descriptions (CPU/RAM/storage)\n4. CPU canonicalization against catalog with benchmark enrichment\n5. Data quality assessment (full/partial based on field coverage)\n\nExample:\n    >>> async with session_scope() as session:\n    ...     normalizer = ListingNormalizer(session)\n    ...     enriched = await normalizer.normalize(raw_data)\n    ...     quality = normalizer.assess_quality(enriched)\n    ...     print(f\"Enriched CPU: {enriched.cpu_model}, Quality: {quality}\")", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 353, "signature": "__init__(self, session: AsyncSession)", "summary": "Initialize listing normalizer.", "layer": "service", "parent": "ListingNormalizer", "docstring": "Initialize listing normalizer.\n\nArgs:\n    session: Async SQLAlchemy session for database queries", "category": "business_logic"}, {"name": "normalize", "kind": "async_method", "path": "dealbrain_api/services/ingestion.py", "line": 426, "signature": "async normalize(self, raw_data: NormalizedListingSchema) -> NormalizedListingSchema", "summary": "Normalize and enrich listing data.", "layer": "service", "parent": "ListingNormalizer", "docstring": "Normalize and enrich listing data.\n\nApplies currency conversion, condition normalization, spec extraction,\nand CPU canonicalization to produce a standardized, enriched listing.\n\nArgs:\n    raw_data: Raw normalized data from adapter\n\nReturns:\n    Enriched NormalizedListingSchema with standardized fields\n\nExample:\n    >>> raw = NormalizedListingSchema(\n    ...     title=\"Gaming PC\",\n    ...     price=Decimal(\"500\"),\n    ...     currency=\"EUR\",\n    ...     condition=\"Brand New\",\n    ...     description=\"PC with Intel Core i7-12700K, 16GB RAM, 512GB SSD\",\n    ...     marketplace=\"other\"\n    ... )\n    >>> enriched = await normalizer.normalize(raw)\n    >>> print(f\"Price: ${enriched.price}, CPU: {enriched.cpu_model}\")", "category": "business_logic"}, {"name": "assess_quality", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 659, "signature": "assess_quality(self, normalized: NormalizedListingSchema) -> str", "summary": "Return 'full' or 'partial' based on field completeness.", "layer": "service", "parent": "ListingNormalizer", "docstring": "Return 'full' or 'partial' based on field completeness.\n\nQuality assessment:\n- Full: has title, price, condition, CPU, RAM, storage, images (4+ optional fields)\n- Partial: missing one or more optional fields (<4 optional fields)\n\nArgs:\n    normalized: Normalized listing schema\n\nReturns:\n    Quality level: \"full\" or \"partial\"\n\nRaises:\n    ValueError: If required fields (title, price) are missing\n\nExample:\n    >>> data = NormalizedListingSchema(\n    ...     title=\"PC\",\n    ...     price=Decimal(\"599.99\"),\n    ...     condition=\"new\",\n    ...     cpu_model=\"i7-12700K\",\n    ...     ram_gb=16,\n    ...     storage_gb=512,\n    ...     images=[\"http://example.com/img.jpg\"],\n    ...     marketplace=\"other\"\n    ... )\n    >>> normalizer.assess_quality(data)\n    'full'", "category": "business_logic"}, {"name": "ListingCreatedEvent", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 713, "signature": "class ListingCreatedEvent", "summary": "Event emitted when a new listing is created.", "layer": "service", "docstring": "Event emitted when a new listing is created.\n\nAttributes:\n    listing_id: Database ID of the created listing\n    title: Listing title\n    price: Current price in USD\n    marketplace: Marketplace identifier (ebay|amazon|other)\n    vendor_item_id: Marketplace-specific item ID (optional)\n    provenance: Data source (ebay_api|jsonld)\n    quality: Data quality assessment (full|partial)\n    created_at: Timestamp when listing was created", "category": "business_logic"}, {"name": "PriceChangedEvent", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 738, "signature": "class PriceChangedEvent", "summary": "Event emitted when a listing's price changes significantly.", "layer": "service", "docstring": "Event emitted when a listing's price changes significantly.\n\nAttributes:\n    listing_id: Database ID of the listing\n    title: Listing title\n    old_price: Previous price in USD\n    new_price: Current price in USD\n    change_amount: Price difference (new - old, negative = price drop)\n    change_percent: Percentage change ((new - old) / old * 100)\n    marketplace: Marketplace identifier (ebay|amazon|other)\n    vendor_item_id: Marketplace-specific item ID (optional)\n    changed_at: Timestamp when price change was detected", "category": "business_logic"}, {"name": "should_emit_price_change", "kind": "function", "path": "dealbrain_api/services/ingestion.py", "line": 764, "signature": "should_emit_price_change(old_price: Decimal, new_price: Decimal, threshold_abs: Decimal, threshold_pct: Decimal) -> bool", "summary": "Determine if price change is significant enough to emit event.", "layer": "service", "docstring": "Determine if price change is significant enough to emit event.\n\nEmits if EITHER:\n- Absolute change >= threshold_abs\n- Percent change >= threshold_pct\n\nArgs:\n    old_price: Previous price in USD\n    new_price: Current price in USD\n    threshold_abs: Minimum absolute change threshold (e.g., $1.00)\n    threshold_pct: Minimum percent change threshold (e.g., 2.0 for 2%)\n\nReturns:\n    True if price change is significant, False otherwise\n\nExample:\n    >>> should_emit_price_change(\n    ...     Decimal(\"100.00\"),\n    ...     Decimal(\"98.00\"),\n    ...     Decimal(\"1.00\"),\n    ...     Decimal(\"2.0\")\n    ... )\n    True  # $2 change >= $1 threshold AND 2% >= 2% threshold", "category": "business_logic"}, {"name": "IngestionEventService", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 807, "signature": "class IngestionEventService", "summary": "Service for emitting ingestion-related events.", "layer": "service", "docstring": "Service for emitting ingestion-related events.\n\nEmits events for:\n- listing.created - When a new listing is imported\n- price.changed - When an existing listing's price changes significantly\n\nPhase 2 Implementation:\n- Uses in-memory event storage for testing\n- Future phases will integrate with Celery, webhooks, or event bus\n\nExample:\n    >>> event_service = IngestionEventService()\n    >>> event_service.emit_listing_created(\n    ...     listing=new_listing,\n    ...     provenance=\"ebay_api\",\n    ...     quality=\"full\"\n    ... )\n    >>> events = event_service.get_events()\n    >>> print(f\"Emitted {len(events)} events\")", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 829, "signature": "__init__(self)", "summary": "Initialize event service with in-memory event storage.", "layer": "service", "parent": "IngestionEventService", "docstring": "Initialize event service with in-memory event storage.", "category": "business_logic"}, {"name": "emit_listing_created", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 833, "signature": "emit_listing_created(self, listing: Listing, provenance: str, quality: str) -> None", "summary": "Emit event when new listing is created.", "layer": "service", "parent": "IngestionEventService", "docstring": "Emit event when new listing is created.\n\nArgs:\n    listing: Newly created listing instance\n    provenance: Data source (ebay_api|jsonld)\n    quality: Data quality assessment (full|partial)\n\nExample:\n    >>> listing = Listing(\n    ...     id=1,\n    ...     title=\"Gaming PC\",\n    ...     price_usd=599.99,\n    ...     marketplace=\"ebay\",\n    ...     vendor_item_id=\"123456789012\"\n    ... )\n    >>> event_service.emit_listing_created(listing, \"ebay_api\", \"full\")", "category": "business_logic"}, {"name": "emit_price_changed", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 870, "signature": "emit_price_changed(self, listing: Listing, old_price: Decimal, new_price: Decimal) -> None", "summary": "Emit event when listing price changes significantly.", "layer": "service", "parent": "IngestionEventService", "docstring": "Emit event when listing price changes significantly.\n\nArgs:\n    listing: Listing instance with updated price\n    old_price: Previous price in USD\n    new_price: Current price in USD\n\nExample:\n    >>> listing = Listing(\n    ...     id=1,\n    ...     title=\"Gaming PC\",\n    ...     price_usd=549.99,\n    ...     marketplace=\"ebay\"\n    ... )\n    >>> event_service.emit_price_changed(\n    ...     listing,\n    ...     Decimal(\"599.99\"),\n    ...     Decimal(\"549.99\")\n    ... )", "category": "business_logic"}, {"name": "check_and_emit_price_change", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 919, "signature": "check_and_emit_price_change(self, listing: Listing, old_price: Decimal, new_price: Decimal) -> bool", "summary": "Check if price change is significant and emit event if so.", "layer": "service", "parent": "IngestionEventService", "docstring": "Check if price change is significant and emit event if so.\n\nReads thresholds from application settings and emits price.changed\nevent if either threshold is met.\n\nArgs:\n    listing: Listing instance with updated price\n    old_price: Previous price in USD\n    new_price: Current price in USD\n\nReturns:\n    True if event was emitted, False otherwise\n\nExample:\n    >>> # Assuming settings.ingestion.price_change_threshold_abs = 1.0\n    >>> # and settings.ingestion.price_change_threshold_pct = 2.0\n    >>> listing = Listing(id=1, title=\"PC\", price_usd=98.00, marketplace=\"ebay\")\n    >>> emitted = event_service.check_and_emit_price_change(\n    ...     listing,\n    ...     Decimal(\"100.00\"),\n    ...     Decimal(\"98.00\")\n    ... )\n    >>> print(f\"Event emitted: {emitted}\")\n    Event emitted: True", "category": "business_logic"}, {"name": "get_events", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 963, "signature": "get_events(self) -> list[ListingCreatedEvent | PriceChangedEvent]", "summary": "Get all emitted events (for testing).", "layer": "service", "parent": "IngestionEventService", "docstring": "Get all emitted events (for testing).\n\nReturns:\n    Copy of all emitted events\n\nExample:\n    >>> events = event_service.get_events()\n    >>> for event in events:\n    ...     if isinstance(event, ListingCreatedEvent):\n    ...         print(f\"Created: {event.title}\")\n    ...     elif isinstance(event, PriceChangedEvent):\n    ...         print(f\"Price changed: {event.title}\")", "category": "business_logic"}, {"name": "clear_events", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 979, "signature": "clear_events(self) -> None", "summary": "Clear all events (for testing).", "layer": "service", "parent": "IngestionEventService", "docstring": "Clear all events (for testing).\n\nResets the in-memory event storage to empty list.\nUseful for test isolation and cleanup.\n\nExample:\n    >>> event_service.emit_listing_created(listing, \"ebay_api\", \"full\")\n    >>> len(event_service.get_events())\n    1\n    >>> event_service.clear_events()\n    >>> len(event_service.get_events())\n    0", "category": "business_logic"}, {"name": "IngestionResult", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 997, "signature": "class IngestionResult", "summary": "Result of ingesting a single URL.", "layer": "service", "docstring": "Result of ingesting a single URL.\n\nAttributes:\n    success: Whether ingestion completed successfully\n    listing_id: Database ID of created/updated listing (None if failed)\n    status: Ingestion status (created|updated|failed)\n    provenance: Data source used (ebay_api|jsonld)\n    quality: Data quality assessment (full|partial)\n    url: Source URL that was ingested\n    dedup_result: Deduplication check result (optional)\n    error: Error message if ingestion failed (optional)\n    title: Listing title (optional)\n    price: Listing price in USD (optional)\n    vendor_item_id: Marketplace-specific item ID (optional)\n    marketplace: Marketplace identifier (ebay|amazon|other)", "category": "business_logic"}, {"name": "IngestionService", "kind": "class", "path": "dealbrain_api/services/ingestion.py", "line": 1032, "signature": "class IngestionService", "summary": "Orchestrates URL ingestion workflow.", "layer": "service", "docstring": "Orchestrates URL ingestion workflow.\n\nCoordinates the complete ingestion pipeline:\n1. Select adapter (AdapterRouter)\n2. Extract raw data (adapter.extract())\n3. Normalize and enrich (ListingNormalizer)\n4. Check for duplicates (DeduplicationService)\n5. Upsert listing (create or update)\n6. Emit events (IngestionEventService)\n7. Store raw payload (RawPayload model)\n\nExample:\n    >>> async with session_scope() as session:\n    ...     service = IngestionService(session)\n    ...     result = await service.ingest_single_url(\"https://ebay.com/itm/123\")\n    ...     if result.success:\n    ...         print(f\"Created listing {result.listing_id}\")", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/ingestion.py", "line": 1052, "signature": "__init__(self, session: AsyncSession)", "summary": "Initialize ingestion service.", "layer": "service", "parent": "IngestionService", "docstring": "Initialize ingestion service.\n\nArgs:\n    session: Async SQLAlchemy session for database operations", "category": "business_logic"}, {"name": "ingest_single_url", "kind": "async_method", "path": "dealbrain_api/services/ingestion.py", "line": 1064, "signature": "async ingest_single_url(self, url: str) -> IngestionResult", "summary": "Ingest a single URL through complete workflow.", "layer": "service", "parent": "IngestionService", "docstring": "Ingest a single URL through complete workflow.\n\nOrchestrates the full ingestion pipeline from URL to persisted listing.\nHandles errors gracefully and returns result with detailed status.\n\nArgs:\n    url: The URL to ingest\n\nReturns:\n    IngestionResult with outcome details (success/failure, listing_id, etc.)\n\nExample:\n    >>> result = await service.ingest_single_url(\"https://ebay.com/itm/123\")\n    >>> if result.success:\n    ...     print(f\"{result.status}: listing {result.listing_id}\")\n    ... else:\n    ...     print(f\"Failed: {result.error}\")", "category": "business_logic"}, {"name": "SettingsService", "kind": "class", "path": "dealbrain_api/services/settings.py", "line": 10, "signature": "class SettingsService", "summary": "Service for managing application settings.", "layer": "service", "docstring": "Service for managing application settings.", "category": "business_logic"}, {"name": "get_setting", "kind": "async_method", "path": "dealbrain_api/services/settings.py", "line": 13, "signature": "async get_setting(self, session: AsyncSession, key: str) -> dict[str, Any] | None", "summary": "Get a setting by key.", "layer": "service", "parent": "SettingsService", "docstring": "Get a setting by key.\n\nArgs:\n    session: Database session\n    key: Setting key\n\nReturns:\n    Setting value as dict, or None if not found", "category": "business_logic"}, {"name": "update_setting", "kind": "async_method", "path": "dealbrain_api/services/settings.py", "line": 29, "signature": "async update_setting(self, session: AsyncSession, key: str, value: dict[str, Any], description: str | None) -> dict[str, Any]", "summary": "Update or create a setting.", "layer": "service", "parent": "SettingsService", "docstring": "Update or create a setting.\n\nArgs:\n    session: Database session\n    key: Setting key\n    value: Setting value as dict\n    description: Optional description\n\nReturns:\n    Updated setting value", "category": "business_logic"}, {"name": "get_valuation_thresholds", "kind": "async_method", "path": "dealbrain_api/services/settings.py", "line": 64, "signature": "async get_valuation_thresholds(self, session: AsyncSession) -> dict[str, float]", "summary": "Get valuation thresholds with defaults.", "layer": "service", "parent": "SettingsService", "docstring": "Get valuation thresholds with defaults.\n\nArgs:\n    session: Database session\n\nReturns:\n    Thresholds dict with good_deal, great_deal, premium_warning", "category": "business_logic"}, {"name": "get_cpu_mark_thresholds", "kind": "async_method", "path": "dealbrain_api/services/settings.py", "line": 83, "signature": "async get_cpu_mark_thresholds(self, session: AsyncSession) -> dict[str, float]", "summary": "Get CPU Mark thresholds with defaults.", "layer": "service", "parent": "SettingsService", "docstring": "Get CPU Mark thresholds with defaults.\n\nThese are percentage improvement values representing price-to-performance efficiency.\nPositive values indicate better efficiency (lower $/mark), negative values indicate\nworse efficiency (higher $/mark) compared to baseline.\n\nArgs:\n    session: Database session\n\nReturns:\n    Thresholds dict with excellent, good, fair, neutral, poor, premium", "category": "business_logic"}, {"name": "apply_listing_metrics", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 288, "signature": "async apply_listing_metrics(session: AsyncSession, listing: Listing) -> None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "build_component_inputs", "kind": "function", "path": "dealbrain_api/services/listings.py", "line": 435, "signature": "build_component_inputs(listing: Listing) -> Iterable[ComponentValuationInput]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "storage_component_type", "kind": "function", "path": "dealbrain_api/services/listings.py", "line": 470, "signature": "storage_component_type(storage_type: str | None) -> ComponentType", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "get_default_profile", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 479, "signature": "async get_default_profile(session: AsyncSession) -> Profile | None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "create_listing", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 488, "signature": "async create_listing(session: AsyncSession, payload: dict) -> Listing", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "update_listing", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 507, "signature": "async update_listing(session: AsyncSession, listing: Listing, payload: dict) -> Listing", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "sync_listing_components", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 522, "signature": "async sync_listing_components(session: AsyncSession, listing: Listing, components_payload: list[dict] | None) -> None", "summary": "Replace listing components using explicit SQL to avoid lazy relationship access.", "layer": "service", "docstring": "Replace listing components using explicit SQL to avoid lazy relationship access.", "category": "business_logic"}, {"name": "partial_update_listing", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 559, "signature": "async partial_update_listing(session: AsyncSession, listing: Listing, fields: dict[str, Any] | None, attributes: dict[str, Any] | None, run_metrics: bool) -> Listing", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "update_listing_overrides", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 618, "signature": "async update_listing_overrides(session: AsyncSession, listing: Listing, mode: str, ruleset_id: int | None, disabled_rulesets: Iterable[Any] | None) -> Listing", "summary": "Update listing valuation overrides (static assignment and disabled dynamic rulesets).", "layer": "service", "docstring": "Update listing valuation overrides (static assignment and disabled dynamic rulesets).", "category": "business_logic"}, {"name": "bulk_update_listings", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 646, "signature": "async bulk_update_listings(session: AsyncSession, listing_ids: list[int], fields: dict[str, Any] | None, attributes: dict[str, Any] | None) -> list[Listing]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "calculate_cpu_performance_metrics", "kind": "function", "path": "dealbrain_api/services/listings.py", "line": 706, "signature": "calculate_cpu_performance_metrics(listing: Listing) -> dict[str, float]", "summary": "Calculate all CPU-based performance metrics for a listing.", "layer": "service", "docstring": "Calculate all CPU-based performance metrics for a listing.\n\nAdjusted metrics use component-based adjustment delta:\nadjusted_base_price = base_price + total_adjustment\n\nWhere total_adjustment comes from valuation_breakdown['total_adjustment']\n(negative values decrease price, positive values increase price)\n\nReturns\n-------\n    Dictionary with metric keys and calculated values.\n    Empty dict if CPU not assigned or missing benchmark data.", "category": "business_logic"}, {"name": "update_listing_metrics", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 749, "signature": "async update_listing_metrics(session: AsyncSession, listing_id: int) -> Listing", "summary": "Recalculate and persist all performance metrics for a listing.", "layer": "service", "docstring": "Recalculate and persist all performance metrics for a listing.\n\nArgs:\n----\n    session: Database session\n    listing_id: ID of listing to update\n\nReturns:\n-------\n    Updated listing with recalculated metrics\n\nRaises:\n------\n    ValueError: If listing not found", "category": "business_logic"}, {"name": "bulk_update_listing_metrics", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 791, "signature": "async bulk_update_listing_metrics(session: AsyncSession, listing_ids: list[int] | None) -> int", "summary": "Recalculate metrics for multiple listings.", "layer": "service", "docstring": "Recalculate metrics for multiple listings.\n\nArgs:\n----\n    session: Database session\n    listing_ids: List of IDs to update. If None, updates all listings.\n\nReturns:\n-------\n    Count of listings updated", "category": "business_logic"}, {"name": "delete_listing", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 827, "signature": "async delete_listing(session: AsyncSession, listing_id: int) -> None", "summary": "Delete listing and cascade related records.", "layer": "service", "docstring": "Delete listing and cascade related records.\n\nCascades delete to:\n- ListingComponent records\n- ListingScoreSnapshot records\n- RawPayload records\n- EntityFieldValue records (custom fields) via DB FK cascade\n\nArgs:\n----\n    session: Database session\n    listing_id: ID of listing to delete\n\nRaises:\n------\n    ValueError: Listing not found", "category": "business_logic"}, {"name": "upsert_from_url", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 872, "signature": "async upsert_from_url(session: AsyncSession, normalized: NormalizedListingSchema, dedupe_result: DeduplicationResult) -> Listing", "summary": "Upsert listing from URL ingestion.", "layer": "service", "docstring": "Upsert listing from URL ingestion.\n\nIf dedup match found, updates existing listing with new data.\nIf new listing, creates listing with URL ingestion metadata.\n\nThis method integrates URL ingestion with existing ListingsService,\nmaintaining backward compatibility with Excel import flow.\n\nArgs:\n----\n    session: Database session (caller controls transaction)\n    normalized: Normalized listing data from adapter\n    dedupe_result: Deduplication result with match info\n\nReturns:\n-------\n    Created or updated Listing instance\n\nRaises:\n------\n    ValueError: If normalized data invalid or condition cannot be mapped\n\nExample:\n-------\n    >>> from dealbrain_core.schemas.ingestion import NormalizedListingSchema\n    >>> from dealbrain_api.services.ingestion import DeduplicationResult\n    >>>\n    >>> normalized = NormalizedListingSchema(\n    ...     title=\"Gaming PC\",\n    ...     price=Decimal(\"599.99\"),\n    ...     currency=\"USD\",\n    ...     condition=\"new\",\n    ...     marketplace=\"ebay\",\n    ...     vendor_item_id=\"123456789012\",\n    ...     provenance=\"ebay_api\",\n    ...     dedup_hash=\"abc123...\",\n    ... )\n    >>> dedupe_result = DeduplicationResult(\n    ...     exists=False,\n    ...     existing_listing=None,\n    ...     is_exact_match=False,\n    ...     confidence=0.0,\n    ...     dedup_hash=\"abc123...\",\n    ... )\n    >>> listing = await upsert_from_url(session, normalized, dedupe_result)", "category": "business_logic"}, {"name": "encode_cursor", "kind": "function", "path": "dealbrain_api/services/listings.py", "line": 1039, "signature": "encode_cursor(listing_id: int, sort_value: Any) -> str", "summary": "Encode cursor for keyset pagination.", "layer": "service", "docstring": "Encode cursor for keyset pagination.\n\nArgs:\n    listing_id: Listing ID\n    sort_value: Value of the sort column (converted to string for serialization)\n\nReturns:\n    Base64-encoded cursor string", "category": "business_logic"}, {"name": "decode_cursor", "kind": "function", "path": "dealbrain_api/services/listings.py", "line": 1058, "signature": "decode_cursor(cursor: str) -> tuple[int, str | None]", "summary": "Decode cursor for keyset pagination.", "layer": "service", "docstring": "Decode cursor for keyset pagination.\n\nArgs:\n    cursor: Base64-encoded cursor string\n\nReturns:\n    Tuple of (listing_id, sort_value)\n\nRaises:\n    ValueError: If cursor is invalid", "category": "business_logic"}, {"name": "get_paginated_listings", "kind": "async_function", "path": "dealbrain_api/services/listings.py", "line": 1079, "signature": "async get_paginated_listings(session: AsyncSession, limit: int, cursor: str | None, sort_by: str, sort_order: str, form_factor: str | None, manufacturer: str | None, min_price: float | None, max_price: float | None) -> dict[str, Any]", "summary": "Get paginated listings using cursor-based (keyset) pagination.", "layer": "service", "docstring": "Get paginated listings using cursor-based (keyset) pagination.\n\nImplements high-performance cursor-based pagination with:\n- Composite key (sort_column, id) for stable pagination\n- Base64-encoded cursors to prevent manipulation\n- Cached total count (5 minutes TTL)\n- Support for dynamic sorting and filtering\n\nArgs:\n    session: Database session\n    limit: Number of items per page (1-500, default 50)\n    cursor: Pagination cursor from previous response\n    sort_by: Column to sort by (default \"updated_at\")\n    sort_order: Sort direction (\"asc\" or \"desc\", default \"desc\")\n    form_factor: Filter by form factor\n    manufacturer: Filter by manufacturer\n    min_price: Filter by minimum price\n    max_price: Filter by maximum price\n\nReturns:\n    Dictionary with:\n    - items: List of Listing objects\n    - total: Total count (cached)\n    - limit: Requested limit\n    - next_cursor: Cursor for next page (None if last page)\n    - has_next: Boolean indicating if more pages exist\n\nRaises:\n    ValueError: If sort_by contains invalid characters or cursor is malformed", "category": "business_logic"}, {"name": "SchemaField", "kind": "class", "path": "dealbrain_api/services/imports/specs.py", "line": 11, "signature": "class SchemaField", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "all_keys", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 20, "signature": "all_keys(self) -> tuple[str, ...]", "summary": "", "layer": "service", "parent": "SchemaField", "category": "business_logic"}, {"name": "ImportSchema", "kind": "class", "path": "dealbrain_api/services/imports/specs.py", "line": 25, "signature": "class ImportSchema", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "field_by_key", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 31, "signature": "field_by_key(self, key: str) -> SchemaField | None", "summary": "", "layer": "service", "parent": "ImportSchema", "category": "business_logic"}, {"name": "required_fields", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 34, "signature": "required_fields(self) -> tuple[SchemaField, ...]", "summary": "", "layer": "service", "parent": "ImportSchema", "category": "business_logic"}, {"name": "optional_fields", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 37, "signature": "optional_fields(self) -> tuple[SchemaField, ...]", "summary": "", "layer": "service", "parent": "ImportSchema", "category": "business_logic"}, {"name": "score_columns", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 40, "signature": "score_columns(self, columns: Sequence[str]) -> float", "summary": "Return a confidence score that a sheet with these columns fits this schema.", "layer": "service", "parent": "ImportSchema", "docstring": "Return a confidence score that a sheet with these columns fits this schema.", "category": "business_logic"}, {"name": "keyword_bonus", "kind": "method", "path": "dealbrain_api/services/imports/specs.py", "line": 52, "signature": "keyword_bonus(self, sheet_name: str) -> float", "summary": "", "layer": "service", "parent": "ImportSchema", "category": "business_logic"}, {"name": "normalize_column", "kind": "function", "path": "dealbrain_api/services/imports/specs.py", "line": 63, "signature": "normalize_column(value: str) -> str", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "iter_schemas", "kind": "function", "path": "dealbrain_api/services/imports/specs.py", "line": 145, "signature": "iter_schemas() -> Iterable[ImportSchema]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "normalize_text", "kind": "function", "path": "dealbrain_api/services/imports/utils.py", "line": 17, "signature": "normalize_text(value: str | None) -> str", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "checksum_bytes", "kind": "function", "path": "dealbrain_api/services/imports/utils.py", "line": 23, "signature": "checksum_bytes(payload: bytes) -> str", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "load_dataframe_preview", "kind": "function", "path": "dealbrain_api/services/imports/utils.py", "line": 27, "signature": "load_dataframe_preview(dataframe: DataFrame, limit: int) -> list[dict[str, Any]]", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "ensure_directory", "kind": "function", "path": "dealbrain_api/services/imports/utils.py", "line": 37, "signature": "ensure_directory(path: Path) -> None", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "dumps_json", "kind": "function", "path": "dealbrain_api/services/imports/utils.py", "line": 41, "signature": "dumps_json(value: Any) -> str", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "MappingCandidate", "kind": "class", "path": "dealbrain_api/services/imports/service.py", "line": 40, "signature": "class MappingCandidate", "summary": "", "layer": "service", "category": "business_logic"}, {"name": "to_dict", "kind": "method", "path": "dealbrain_api/services/imports/service.py", "line": 45, "signature": "to_dict(self) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "MappingCandidate", "category": "business_logic"}, {"name": "ImportSessionService", "kind": "class", "path": "dealbrain_api/services/imports/service.py", "line": 53, "signature": "class ImportSessionService", "summary": "Coordinates the importer workflow: upload, mapping, preview, and conflicts.", "layer": "service", "docstring": "Coordinates the importer workflow: upload, mapping, preview, and conflicts.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/services/imports/service.py", "line": 56, "signature": "__init__(self, settings: Settings | None) -> None", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "create_session", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 59, "signature": "async create_session(self, db: AsyncSession, upload: UploadFile, declared_entities: Mapping[str, str] | None, created_by: str | None) -> ImportSession", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "refresh_preview", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 128, "signature": "async refresh_preview(self, db: AsyncSession, import_session: ImportSession, limit: int) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "update_mappings", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 142, "signature": "async update_mappings(self, db: AsyncSession, import_session: ImportSession, mappings: dict[str, Any]) -> ImportSession", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "compute_conflicts", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 155, "signature": "async compute_conflicts(self, db: AsyncSession, import_session: ImportSession) -> dict[str, Any]", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "commit", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 168, "signature": "async commit(self, db: AsyncSession, import_session: ImportSession, conflict_resolutions: Mapping[str, str], component_overrides: Mapping[int, dict[str, Any]]) -> tuple[dict[str, int], list[str]]", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "attach_custom_field", "kind": "async_method", "path": "dealbrain_api/services/imports/service.py", "line": 998, "signature": "async attach_custom_field(self, db: AsyncSession, import_session: ImportSession, field: CustomFieldDefinition) -> ImportSession", "summary": "", "layer": "service", "parent": "ImportSessionService", "category": "business_logic"}, {"name": "drop_all_tables", "kind": "function", "path": "dealbrain_api/scripts/drop_db_objects.py", "line": 25, "signature": "drop_all_tables(engine)", "summary": "", "layer": "core", "category": "script"}, {"name": "drop_all_enums", "kind": "function", "path": "dealbrain_api/scripts/drop_db_objects.py", "line": 31, "signature": "drop_all_enums(engine)", "summary": "", "layer": "core", "category": "script"}, {"name": "main", "kind": "function", "path": "dealbrain_api/scripts/drop_db_objects.py", "line": 55, "signature": "main()", "summary": "", "layer": "core", "category": "script"}, {"name": "ConditionSchema", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 11, "signature": "class ConditionSchema(BaseModel)", "summary": "Schema for a rule condition", "layer": "schema", "docstring": "Schema for a rule condition", "category": "business_logic"}, {"name": "ActionSchema", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 23, "signature": "class ActionSchema(BaseModel)", "summary": "Schema for a rule action", "layer": "schema", "docstring": "Schema for a rule action", "category": "business_logic"}, {"name": "validate_metric_requirements", "kind": "method", "path": "dealbrain_api/schemas/rules.py", "line": 36, "signature": "validate_metric_requirements(self) -> 'ActionSchema'", "summary": "Ensure metric is provided for metric-dependent action types.", "layer": "schema", "parent": "ActionSchema", "docstring": "Ensure metric is provided for metric-dependent action types.", "category": "business_logic"}, {"name": "RuleCreateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 45, "signature": "class RuleCreateRequest(BaseModel)", "summary": "Request schema for creating a rule", "layer": "schema", "docstring": "Request schema for creating a rule", "category": "business_logic"}, {"name": "RuleUpdateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 58, "signature": "class RuleUpdateRequest(BaseModel)", "summary": "Request schema for updating a rule", "layer": "schema", "docstring": "Request schema for updating a rule", "category": "business_logic"}, {"name": "RuleResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 70, "signature": "class RuleResponse(BaseModel)", "summary": "Response schema for a rule", "layer": "schema", "docstring": "Response schema for a rule", "category": "business_logic"}, {"name": "Config", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 87, "signature": "class Config", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "RuleGroupCreateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 93, "signature": "class RuleGroupCreateRequest(BaseModel)", "summary": "Request schema for creating a rule group", "layer": "schema", "docstring": "Request schema for creating a rule group", "category": "business_logic"}, {"name": "validate_basic_managed_requirements", "kind": "method", "path": "dealbrain_api/schemas/rules.py", "line": 107, "signature": "validate_basic_managed_requirements(self) -> 'RuleGroupCreateRequest'", "summary": "Ensure basic_managed groups have entity_key.", "layer": "schema", "parent": "RuleGroupCreateRequest", "docstring": "Ensure basic_managed groups have entity_key.", "category": "business_logic"}, {"name": "RuleGroupUpdateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 114, "signature": "class RuleGroupUpdateRequest(BaseModel)", "summary": "Request schema for updating a rule group", "layer": "schema", "docstring": "Request schema for updating a rule group", "category": "business_logic"}, {"name": "validate_basic_managed_requirements", "kind": "method", "path": "dealbrain_api/schemas/rules.py", "line": 129, "signature": "validate_basic_managed_requirements(self) -> 'RuleGroupUpdateRequest'", "summary": "Ensure basic_managed groups have entity_key.", "layer": "schema", "parent": "RuleGroupUpdateRequest", "docstring": "Ensure basic_managed groups have entity_key.", "category": "business_logic"}, {"name": "RuleGroupResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 136, "signature": "class RuleGroupResponse(BaseModel)", "summary": "Response schema for a rule group", "layer": "schema", "docstring": "Response schema for a rule group", "category": "business_logic"}, {"name": "Config", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 153, "signature": "class Config", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "RulesetCreateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 159, "signature": "class RulesetCreateRequest(BaseModel)", "summary": "Request schema for creating a ruleset", "layer": "schema", "docstring": "Request schema for creating a ruleset", "category": "business_logic"}, {"name": "RulesetUpdateRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 177, "signature": "class RulesetUpdateRequest(BaseModel)", "summary": "Request schema for updating a ruleset", "layer": "schema", "docstring": "Request schema for updating a ruleset", "category": "business_logic"}, {"name": "RulesetResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 195, "signature": "class RulesetResponse(BaseModel)", "summary": "Response schema for a ruleset", "layer": "schema", "docstring": "Response schema for a ruleset", "category": "business_logic"}, {"name": "Config", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 210, "signature": "class Config", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "RulePreviewRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 216, "signature": "class RulePreviewRequest(BaseModel)", "summary": "Request schema for previewing a rule", "layer": "schema", "docstring": "Request schema for previewing a rule", "category": "business_logic"}, {"name": "SampleListingResult", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 224, "signature": "class SampleListingResult(BaseModel)", "summary": "Sample listing evaluation result", "layer": "schema", "docstring": "Sample listing evaluation result", "category": "business_logic"}, {"name": "RulePreviewResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 234, "signature": "class RulePreviewResponse(BaseModel)", "summary": "Response schema for rule preview", "layer": "schema", "docstring": "Response schema for rule preview", "category": "business_logic"}, {"name": "RuleEvaluationResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 243, "signature": "class RuleEvaluationResponse(BaseModel)", "summary": "Response schema for rule evaluation", "layer": "schema", "docstring": "Response schema for rule evaluation", "category": "business_logic"}, {"name": "BulkEvaluationRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 255, "signature": "class BulkEvaluationRequest(BaseModel)", "summary": "Request schema for bulk evaluation", "layer": "schema", "docstring": "Request schema for bulk evaluation", "category": "business_logic"}, {"name": "ApplyRulesetRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 261, "signature": "class ApplyRulesetRequest(BaseModel)", "summary": "Request schema for applying a ruleset", "layer": "schema", "docstring": "Request schema for applying a ruleset", "category": "business_logic"}, {"name": "AuditLogResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 269, "signature": "class AuditLogResponse(BaseModel)", "summary": "Response schema for audit log entry", "layer": "schema", "docstring": "Response schema for audit log entry", "category": "business_logic"}, {"name": "Config", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 279, "signature": "class Config", "summary": "", "layer": "schema", "category": "business_logic"}, {"name": "RuleExportRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 285, "signature": "class RuleExportRequest(BaseModel)", "summary": "Request schema for exporting rules", "layer": "schema", "docstring": "Request schema for exporting rules", "category": "business_logic"}, {"name": "RuleImportRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 292, "signature": "class RuleImportRequest(BaseModel)", "summary": "Request schema for importing rules", "layer": "schema", "docstring": "Request schema for importing rules", "category": "business_logic"}, {"name": "PackageMetadataRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 302, "signature": "class PackageMetadataRequest(BaseModel)", "summary": "Request schema for package metadata", "layer": "schema", "docstring": "Request schema for package metadata", "category": "business_logic"}, {"name": "PackageExportResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 314, "signature": "class PackageExportResponse(BaseModel)", "summary": "Response schema for package export preview", "layer": "schema", "docstring": "Response schema for package export preview", "category": "business_logic"}, {"name": "PackageInstallResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 327, "signature": "class PackageInstallResponse(BaseModel)", "summary": "Response schema for package installation", "layer": "schema", "docstring": "Response schema for package installation", "category": "business_logic"}, {"name": "FormulaValidationRequest", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 340, "signature": "class FormulaValidationRequest(BaseModel)", "summary": "Request schema for validating a formula", "layer": "schema", "docstring": "Request schema for validating a formula", "category": "business_logic"}, {"name": "FormulaValidationError", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 347, "signature": "class FormulaValidationError(BaseModel)", "summary": "Schema for a formula validation error", "layer": "schema", "docstring": "Schema for a formula validation error", "category": "business_logic"}, {"name": "FormulaValidationResponse", "kind": "class", "path": "dealbrain_api/schemas/rules.py", "line": 355, "signature": "class FormulaValidationResponse(BaseModel)", "summary": "Response schema for formula validation", "layer": "schema", "docstring": "Response schema for formula validation", "category": "business_logic"}, {"name": "ValuationThresholdsResponse", "kind": "class", "path": "dealbrain_api/schemas/settings.py", "line": 6, "signature": "class ValuationThresholdsResponse(BaseModel)", "summary": "Valuation thresholds for pricing color coding.", "layer": "schema", "docstring": "Valuation thresholds for pricing color coding.\n\nThese are percentage values representing price differences from base valuation.", "category": "business_logic"}, {"name": "CpuMarkThresholdsResponse", "kind": "class", "path": "dealbrain_api/schemas/settings.py", "line": 25, "signature": "class CpuMarkThresholdsResponse(BaseModel)", "summary": "CPU Mark thresholds for performance efficiency color coding.", "layer": "schema", "docstring": "CPU Mark thresholds for performance efficiency color coding.\n\nThese are percentage improvement values representing price-to-performance efficiency.\nPositive values indicate better efficiency (lower $/mark), negative values indicate\nworse efficiency (higher $/mark) compared to baseline.\n\nExample: excellent=20.0 means \u226520% improvement (20% lower $/mark than baseline)", "category": "business_logic"}, {"name": "seed_sample_ruleset", "kind": "async_function", "path": "dealbrain_api/seed_scripts/valuation_rules_v2.py", "line": 14, "signature": "async seed_sample_ruleset()", "summary": "Create a sample ruleset with example rules", "layer": "core", "docstring": "Create a sample ruleset with example rules", "category": "business_logic"}, {"name": "ingest_url_task", "kind": "function", "path": "dealbrain_api/tasks/ingestion.py", "line": 176, "signature": "ingest_url_task(self, job_id: str, url: str, adapter_config: dict[str, Any] | None) -> dict[str, Any]", "summary": "Celery task for async URL ingestion.", "layer": "core", "docstring": "Celery task for async URL ingestion.\n\nFollows the async event loop pattern from valuation.py for consistency.\nImplements retry logic with exponential backoff for transient errors.\n\nArgs:\n    job_id: ImportSession UUID as string\n    url: URL to ingest\n    adapter_config: Optional adapter configuration (reserved for future use)\n\nReturns:\n    Dict with ingestion result containing:\n    - success: bool\n    - listing_id: int | None\n    - status: str (complete|partial|failed)\n    - provenance: str\n    - quality: str\n    - error: str | None\n\nRaises:\n    Retry: For transient errors (timeout, connection errors)", "category": "business_logic"}, {"name": "cleanup_expired_payloads_task", "kind": "function", "path": "dealbrain_api/tasks/ingestion.py", "line": 345, "signature": "cleanup_expired_payloads_task() -> dict[str, Any]", "summary": "Celery task for cleaning up expired raw payloads.", "layer": "core", "docstring": "Celery task for cleaning up expired raw payloads.\n\nRuns as a periodic task (configured via Celery Beat) to remove\nRawPayload records older than configured TTL. Prevents unbounded\nstorage growth while preserving recent payloads for debugging.\n\nReturns:\n    Dict with cleanup statistics containing:\n    - deleted_count: Number of records deleted\n    - ttl_days: Configured TTL in days\n    - cutoff_date: ISO timestamp of cutoff date\n\nExample:\n    >>> result = cleanup_expired_payloads_task.delay()\n    >>> result.get()\n    {'deleted_count': 42, 'ttl_days': 30, 'cutoff_date': '2025-09-19T...'}", "category": "business_logic"}, {"name": "recalculate_listings_task", "kind": "function", "path": "dealbrain_api/tasks/valuation.py", "line": 120, "signature": "recalculate_listings_task(self, listing_ids: Iterable[int | str | None] | None, ruleset_id: int | None, batch_size: int, include_inactive: bool, reason: str | None) -> dict[str, int]", "summary": "Celery task entry-point for listing recalculation.", "layer": "core", "docstring": "Celery task entry-point for listing recalculation.", "category": "business_logic"}, {"name": "enqueue_listing_recalculation", "kind": "function", "path": "dealbrain_api/tasks/valuation.py", "line": 173, "signature": "enqueue_listing_recalculation(listing_ids: Iterable[int | str | None] | None, ruleset_id: int | None, reason: str | None, use_celery: bool) -> None", "summary": "Schedule listing valuation recalculation.", "layer": "core", "docstring": "Schedule listing valuation recalculation.\n\nFalls back to synchronous execution in environments where Celery workers\nare unavailable (e.g., unit tests).", "category": "business_logic"}, {"name": "recalculate_metrics_task", "kind": "function", "path": "dealbrain_api/tasks/admin.py", "line": 29, "signature": "recalculate_metrics_task(listing_ids: list[int] | None) -> dict[str, int]", "summary": "Celery task to recalculate listing metrics.", "layer": "core", "docstring": "Celery task to recalculate listing metrics.", "category": "business_logic"}, {"name": "recalculate_cpu_mark_metrics_task", "kind": "function", "path": "dealbrain_api/tasks/admin.py", "line": 63, "signature": "recalculate_cpu_mark_metrics_task(listing_ids: list[int] | None) -> dict[str, int]", "summary": "Celery task to recalculate CPU Mark metrics.", "layer": "core", "docstring": "Celery task to recalculate CPU Mark metrics.", "category": "business_logic"}, {"name": "import_passmark_task", "kind": "function", "path": "dealbrain_api/tasks/admin.py", "line": 95, "signature": "import_passmark_task(file_path: str) -> dict[str, object]", "summary": "Celery task to import PassMark benchmark data.", "layer": "core", "docstring": "Celery task to import PassMark benchmark data.", "category": "business_logic"}, {"name": "import_entities_task", "kind": "function", "path": "dealbrain_api/tasks/admin.py", "line": 137, "signature": "import_entities_task(entity: str, file_path: str, dry_run: bool) -> dict[str, object]", "summary": "Celery task to import entities from file.", "layer": "core", "docstring": "Celery task to import entities from file.", "category": "business_logic"}, {"name": "load_baseline_task", "kind": "function", "path": "dealbrain_api/tasks/baseline.py", "line": 40, "signature": "load_baseline_task(source_path: str, actor: str | None, ensure_basic_for_ruleset: int | None) -> dict[str, object]", "summary": "Celery task to ingest a baseline JSON artifact into the system.", "layer": "core", "docstring": "Celery task to ingest a baseline JSON artifact into the system.", "category": "business_logic"}, {"name": "seed_component_catalog", "kind": "async_function", "path": "dealbrain_api/seeds/component_catalog.py", "line": 115, "signature": "async seed_component_catalog(session: AsyncSession) -> None", "summary": "Ensure canonical RAM specs and storage profiles exist.", "layer": "core", "docstring": "Ensure canonical RAM specs and storage profiles exist.", "category": "business_logic"}, {"name": "seed_cpu_mark_thresholds", "kind": "async_function", "path": "dealbrain_api/seeds/cpu_mark_thresholds_seed.py", "line": 18, "signature": "async seed_cpu_mark_thresholds(session: AsyncSession) -> None", "summary": "Insert default CPU Mark thresholds into ApplicationSettings.", "layer": "core", "docstring": "Insert default CPU Mark thresholds into ApplicationSettings.\n\nUses ON CONFLICT DO NOTHING to avoid overwriting existing configuration.\nThese are percentage improvement values representing price-to-performance efficiency.\n\nArgs:\n    session: Database session", "category": "business_logic"}, {"name": "apply_seed", "kind": "async_function", "path": "dealbrain_api/seeds/__init__.py", "line": 26, "signature": "async apply_seed(seed: SpreadsheetSeed) -> None", "summary": "", "layer": "core", "category": "config"}, {"name": "seed_from_workbook", "kind": "async_function", "path": "dealbrain_api/seeds/__init__.py", "line": 114, "signature": "async seed_from_workbook(path: Path) -> None", "summary": "", "layer": "core", "category": "config"}, {"name": "run", "kind": "async_function", "path": "dealbrain_api/seeds/__init__.py", "line": 128, "signature": "async run() -> None", "summary": "", "layer": "core", "category": "config"}, {"name": "main", "kind": "function", "path": "dealbrain_api/cli/__main__.py", "line": 6, "signature": "main() -> None", "summary": "", "layer": "core", "category": "business_logic"}, {"name": "load_baseline", "kind": "function", "path": "dealbrain_api/cli/baselines.py", "line": 18, "signature": "load_baseline(source: Path, actor: str, ensure_basic_ruleset_id: int, output_json: bool) -> None", "summary": "Populate the System Baseline ruleset from a JSON artifact.", "layer": "core", "docstring": "Populate the System Baseline ruleset from a JSON artifact.", "category": "business_logic"}, {"name": "validate_basic_managed_group", "kind": "function", "path": "dealbrain_api/validation/rules_validation.py", "line": 17, "signature": "validate_basic_managed_group(group_metadata: dict[str, Any] | None, operation: str) -> None", "summary": "Prevent manual edits to basic-managed groups.", "layer": "core", "docstring": "Prevent manual edits to basic-managed groups.\n\nArgs:\n    group_metadata: The metadata_json from the group\n    operation: The operation being attempted (e.g., 'update', 'delete')\n\nRaises:\n    HTTPException: 403 Forbidden if group is basic-managed", "category": "business_logic"}, {"name": "validate_entity_key", "kind": "function", "path": "dealbrain_api/validation/rules_validation.py", "line": 38, "signature": "validate_entity_key(entity_key: str | None) -> None", "summary": "Ensure entity key is from valid set.", "layer": "core", "docstring": "Ensure entity key is from valid set.\n\nArgs:\n    entity_key: The entity key to validate\n\nRaises:\n    HTTPException: 400 Bad Request if entity key is invalid", "category": "business_logic"}, {"name": "validate_modifiers_json", "kind": "function", "path": "dealbrain_api/validation/rules_validation.py", "line": 55, "signature": "validate_modifiers_json(modifiers: dict[str, Any] | None, action_type: str) -> None", "summary": "Validate modifiers match action type.", "layer": "core", "docstring": "Validate modifiers match action type.\n\nArgs:\n    modifiers: The modifiers dictionary from the action\n    action_type: The action type (e.g., 'fixed_value', 'per_unit')\n\nRaises:\n    HTTPException: 400 Bad Request if modifiers are invalid", "category": "business_logic"}, {"name": "extract_metadata_fields", "kind": "function", "path": "dealbrain_api/validation/rules_validation.py", "line": 108, "signature": "extract_metadata_fields(metadata: dict[str, Any] | None) -> tuple[bool | None, str | None]", "summary": "Extract basic_managed and entity_key from metadata.", "layer": "core", "docstring": "Extract basic_managed and entity_key from metadata.\n\nArgs:\n    metadata: The metadata dictionary\n\nReturns:\n    Tuple of (basic_managed, entity_key)", "category": "business_logic"}, {"name": "merge_metadata_fields", "kind": "function", "path": "dealbrain_api/validation/rules_validation.py", "line": 126, "signature": "merge_metadata_fields(existing_metadata: dict[str, Any] | None, basic_managed: bool | None, entity_key: str | None, additional_metadata: dict[str, Any] | None) -> dict[str, Any]", "summary": "Merge basic_managed and entity_key into metadata dictionary.", "layer": "core", "docstring": "Merge basic_managed and entity_key into metadata dictionary.\n\nArgs:\n    existing_metadata: Current metadata dictionary\n    basic_managed: Basic managed flag to set\n    entity_key: Entity key to set\n    additional_metadata: Additional metadata to merge\n\nReturns:\n    Merged metadata dictionary", "category": "business_logic"}, {"name": "AdapterError", "kind": "class", "path": "dealbrain_api/adapters/base.py", "line": 16, "signature": "class AdapterError(str, Enum)", "summary": "Error types for adapter operations.", "layer": "core", "docstring": "Error types for adapter operations.\n\nThese standardized error codes allow the ingestion service to handle\nfailures consistently across different adapters and implement appropriate\nretry strategies.\n\nAttributes:\n    TIMEOUT: Request exceeded configured timeout\n    INVALID_SCHEMA: Response data failed validation\n    ADAPTER_DISABLED: Adapter is disabled in settings\n    RATE_LIMITED: Rate limit exceeded, retry later\n    ITEM_NOT_FOUND: Resource not found (404 or equivalent)\n    NETWORK_ERROR: Network connectivity issue\n    PARSE_ERROR: Failed to parse response data\n    NO_STRUCTURED_DATA: No structured data (JSON-LD/Microdata) found\n    NO_ADAPTER_FOUND: No adapter matches the given URL\n    CONFIGURATION_ERROR: Adapter configuration is missing or invalid\n    ALL_ADAPTERS_FAILED: All adapters attempted and failed", "category": "business_logic"}, {"name": "AdapterException", "kind": "class", "path": "dealbrain_api/adapters/base.py", "line": 51, "signature": "class AdapterException(Exception)", "summary": "Base exception for adapter errors.", "layer": "core", "docstring": "Base exception for adapter errors.\n\nAttributes:\n    error_type: AdapterError enum value\n    message: Human-readable error message\n    metadata: Additional context (optional)", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/base.py", "line": 61, "signature": "__init__(self, error_type: AdapterError, message: str, metadata: dict[str, Any] | None)", "summary": "", "layer": "core", "parent": "AdapterException", "category": "business_logic"}, {"name": "RateLimitConfig", "kind": "class", "path": "dealbrain_api/adapters/base.py", "line": 73, "signature": "class RateLimitConfig", "summary": "Rate limiting configuration for an adapter.", "layer": "core", "docstring": "Rate limiting configuration for an adapter.\n\nAttributes:\n    requests_per_minute: Maximum requests per minute\n    current_count: Current request count in the time window\n    window_start: Start time of current rate limit window", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/base.py", "line": 83, "signature": "__init__(self, requests_per_minute: int)", "summary": "", "layer": "core", "parent": "RateLimitConfig", "category": "business_logic"}, {"name": "check_and_wait", "kind": "async_method", "path": "dealbrain_api/adapters/base.py", "line": 88, "signature": "async check_and_wait(self) -> None", "summary": "Check rate limit and wait if necessary.", "layer": "core", "parent": "RateLimitConfig", "docstring": "Check rate limit and wait if necessary.\n\nRaises:\n    AdapterException: If rate limit is exceeded and cannot wait", "category": "business_logic"}, {"name": "RetryConfig", "kind": "class", "path": "dealbrain_api/adapters/base.py", "line": 118, "signature": "class RetryConfig", "summary": "Retry configuration for adapter requests.", "layer": "core", "docstring": "Retry configuration for adapter requests.\n\nAttributes:\n    max_retries: Maximum number of retry attempts\n    backoff_factor: Exponential backoff multiplier (seconds)\n    retryable_errors: Error types that should trigger a retry", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/base.py", "line": 128, "signature": "__init__(self, max_retries: int, backoff_factor: float, retryable_errors: set[AdapterError] | None)", "summary": "", "layer": "core", "parent": "RetryConfig", "category": "business_logic"}, {"name": "execute_with_retry", "kind": "async_method", "path": "dealbrain_api/adapters/base.py", "line": 142, "signature": "async execute_with_retry(self, operation: Any) -> Any", "summary": "Execute an async operation with retry logic.", "layer": "core", "parent": "RetryConfig", "docstring": "Execute an async operation with retry logic.\n\nArgs:\n    operation: Async function to execute\n    *args: Positional arguments for operation\n    **kwargs: Keyword arguments for operation\n\nReturns:\n    Result from successful operation execution\n\nRaises:\n    AdapterException: If all retries are exhausted", "category": "business_logic"}, {"name": "BaseAdapter", "kind": "class", "path": "dealbrain_api/adapters/base.py", "line": 192, "signature": "class BaseAdapter(ABC)", "summary": "Abstract base class for all URL ingestion adapters.", "layer": "core", "docstring": "Abstract base class for all URL ingestion adapters.\n\nAll adapters (eBay API, JSON-LD, generic scraper) must inherit from this\nclass and implement the extract() method. The base class provides common\nfunctionality like rate limiting, retry logic, and timeout handling.\n\nAdapter Pattern:\n----------------\n1. Each adapter handles a specific data source (eBay API, JSON-LD, etc.)\n2. All adapters produce the same output: NormalizedListingSchema\n3. The ingestion service tries adapters in priority order\n4. First successful extraction wins\n\nHow to Implement a New Adapter:\n--------------------------------\n1. Inherit from BaseAdapter\n2. Set adapter metadata (name, supported_domains, priority)\n3. Implement async extract(url: str) -> NormalizedListingSchema\n4. Use self.retry_config.execute_with_retry() for HTTP requests\n5. Raise AdapterException with appropriate error_type on failure\n\nExample:\n--------\n```python\nclass EbayApiAdapter(BaseAdapter):\n    def __init__(self, api_key: str, timeout_s: int = 6):\n        super().__init__(\n            name=\"ebay_api\",\n            supported_domains=[\"ebay.com\", \"ebay.co.uk\"],\n            priority=1,  # Highest priority\n            timeout_s=timeout_s,\n            max_retries=2,\n        )\n        self.api_key = api_key\n\n    async def extract(self, url: str) -> NormalizedListingSchema:\n        # Extract item ID from URL\n        item_id = self._parse_item_id(url)\n\n        # Fetch from API with retry\n        data = await self.retry_config.execute_with_retry(\n            self._fetch_item, item_id\n        )\n\n        # Transform to normalized schema\n        return self._transform(data)\n```\n\nAttributes:\n    name: Adapter identifier (e.g., \"ebay_api\", \"jsonld\")\n    supported_domains: List of domains this adapter can handle\n    priority: Adapter priority (lower = higher priority)\n    timeout_s: Request timeout in seconds\n    rate_limit_config: Rate limiting configuration\n    retry_config: Retry strategy configuration", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/base.py", "line": 251, "signature": "__init__(self, name: str, supported_domains: list[str], priority: int, timeout_s: int, max_retries: int, requests_per_minute: int)", "summary": "Initialize base adapter.", "layer": "core", "parent": "BaseAdapter", "docstring": "Initialize base adapter.\n\nArgs:\n    name: Adapter identifier (e.g., \"ebay_api\")\n    supported_domains: List of domains (e.g., [\"ebay.com\"])\n    priority: Adapter priority (lower = higher priority)\n    timeout_s: Request timeout in seconds\n    max_retries: Maximum retry attempts\n    requests_per_minute: Rate limit threshold", "category": "business_logic"}, {"name": "extract", "kind": "async_method", "path": "dealbrain_api/adapters/base.py", "line": 279, "signature": "async extract(self, url: str) -> NormalizedListingSchema", "summary": "Extract listing data from URL and return normalized schema.", "layer": "core", "parent": "BaseAdapter", "docstring": "Extract listing data from URL and return normalized schema.\n\nThis is the main method that each adapter must implement. It should:\n1. Parse the URL to extract necessary identifiers\n2. Fetch data from the source (API, webpage, etc.)\n3. Transform the raw data into NormalizedListingSchema\n4. Validate the schema before returning\n\nArgs:\n    url: URL to extract listing data from\n\nReturns:\n    NormalizedListingSchema with normalized listing data\n\nRaises:\n    AdapterException: If extraction fails for any reason", "category": "business_logic"}, {"name": "supports_url", "kind": "method", "path": "dealbrain_api/adapters/base.py", "line": 300, "signature": "supports_url(self, url: str) -> bool", "summary": "Check if this adapter supports the given URL.", "layer": "core", "parent": "BaseAdapter", "docstring": "Check if this adapter supports the given URL.\n\nArgs:\n    url: URL to check\n\nReturns:\n    True if URL domain matches supported_domains", "category": "business_logic"}, {"name": "EbayAdapter", "kind": "class", "path": "dealbrain_api/adapters/ebay.py", "line": 19, "signature": "class EbayAdapter(BaseAdapter)", "summary": "eBay Browse API adapter for extracting listing data.", "layer": "core", "docstring": "eBay Browse API adapter for extracting listing data.\n\nThis adapter uses the eBay Browse API v1 to fetch item details from eBay URLs.\nIt parses item IDs from various eBay URL formats, calls the Browse API with\nOAuth authentication, and maps the response to NormalizedListingSchema.\n\nURL Formats Supported:\n----------------------\n- https://www.ebay.com/itm/123456789012\n- https://www.ebay.com/itm/Product-Name/123456789012\n- https://ebay.com/itm/123456789012?hash=...\n- https://www.ebay.com/itm/123456789012?_trkparms=...\n\neBay API Integration:\n--------------------\n- Endpoint: GET /buy/browse/v1/item/{item_id}\n- Authentication: OAuth 2.0 Application token (from settings)\n- Headers: Authorization: Bearer {access_token}\n          X-EBAY-C-MARKETPLACE-ID: EBAY_US\n\nData Mapping:\n------------\nMaps eBay Browse API response fields to NormalizedListingSchema:\n- title: item.title\n- price: item.price.value (converted to Decimal)\n- currency: item.price.currency\n- condition: Normalized from item.condition\n- images: [item.image.imageUrl] (primary image only)\n- seller: item.seller.username\n- marketplace: \"ebay\"\n- vendor_item_id: item.itemId\n- description: item.description\n\nItem specifics (CPU, RAM, storage) are extracted from item.localizedAspects\nor item.itemSpecifics array.\n\nError Handling:\n--------------\n- ITEM_NOT_FOUND (404): Item does not exist or has been removed\n- INVALID_CREDENTIALS (401): Invalid or expired OAuth token\n- RATE_LIMITED (429): API rate limit exceeded\n- TIMEOUT: Request timeout (retries with exponential backoff)\n- PARSE_ERROR: Failed to parse item ID from URL\n\nRetry Logic:\n-----------\n- Exponential backoff: 1s, 2s, 4s\n- Max retries: Configured from settings (default 2)\n- Retry on: 429, 500, 503, timeout\n- Don't retry: 400, 401, 404", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/ebay.py", "line": 78, "signature": "__init__(self) -> None", "summary": "Initialize eBay adapter.", "layer": "core", "parent": "EbayAdapter", "docstring": "Initialize eBay adapter.\n\nLoads configuration from settings including API key, timeout, and retries.\nAPI key validation is deferred to extract() method to allow adapter\ninitialization to succeed even without API key (enables fallback chain).", "category": "business_logic"}, {"name": "extract", "kind": "async_method", "path": "dealbrain_api/adapters/ebay.py", "line": 108, "signature": "async extract(self, url: str) -> NormalizedListingSchema", "summary": "Extract listing data from eBay URL.", "layer": "core", "parent": "EbayAdapter", "docstring": "Extract listing data from eBay URL.\n\nThis is the main entry point that orchestrates the extraction workflow:\n1. Validate API key is configured\n2. Parse item ID from URL\n3. Fetch item data from eBay Browse API (with retry)\n4. Map API response to NormalizedListingSchema\n\nArgs:\n    url: eBay item URL to extract data from\n\nReturns:\n    NormalizedListingSchema with normalized listing data\n\nRaises:\n    AdapterException: If extraction fails at any step", "category": "business_logic"}, {"name": "JsonLdAdapter", "kind": "class", "path": "dealbrain_api/adapters/jsonld.py", "line": 38, "signature": "class JsonLdAdapter(BaseAdapter)", "summary": "Generic JSON-LD/Microdata adapter using Schema.org Product extraction.", "layer": "core", "docstring": "Generic JSON-LD/Microdata adapter using Schema.org Product extraction.\n\nThis adapter serves as a universal fallback for any retailer website that\nimplements structured data using JSON-LD, Microdata, or RDFa. It uses the\nextruct library to extract Schema.org Product data and maps it to\nNormalizedListingSchema.\n\nStructured Data Support:\n-----------------------\nExtraction priority order:\n1. JSON-LD (most common, easiest to parse)\n2. Microdata (embedded in HTML with itemscope/itemtype)\n3. RDFa (least common, most complex)\n\nSchema.org Product Mapping:\n---------------------------\nThis adapter looks for Schema.org Product type and extracts:\n- name -> title\n- offers.price / offers[0].price -> price\n- offers.priceCurrency -> currency\n- offers.availability -> condition (InStock = new, Refurbished = refurb)\n- image / images[0] -> images\n- offers.seller.name or brand.name -> seller\n- description -> description (parsed for CPU/RAM/storage)\n\nSpec Extraction:\n---------------\nSince most retailers don't include CPU/RAM/storage in structured data,\nthis adapter uses regex patterns to extract them from the description:\n- CPU: \"Intel Core i7-12700K\", \"AMD Ryzen 7 5800X\"\n- RAM: \"16GB RAM\", \"32 GB DDR4\"\n- Storage: \"512GB SSD\", \"1TB NVMe\", \"2 TB\"\n\nPrice Parsing:\n-------------\nHandles various price formats:\n- String: \"599.99\", \"$599.99\", \"USD 599.99\"\n- Number: 599.99\n- With separators: \"1,599.99\"\n\nNested Offers:\n-------------\nSome sites have multiple offers (different sellers, conditions):\n- Takes the lowest price by default\n- Extracts seller from first offer\n\nError Handling:\n--------------\n- NO_STRUCTURED_DATA: No Product schema found in page\n- INVALID_SCHEMA: Product schema missing required fields (name, price)\n- PARSE_ERROR: Unable to parse price or specs\n- NETWORK_ERROR: HTTP fetch failed\n- TIMEOUT: Request timeout\n\nPriority:\n--------\nPriority 5 (lower than domain-specific adapters like eBay)\nSupports all domains via wildcard [\"*\"]", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/jsonld.py", "line": 105, "signature": "__init__(self) -> None", "summary": "Initialize JSON-LD adapter.", "layer": "core", "parent": "JsonLdAdapter", "docstring": "Initialize JSON-LD adapter.\n\nLoads configuration from settings including timeout and retries.\nUses wildcard domain matching to support any URL.", "category": "business_logic"}, {"name": "extract", "kind": "async_method", "path": "dealbrain_api/adapters/jsonld.py", "line": 129, "signature": "async extract(self, url: str) -> NormalizedListingSchema", "summary": "Extract listing data from any URL using JSON-LD/Microdata.", "layer": "core", "parent": "JsonLdAdapter", "docstring": "Extract listing data from any URL using JSON-LD/Microdata.\n\nWorkflow:\n1. Fetch HTML from URL\n2. Extract structured data using extruct\n3. Find Product schema (JSON-LD \u2192 Microdata \u2192 RDFa)\n4. Map to NormalizedListingSchema\n5. Parse specs from description\n\nArgs:\n    url: URL to extract listing data from\n\nReturns:\n    NormalizedListingSchema with normalized listing data\n\nRaises:\n    AdapterException: If extraction fails at any step", "category": "business_logic"}, {"name": "supports_url", "kind": "method", "path": "dealbrain_api/adapters/jsonld.py", "line": 173, "signature": "supports_url(self, url: str) -> bool", "summary": "Check if this adapter supports the given URL.", "layer": "core", "parent": "JsonLdAdapter", "docstring": "Check if this adapter supports the given URL.\n\nSince this is a wildcard adapter, it supports all URLs.\nHowever, it should be used as a fallback after domain-specific\nadapters have been tried.\n\nArgs:\n    url: URL to check\n\nReturns:\n    Always True (supports all domains)", "category": "business_logic"}, {"name": "AdapterRouter", "kind": "class", "path": "dealbrain_api/adapters/router.py", "line": 23, "signature": "class AdapterRouter", "summary": "Routes URLs to appropriate adapter based on domain and priority.", "layer": "router", "docstring": "Routes URLs to appropriate adapter based on domain and priority.\n\nThis router serves as the entry point for the ingestion system. It:\n1. Auto-discovers available adapters from AVAILABLE_ADAPTERS registry\n2. Matches URLs to adapters based on domain patterns\n3. Selects highest priority adapter when multiple match\n4. Validates adapter is enabled in settings before use\n\nSelection Algorithm:\n-------------------\n1. Parse domain from URL (e.g., \"ebay.com\" from \"https://www.ebay.com/itm/123\")\n2. Find all adapters whose supported_domains match the URL domain\n3. Sort matches by priority (lower number = higher priority)\n4. Select first match (highest priority)\n5. Check if adapter is enabled in settings\n6. Return initialized adapter instance\n\nDomain Matching Rules:\n---------------------\n- Wildcard \"*\" matches all domains (used by JsonLdAdapter)\n- Exact match: \"ebay.com\" matches \"ebay.com\", \"www.ebay.com\", \"m.ebay.com\"\n- TLD preserved: \"ebay.com\" does NOT match \"ebay.co.uk\"\n- Subdomain normalization: \"www.\" and \"m.\" prefixes stripped for matching\n\nPriority System:\n---------------\n- Lower number = higher priority\n- EbayAdapter: priority 1 (highest)\n- JsonLdAdapter: priority 5 (fallback)\n- If two adapters have same priority, first in registry wins\n\nExample Usage:\n-------------\n```python\nrouter = AdapterRouter()\n\n# Select adapter for eBay URL\nadapter = router.select_adapter(\"https://www.ebay.com/itm/123456789012\")\n# Returns EbayAdapter instance (priority 1)\n\n# Select adapter for generic URL\nadapter = router.select_adapter(\"https://www.bestbuy.com/product/123\")\n# Returns JsonLdAdapter instance (wildcard, priority 5)\n\n# Convenience method: select and extract in one call\nlisting = await router.extract(\"https://www.ebay.com/itm/123456789012\")\n```\n\nError Handling:\n--------------\n- NO_ADAPTER_FOUND: No adapter matches URL (rare with wildcard JsonLdAdapter)\n- ADAPTER_DISABLED: Matched adapter is disabled in settings\n- PARSE_ERROR: Invalid URL format", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/adapters/router.py", "line": 80, "signature": "__init__(self) -> None", "summary": "Initialize adapter router.", "layer": "router", "parent": "AdapterRouter", "docstring": "Initialize adapter router.\n\nLoads available adapters from registry and prepares for routing.", "category": "business_logic"}, {"name": "select_adapter", "kind": "method", "path": "dealbrain_api/adapters/router.py", "line": 89, "signature": "select_adapter(self, url: str) -> BaseAdapter", "summary": "Select the best adapter for the given URL.", "layer": "router", "parent": "AdapterRouter", "docstring": "Select the best adapter for the given URL.\n\nThis is the main routing method that implements the selection algorithm:\n1. Extract domain from URL\n2. Find all matching adapters\n3. Sort by priority\n4. Validate enabled status\n5. Return initialized adapter\n\nArgs:\n    url: The URL to extract data from\n\nReturns:\n    Initialized adapter instance ready to call extract()\n\nRaises:\n    AdapterException: If no adapter found, adapter disabled, or invalid URL", "category": "business_logic"}, {"name": "extract", "kind": "async_method", "path": "dealbrain_api/adapters/router.py", "line": 157, "signature": "async extract(self, url: str) -> tuple[NormalizedListingSchema, str]", "summary": "Extract data using fallback chain.", "layer": "router", "parent": "AdapterRouter", "docstring": "Extract data using fallback chain.\n\nTries adapters in priority order until one succeeds. This implements\nthe adapter fallback mechanism:\n1. Get list of matching adapters sorted by priority\n2. Try each adapter in order\n3. Log each attempt\n4. Catch AdapterException and ValueError (init failures)\n5. Continue to next adapter if one fails\n6. Raise ALL_ADAPTERS_FAILED if all fail\n\nFast-fail conditions:\n- ITEM_NOT_FOUND: Don't retry if item doesn't exist\n- ADAPTER_DISABLED: Don't retry if adapter is disabled\n\nArgs:\n    url: The URL to extract data from\n\nReturns:\n    Tuple of (normalized listing data, adapter name used)\n\nRaises:\n    AdapterException: If all adapters fail or item not found", "category": "business_logic"}, {"name": "new_request_id", "kind": "function", "path": "dealbrain_api/telemetry/context.py", "line": 15, "signature": "new_request_id() -> str", "summary": "Generate a correlation id for requests/tasks.", "layer": "core", "docstring": "Generate a correlation id for requests/tasks.", "category": "business_logic"}, {"name": "bind_request_context", "kind": "function", "path": "dealbrain_api/telemetry/context.py", "line": 20, "signature": "bind_request_context(request_id: str) -> None", "summary": "Bind request-id and optional fields into the structlog context.", "layer": "core", "docstring": "Bind request-id and optional fields into the structlog context.", "category": "business_logic"}, {"name": "bind_user_context", "kind": "function", "path": "dealbrain_api/telemetry/context.py", "line": 26, "signature": "bind_user_context(user_id: str | None) -> None", "summary": "Augment the context with a user identifier when available.", "layer": "core", "docstring": "Augment the context with a user identifier when available.", "category": "business_logic"}, {"name": "clear_context", "kind": "function", "path": "dealbrain_api/telemetry/context.py", "line": 35, "signature": "clear_context() -> None", "summary": "Clear context variables, optionally scoping to specific keys.", "layer": "core", "docstring": "Clear context variables, optionally scoping to specific keys.", "category": "business_logic"}, {"name": "current_context", "kind": "function", "path": "dealbrain_api/telemetry/context.py", "line": 45, "signature": "current_context() -> Mapping[str, Any]", "summary": "Return the current context dictionary.", "layer": "core", "docstring": "Return the current context dictionary.", "category": "business_logic"}, {"name": "init_telemetry", "kind": "function", "path": "dealbrain_api/telemetry/core.py", "line": 146, "signature": "init_telemetry(settings: Settings) -> None", "summary": "Initialise logging and tracing according to settings.", "layer": "core", "docstring": "Initialise logging and tracing according to settings.", "category": "business_logic"}, {"name": "get_logger", "kind": "function", "path": "dealbrain_api/telemetry/core.py", "line": 189, "signature": "get_logger(name: str | None) -> structlog.stdlib.BoundLogger", "summary": "Convenience helper mirroring logging.getLogger.", "layer": "core", "docstring": "Convenience helper mirroring logging.getLogger.", "category": "business_logic"}, {"name": "ObservabilityMiddleware", "kind": "class", "path": "dealbrain_api/telemetry/middleware.py", "line": 16, "signature": "class ObservabilityMiddleware", "summary": "ASGI middleware that enriches requests with telemetry context and logging.", "layer": "middleware", "docstring": "ASGI middleware that enriches requests with telemetry context and logging.", "category": "business_logic"}, {"name": "__init__", "kind": "method", "path": "dealbrain_api/telemetry/middleware.py", "line": 19, "signature": "__init__(self, app: ASGIApp, record_headers: bool) -> None", "summary": "", "layer": "middleware", "parent": "ObservabilityMiddleware", "category": "business_logic"}, {"name": "__call__", "kind": "async_method", "path": "dealbrain_api/telemetry/middleware.py", "line": 23, "signature": "async __call__(self, scope: Scope, receive: Receive, send: Send) -> None", "summary": "", "layer": "middleware", "parent": "ObservabilityMiddleware", "category": "business_logic"}]}