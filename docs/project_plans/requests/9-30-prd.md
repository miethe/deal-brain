# Dynamic Data Grid & Catalog Management Enhancements PRD

**Document Info**
- Author: Codex (AI architecture partner)
- Date: 2025-09-30
- Status: Draft for review

## Executive Summary
Our internal operations team cannot efficiently curate listings and catalog data because table views are static, filtering is broken, and CRUD tools are inconsistent between Global Fields and Listings. This release delivers a unified, high-performance data grid experience, persistent personalization, and full lifecycle management for global fields and listings entry so analysts can keep the catalog current without developer support.

## Goals
- Deliver responsive data grids that resize to content, preserve user preferences, and support inline/bulk editing across all catalog tables.
- Provide complete CRUD management for Global Fields, including option management for dropdown fields and safe handling of locked fields.
- Enable manual listing creation via a polished modal that honors field validation and custom fields.
- Ship instrumentation and feedback surfaces so we can track grid usage, editing success rates, and field lifecycle actions.

## Non-Goals
- No new entities beyond listings and CPUs/GPU; future entities (e.g., GPUs, ports) will leverage the same patterns later.
- No introduction of server-side user preference storage; persistence is handled client-side for now.
- Import workflow improvements beyond the new navigation entry are out of scope.

## Personas & Needs
- **Catalog Operations Lead** – curates large tables, needs rapid filtering, sorting, and bulk edits without leaving the grid.
- **Data Quality Analyst** – maintains custom field schemas, needs traceability and safe edits/deletes without breaking historical data.
- **Sales Enablement Specialist** – quickly spins up listings for proposals, needs guided creation with validations and option catalogs.

## User Stories
- As a catalog lead, I can resize and reorder columns in any inventory table and have that layout persist across sessions.
- As an analyst, I can filter any column (text, numeric, dropdown) with responsive feedback so I can shape data sets in seconds.
- As an analyst, I can edit multiple records inline or via bulk apply, seeing validation errors before changes save.
- As a data steward, I can add or modify dropdown options for a global field in one modal and have linked records update.
- As a sales specialist, I can add a new listing with all required and custom fields from a single modal with clear validation states.

## Feature Requirements

### Adaptive Data Grids (Tables)
| ID | Requirement | Notes |
| --- | --- | --- |
| T-1 | Tables auto-calc height/width based on viewport and row/column counts, bounded within container margins | Provide min/max row height and column width guardrails to avoid jitter. |
| T-2 | Sticky headers with horizontal + vertical scroll; scrollbars appear when content exceeds space | Use virtualization when row count > 100 to maintain performance. |
| T-3 | Column resize with drag handles; persist widths in localStorage keyed by view + user id (if available) | Include reset layout option. |
| T-4 | Tooltips on header hover showing full field names | Use accessible tooltip component with 300ms delay. |
| T-5 | Row delineation via subtle zebra or borders following design token palette | Align with existing DataGrid visual language. |
| T-6 | Inline edit per cell with optimistic UX, validation feedback inline | Surface dirty state indicator and success/error toasts. |
| T-7 | Bulk edit flow allowing multi-row selection and field change preview | Support revert before commit. |
| T-8 | Column filters: text search, numeric ranges, date pickers, and multi-select dropdowns with search | Filters update results instantly; debounce 250ms. |

### Global Fields Management
| ID | Requirement | Notes |
| --- | --- | --- |
| GF-1 | Add "Import Data" button linking to importer flow with upload CTA and context copy | Opens file picker, then routes to importer preserving return path. |
| GF-2 | Field detail modal supports edit/delete with rules for locked fields (no delete/type change) | Locked fields flagged in registry metadata. |
| GF-3 | Dropdown-type fields manage option lists (add/edit/delete) inline within modal | Option delete triggers background cleanup of orphaned selections. |
| GF-4 | CRUD actions emit audit log events for compliance | Log event type, actor id, field id. |
| GF-5 | Deleting field removes attribute references from associated records with soft-delete strategy | Archive attribute values to history table or log for recovery. |

### Listings Creation & Management
| ID | Requirement | Notes |
| --- | --- | --- |
| L-1 | "Add Listing" button launches modal with multi-step or segmented form honoring validation rules | Step 1 basics, Step 2 pricing/specs, Step 3 custom fields review. |
| L-2 | Form pulls schema dynamically from Field Registry (core + custom) | Ensure ordering respects field sort metadata. |
| L-3 | Dropdowns support search + multi-select, reusing same component as table filters | Provide "Add new option" when permitted. |
| L-4 | Submit triggers backend create via registry API; modal closes on success with toast confirmation | On failure, keep state and highlight invalid fields. |
| L-5 | CPU auto-create path available from CPU dropdown | Opens nested modal; upon create, new CPU injected into selection list. |

## UX & Visual Direction
- Adopt unified DataGrid component with Apple-tier polish: consistent 16px gutters, 12px row padding, 4px rounded corners, gentle elevation.
- Tooltips follow system grey palette with light blur; interactions animate at 150ms using existing motion tokens.
- Bulk edit drawer slides from right with 24px padding and summary of affected fields.
- Add Listing modal uses progress header with breadcrumb dots and contextual help text.

## Technical Constraints & Considerations
- Frontend: Next.js + React Query + existing DataGrid skeleton; extend to support virtualization and persistence using TanStack Table v8.
- Backend: FieldRegistry must support option mutation, field deletion cascade, and persisted user preferences if we later move server-side.
- Need migration or data cleanup job to remove orphaned custom field attributes when fields are deleted.
- Ensure API rate limiting and payload size remain within current infra limits; bulk edits should batch requests to avoid saturating DB.

## Dependencies
- Reliable custom field metadata from `CustomFieldService` (must expose locked flag and option mutators).
- Authentication context providing user identifier for preference persistence; fallback to browser fingerprint if missing.
- UX design sync to approve modal layout and grid styling updates.

## Rollout Plan
- Immediate rollout with no feature flags; all users gain access immediately.

## Risks & Mitigations
- **Performance degradation with large datasets** – Mitigate with virtualization and query pagination; benchmark prior to launch.
- **Accidental data loss from field deletion** – Enforce confirmation dialogs and implement soft-deletes with recovery logs.
- **Validation drift between frontend and backend** – Centralize validation rules in FieldRegistry and generate frontend schemas from API.
- **Preference persistence collisions** – Namespace storage keys per environment and user.

## Open Questions
- Do we need role-based restrictions on bulk edits or field deletion? A: Not for the MVP, but we will add multiple users/roles later.
- Should deleted dropdown options remain visible on historical records? A: Yes, but greyed out with tooltip "Option no longer available".
- How to handle concurrent edits in bulk edit mode? A: Last write wins with conflict toast
- Is analytics stack ready to capture new grid events or do we need interim logging? A: Interim logging with a flag in the config file.
