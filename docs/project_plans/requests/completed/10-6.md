# Enhancements and Fixes

Date: 10-6-25

The following requests and fixes are proposed to improve the user experience and functionality of the application. Each item needs to be evaluated and designed thoroughly for implementation into the app. The implementation of each should then be planned.

## Notes

- Review @architecture.md for current architecture overview.

## Requests

### Listings

- For the CPU Field in Listings, when the CPU is populated, there should be a tooltip icon within the cell next to the CPU label. Hovering over this icon should show key details about the CPU, including:
  - Passmark Single Thread Score
  - Passmark Multi-Thread Score
  - Integrated Graphics (Yes/No)
  - Integrated Graphics Model (if applicable)
  - Integrated Graphics Score (if applicable)
  - TDP (Thermal Design Power)
  - Release Year
- Within the tooltip should there should be a button to "View Full CPU Details" which opens a modal with all details about the CPU pulled from the CPU table.
- The field 'Secondary Storage (GB)' should be a dropdown, identical to the existing 'Primary Storage (GB)' field, allowing users to select from predefined storage sizes rather than entering a freeform number.
- When creating or editing a Listing, when the 'Add new...' button is pressed to add a new option to a dropdown field, currently a browser dialog opens. Instead, a custom modal should open within the app, allowing for a more seamless user experience. This modal should include all necessary fields to create the new option, and upon saving, the new option should be immediately available in the dropdown without needing to refresh the page. This modal should follow the same design and functionality as the existing modals used for adding new entries in other parts of the app.

### Tables

- Dropdowns still do not have a consistent style. Specifically, the dropdowns for Condition and Status fields in Listings are still very small and very difficult to read. As we've noted, dropdowns should use the size of the longest option plus some constant padding to determine their width, rather than being constrained by the size of the column.
- Every column in a table should be resizeable. This was working previously, but now the columns do not resize.

### Global Fields

- When on the Listings table on the Data tab, the 'Add entry' button should open the same screen used on the /listings page for adding a new listing, rather than the current modal. However, it should open by default as a Modal, allowing the user to expand to see the full view. The same should occur on the /listings page when the button is pressed.

### Dashboard

- All Listings highlighted on the dashboard should function as a button. When pressed, a modal should open showing an overview of the details of the listing in question. There should also be a button to "View Full Listing" which takes the user to the /listings page with that listing selected.

## Bugs

- On /listings, the new fields $/CPU Mark (Single) and $/CPU Mark (Multi) are empty for all listings, even those with a CPU selected. These fields should calculate the value based on the listing price and the CPU's Passmark scores.
- Trying to save a CPU to a Listing from the /listings page fails, with the following error in the API logs:

```log
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute

    self._handle_exception(error)

  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception

    self._adapt_connection._handle_exception(error)

  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception

    raise translated_error from error

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '13' ('str' object cannot be interpreted as an integer)

[SQL: UPDATE listing SET cpu_id=$1::INTEGER, updated_at=now() WHERE listing.id = $2::INTEGER]

[parameters: ('13', 13)]
```

- When trying to run the seed_sample_listings.py script, the following error occurs:

```log
  File "/mnt/containers/deal-brain/scripts/seed_sample_listings.py", line 169, in seed_sample_listings
    port = Port(
           ^^^^^
  File "<string>", line 4, in __init__
  File "/mnt/containers/deal-brain/.venv/lib64/python3.11/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/mnt/containers/deal-brain/.venv/lib64/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/mnt/containers/deal-brain/.venv/lib64/python3.11/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/mnt/containers/deal-brain/.venv/lib64/python3.11/site-packages/sqlalchemy/orm/decl_base.py", line 2179, in _declarative_constructor
    raise TypeError(
TypeError: 'port_profile_id' is an invalid keyword argument for Port
```
