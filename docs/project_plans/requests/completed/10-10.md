# Enhancements and Fixes

Date: 10-10-25

The following requests and fixes are proposed to improve the user experience and functionality of the application. Each item needs to be evaluated and designed thoroughly for implementation into the app. The implementation of each should then be planned.

## Notes

- Review @architecture.md for current architecture overview.

## Requests

### Listings



### Valuation Rules

- Valuation Rules seem to not be working as expected to set the adjusted value for a listing. None of the Listings currently have an Adjusted value which is different than the Base Price, with no Listings showing any adjustments in the Deal Meter breakdown modal. This needs to be investigated and fixed if there is a bug.

#### Editing Rules

- When trying to update a Rule, the following error is encountered:

```log  
File "/usr/local/lib/python3.11/site-packages/dealbrain_api/api/rules.py", line 577, in update_rule

    rule = await service.update_rule(session, rule_id, updates)

           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  File "/usr/local/lib/python3.11/site-packages/dealbrain_api/services/rules.py", line 518, in update_rule

    enqueue_listing_recalculation(ruleset_id=ruleset_id, reason="rule_updated")

  File "/usr/local/lib/python3.11/site-packages/dealbrain_api/tasks/valuation.py", line 165, in enqueue_listing_recalculation

    recalculate_listings_task(**payload)

  File "/usr/local/lib/python3.11/site-packages/celery/local.py", line 182, in __call__

    return self._get_current_object()(*a, **kw)

           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  File "/usr/local/lib/python3.11/site-packages/celery/app/task.py", line 411, in __call__

    return self.run(*args, **kwargs)

           ^^^^^^^^^^^^^^^^^^^^^^^^^

TypeError: recalculate_listings_task() got an unexpected keyword argument 'reason'
```

#### Rule Actions

- When creating a Rule Action and using the action type "Per Unit", it should allow the user to choose a Listing field to base the per-unit adjustment on. For example, the user might select the "RAM (GB)" field, and then enter a value of "5". This would mean that the adjustment is $5 per GB of RAM. Currently, this field is not present when selecting the "Per Unit" action type.

#### Ruleset Design

- The Ruleset selector should update a Ruleset's Enabled/Disabled state when the state is changed and the Ruleset saved.
- The Ruleset selector content currently overlaps the Selector box. The box should be taller to fit the content with appropriate padding.

